<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜µì±”ìŠ¤ ê°ë… ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root { --ow-orange: #f99e1a; --ow-blue: #405275; --dark-bg: #121418; --card-bg: #1e2329; --accent: #00ffcc; --ban-red: #ff5e57; --good-green: #2ecc71; --stamina: #e1b12c; --gold: #ffd700; }
        body { background: var(--dark-bg); color: white; font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; margin: 0; padding: 0; font-size: 14px; overflow: hidden; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .team-btn { background: #333; color: white; border: 1px solid #555; padding: 15px 30px; margin: 5px; cursor: pointer; font-size: 1.1em; width: 200px; transition: 0.2s; }
        .team-btn:hover { background: var(--ow-orange); color: black; border-color: var(--ow-orange); }
        .load-btn { background: #2b313a; color: var(--accent); border: 1px solid var(--accent); padding: 15px 30px; margin-top: 20px; cursor: pointer; font-size: 1.2em; width: 300px; font-weight: bold; transition: 0.2s; display: none; }
        .load-btn:hover { background: var(--accent); color: black; box-shadow: 0 0 15px var(--accent); }

        #layout { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        
        .sidebar { background: #181b21; border-right: 1px solid #333; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; position: relative; z-index: 10; }
        .league-table { width: 100%; border-collapse: collapse; font-size: 0.85em; margin-bottom: 20px; }
        .league-table th { color: var(--ow-orange); border-bottom: 2px solid #444; padding: 8px 4px; }
        .league-table td { padding: 8px 4px; text-align: center; border-bottom: 1px solid #333; }
        .my-team-row { background: rgba(249, 158, 26, 0.15); font-weight: bold; color: var(--ow-orange); }
        
        .side-btn { background: var(--ow-blue); color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 10px; width: 100%; transition:0.2s; }
        .side-btn:hover { background: #506485; }
        .potm-btn { background: #333; border: 1px solid var(--gold); color: var(--gold); }
        .potm-btn:hover { background: var(--gold); color: black; }
        .system-btn { background: #333; border: 1px solid #555; color: #aaa; font-size: 0.9em; margin-bottom: 5px; }
        .system-btn:hover { background: #444; color: white; border-color: white; }

        .main-panel { padding: 20px; display: flex; flex-direction: column; overflow-y: auto; position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        
        .scoreboard { font-size: 3em; font-weight: 800; text-align: center; color: var(--ow-orange); letter-spacing: 5px; margin: 10px 0; }
        .phase-badge { background: #333; padding: 5px 12px; border-radius: 20px; font-size: 0.9em; color: var(--accent); border: 1px solid var(--accent); }

        .game-container { flex-grow: 1; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid #333; position: relative; }
        .ui-phase { display: none; height: 100%; }
        .active-phase { display: flex; flex-direction: column; justify-content: center; align-items: center; }

        .setup-row { display: flex; gap: 20px; width: 100%; justify-content: center; }
        .setup-col { background: #2b313a; padding: 15px; border-radius: 8px; width: 32%; min-width: 200px; }
        select { width: 100%; padding: 10px; background: #121418; color: white; border: 1px solid #555; border-radius: 4px; margin-top: 5px; }
        select:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .action-btn { background: var(--ow-orange); color: #000; font-weight: 800; padding: 15px 40px; border: none; border-radius: 6px; font-size: 1.2em; cursor: pointer; margin-top: 20px; transition: transform 0.1s; }
        .action-btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .action-btn:disabled { background: #555; cursor: not-allowed; transform: none; }

        .train-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 800px; margin-top: 20px; }
        .train-card { background: #2b313a; padding: 20px; border-radius: 8px; border: 1px solid #444; cursor: pointer; transition: 0.2s; text-align: left; }
        .train-card:hover { border-color: var(--ow-orange); background: #333842; }
        .train-title { font-size: 1.1em; font-weight: bold; color: var(--ow-orange); margin-bottom: 5px; }
        .train-desc { font-size: 0.9em; color: #aaa; }

        .modal { display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 800px; max-height: 80vh; background: #1a1a1a; border: 2px solid var(--ow-orange); z-index: 10000; padding: 20px; border-radius: 10px; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .close-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }

        .player-card { background: #333; margin-bottom: 10px; padding: 15px; border-radius: 5px; display: grid; grid-template-columns: 100px 1fr 150px; align-items: center; }
        .stat-bars { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 5px; font-size: 0.8em; color: #aaa; margin-left: 20px; }
        .stat-val { color: var(--accent); font-weight: bold; }
        .hp-val { color: var(--stamina); font-weight: bold; }

        .potm-row { display: grid; grid-template-columns: 50px 1fr 1fr 100px; padding: 10px; border-bottom: 1px solid #333; align-items: center; }
        .potm-row:nth-child(even) { background: #222; }
        .potm-rank-1 { color: var(--gold); font-weight: bold; }
        .potm-count { background: var(--gold); color: black; padding: 2px 8px; border-radius: 10px; font-weight: bold; display: inline-block;}

        .opp-card { background: #1e1e1e; padding: 8px; margin-bottom: 5px; border-radius: 4px; border-left: 3px solid var(--ban-red); display:flex; justify-content: space-between; align-items: center; }
        .opp-hero { font-weight:bold; color: var(--ban-red); font-size: 0.9em; transition: all 0.5s ease; }
        .opp-hero.hidden { color: #555; letter-spacing: 2px; }

        .meta-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; margin-bottom: 5px; }
        .good-tag { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid #2ecc71; }
        .bad-tag { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }

        #log-window { height: 250px; background: #000; border-top: 2px solid var(--ow-orange); margin-top: 20px; padding: 10px; font-family: 'Consolas', monospace; overflow-y: auto; font-size: 0.9em; color: #eee; line-height: 1.6; }
        .log-win { color: var(--accent); } .log-lose { color: var(--ban-red); }
        .log-potm { color: var(--gold); font-weight: bold; }
        .log-skill { color: #f1c40f; font-weight: bold; }
        .log-caster { color: #3498db; }
        .log-mistake { color: #e74c3c; font-weight: bold; text-decoration: underline; }
        .log-crack { color: #00ffcc; font-weight: bold; font-style: italic; }
        .log-teamwork { color: #e1b12c; font-weight: bold; }

        /* ENDING SCREEN */
        #ending-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 20000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white;
        }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="color:var(--ow-orange); font-size:3em; margin-bottom:10px;">ì˜µì±”ìŠ¤ ê°ë… ì‹œë®¬ë ˆì´í„°</h1>
    <p style="color:#aaa; margin-bottom:30px;">ê°ë…ì„ ë§¡ì„ íŒ€ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤. (ì´ 9íŒ€)</p>
    <button id="load-btn-start" class="load-btn" onclick="loadGame()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸° (Load Game)</button>
    <br><br>
    <div id="team-buttons" style="display:flex; flex-wrap:wrap; justify-content:center; max-width:800px;"></div>
</div>

<div id="ending-screen">
    <h1 style="font-size:5em; color:var(--gold); text-shadow: 0 0 20px var(--gold); margin-bottom: 10px;">ğŸ† VICTORY ğŸ†</h1>
    <h2 style="font-size:2em; margin-bottom: 30px;">OWCS KOREA CHAMPIONS</h2>
    <p style="font-size:1.2em; color:#ccc; max-width: 600px; line-height: 1.6;">
        ì¶•í•˜í•©ë‹ˆë‹¤, ê°ë…ë‹˜! ì¹˜ì—´í•œ ìŠ¹ë¶€ ëì— íŒ€ì„ ì •ìƒìœ¼ë¡œ ì´ëŒì—ˆìŠµë‹ˆë‹¤.<br>
        ë‹¹ì‹ ì˜ ì „ìˆ ê³¼ ë¦¬ë”ì‹­ì€ ì „ì„¤ë¡œ ë‚¨ì„ ê²ƒì…ë‹ˆë‹¤.
    </p>
    <button class="action-btn" onclick="location.reload()" style="margin-top:40px;">íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<div id="roster-modal" class="modal">
    <button class="close-btn" onclick="toggleModal('roster-modal')">Ã—</button>
    <h2 style="margin-top:0; color:var(--ow-orange);">MY TEAM ROSTER</h2>
    <div id="roster-content"></div>
</div>

<div id="potm-modal" class="modal">
    <button class="close-btn" onclick="toggleModal('potm-modal')">Ã—</button>
    <h2 style="margin-top:0; color:var(--gold);">ğŸ† LEAGUE POTM RANKING</h2>
    <div class="potm-row" style="font-weight:bold; color:#aaa; border-bottom:2px solid #555;">
        <div>#</div><div>PLAYER</div><div>TEAM</div><div>POTM</div>
    </div>
    <div id="potm-content"></div>
</div>

<div id="layout">
    <div class="sidebar">
        <button class="side-btn" onclick="toggleRoster()">ğŸ“‹ MY ROSTER (ì„ ìˆ˜ ì •ë³´)</button>
        <button class="side-btn potm-btn" onclick="togglePOTM()">ğŸ† LEAGUE POTM</button>
        
        <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
            <div style="color:#666; font-size:0.8em; margin-bottom:5px;">SYSTEM</div>
            <button class="side-btn system-btn" onclick="saveGame()">ğŸ’¾ GAME SAVE</button>
            <button class="side-btn system-btn" onclick="resetGame()">ğŸ—‘ï¸ RESET DATA</button>
        </div>

        <h3 style="text-align:center; margin-top:20px;">ğŸ† SEASON STANDINGS</h3>
        <div id="round-display" style="text-align:center; color:var(--accent); margin-bottom:15px; font-weight:bold;">PRE-SEASON</div>
        
        <table class="league-table">
            <thead><tr><th>#</th><th>TEAM</th><th>W</th><th>L</th><th>DIFF</th></tr></thead>
            <tbody id="standings-body"></tbody>
        </table>

        <div id="tournament-tree" style="display:none; background:#111; padding:10px; border-radius:8px; font-size:0.85em;">
            <h4 style="margin:5px 0; color:var(--ow-orange);">PLAYOFFS</h4>
            <div id="bracket-view"></div>
        </div>
    </div>

    <div class="main-panel">
        <div class="header">
            <div>
                <h1 id="match-title" style="margin:0; font-size:1.8em;">WAITING...</h1>
                <div id="match-subtitle" style="color:#888; margin-top:5px;">ì‹œì¦Œ ì¤€ë¹„ ì¤‘</div>
            </div>
            <div style="text-align:right;">
                <div class="phase-badge" id="current-phase-badge">LOBBY</div>
                <div id="set-score-txt" style="font-weight:bold; margin-top:5px; font-size:1.2em;">Bo5</div>
            </div>
        </div>

        <div class="scoreboard">
            <span id="sc-my">0</span> - <span id="sc-opp">0</span>
        </div>

        <div class="game-container">
            <div id="ui-training" class="ui-phase">
                <h2 style="color:var(--good-green);">ğŸ‹ï¸ TRAINING CENTER</h2>
                <p id="train-desc-txt" style="color:#aaa;">í›ˆë ¨ ì‹œ ì²´ë ¥ +10, íœ´ì‹ ì‹œ ì²´ë ¥ +30 íšŒë³µë©ë‹ˆë‹¤.</p>
                <div class="train-grid">
                    <div class="train-card" onclick="runTraining('AIM')">
                        <div class="train-title">ğŸ¯ ì—ì„ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">AIM +1</span> ìƒìŠ¹ (Max 99)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('SENSE')">
                        <div class="train-title">ğŸ§  ì„¼ìŠ¤ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">SENSE +1</span> ìƒìŠ¹ (Max 99)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('MENTAL')">
                        <div class="train-title">ğŸ§˜ ë©˜íƒˆ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">MENTAL +1</span> (ì‹¤ìˆ˜ í™•ë¥  ê°ì†Œ)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('TEAM')">
                        <div class="train-title">ğŸ¤ íŒ€ì›Œí¬ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">TEAM +1</span> (ì—­ì „ í™•ë¥  ì¦ê°€)</div>
                    </div>
                    <div class="train-card" style="grid-column: span 2; cursor:default; border-color:#555;">
                         <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div class="train-title" style="color:var(--accent);">âš”ï¸ ì˜ì›… ì§‘ì¤‘ ì—°ìŠµ</div>
                                <div class="train-desc">ì„ ìˆ˜ 1ëª…ì´ ì˜ì›…ì„ ì—°ìŠµí•©ë‹ˆë‹¤. (ê¸°ë³¸ 3íšŒ / ë‹¤ì¬ë‹¤ëŠ¥ 2íšŒ)</div>
                            </div>
                            <div style="display:flex; gap:10px;">
                                <select id="train-p-select" style="width:120px;"></select>
                                <select id="train-h-select" style="width:120px;"></select>
                                <button onclick="runTraining('HERO')" style="background:var(--accent); border:none; border-radius:4px; font-weight:bold; cursor:pointer;">GO</button>
                            </div>
                         </div>
                    </div>
                    <div class="train-card" style="grid-column: span 2; border-color:var(--stamina);" onclick="runTraining('REST')">
                        <div class="train-title" style="color:var(--stamina);">ğŸ›Œ ì „ì› íœ´ì‹</div>
                        <div class="train-desc">í›ˆë ¨ì„ ì‰¬ê³  ì»¨ë””ì…˜ì„ ì¡°ì ˆí•©ë‹ˆë‹¤. <span style="color:white;">ì²´ë ¥ +30</span> íšŒë³µ</div>
                    </div>
                </div>
            </div>

            <div id="ui-lobby" class="ui-phase">
                <h2 id="next-match-info" style="color:var(--accent);"></h2>
                <p id="lobby-desc" style="color:#aaa; max-width:600px; text-align:center;"></p>
                <div id="selection-area" style="display:none; width:100%; text-align:center;">
                    <h3 style="color:var(--ow-orange);">ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤ (1ìœ„ íŠ¹ì „)</h3>
                    <div id="pick-opponent-btns" style="display:flex; justify-content:center; gap:10px;"></div>
                </div>
                <button id="btn-start-match" class="action-btn" onclick="proceedLobby()">ì¼ì • ì§„í–‰</button>
            </div>

            <div id="ui-map" class="ui-phase">
                <h2>ğŸ—ºï¸ MAP SELECTION</h2>
                <p id="map-msg" style="color:#ccc;"></p>
                <div style="width:300px;">
                    <select id="map-select"></select>
                </div>
                <button class="action-btn" onclick="confirmMap()">CONFIRM</button>
            </div>

            <div id="ui-roster" class="ui-phase">
                <h2>ğŸ“‹ LINEUP CHECK</h2>
                <div id="map-meta-roster" style="text-align:center; margin-bottom:15px; font-size:0.9em; color:#888;"></div>
                <div class="setup-row">
                    <div class="setup-col">
                        <h4 style="color:var(--accent);">MY LINEUP (Select Players)</h4>
                        <div id="roster-slots"></div>
                    </div>
                    <div class="setup-col" style="border:1px solid #444;">
                        <h4 style="color:var(--ban-red);">OPPONENT LINEUP</h4>
                        <div id="roster-opp-display" style="padding:20px; text-align:center; color:#ccc;">
                            (Waiting for your confirmation...)
                        </div>
                    </div>
                </div>
                <button class="action-btn" onclick="confirmRoster()">CONFIRM ROSTER</button>
            </div>

            <div id="ui-ban" class="ui-phase">
                <h2 style="color:var(--ban-red);">ğŸš« HERO BAN PHASE</h2>
                <p style="color:#aaa; font-size:0.9em; margin-bottom:15px;">* ì´ì „ ì„¸íŠ¸ì— ë°´í•œ ì—­í• êµ°ì€ ì—°ì†ìœ¼ë¡œ ë°´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="color:#aaa; font-size:0.8em;">* ê°™ì€ ì„¸íŠ¸ì— ì–‘ íŒ€ì€ ë™ì¼í•œ ì—­í• êµ°ì„ ë°´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <div class="setup-row">
                    <div class="setup-col" style="border:1px solid var(--ban-red);">
                        <h4>ìš°ë¦¬ íŒ€ ë°´</h4>
                        <select id="ban-select"></select>
                    </div>
                    <div class="setup-col">
                        <h4>ìƒëŒ€ íŒ€ ë°´</h4>
                        <div id="opp-ban-display" style="font-size:1.5em; font-weight:bold; margin-top:10px;">-</div>
                    </div>
                    <div class="setup-col" style="opacity:0.7;">
                        <h4>ìƒëŒ€ ë¼ì¸ì—…</h4>
                        <div id="ban-phase-opp-list" style="font-size:0.9em;"></div>
                    </div>
                </div>
                <button class="action-btn" onclick="confirmBan()">BAN HERO</button>
            </div>

            <div id="ui-pick" class="ui-phase">
                <h2>âš”ï¸ HERO PICK</h2>
                <p style="text-align:center; color:#e74c3c; margin-bottom:10px; font-weight:bold;">â€» ë°´ ëœ ì˜ì›…ì€ ì–‘ íŒ€ ëª¨ë‘ í”½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <div class="setup-row" style="align-items: flex-start;">
                    <div class="setup-col">
                        <h4 style="color:var(--ow-orange);">ğŸ›¡ï¸ MY HERO PICK</h4>
                        <div id="pick-slots"></div>
                    </div>
                    <div class="setup-col" style="border:1px solid #444;">
                        <h4 style="color:var(--ban-red);">ğŸ‘¿ OPPONENT</h4>
                        <div id="opp-entry-display"></div>
                    </div>
                </div>
                <button class="action-btn" onclick="runSimulation()">FIGHT!</button>
            </div>
        </div>

        <div id="log-window">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ. íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
    </div>
</div>

<script>
    // --- DATA ---
    const HEROES = {
        TANK: [{n:"ë””ë°”",t:"Poke"},{n:"ë‘ í”¼ìŠ¤íŠ¸",t:"Dive"},{n:"ìœˆìŠ¤í„´",t:"Dive"},{n:"ì‹œê·¸ë§ˆ",t:"Poke"},{n:"ë¼ì¸í•˜ë¥´íŠ¸",t:"Rush"},{n:"ë¼ë§ˆíŠ¸ë¼",t:"Rush"},{n:"ì˜¤ë¦¬ì‚¬",t:"Poke"},{n:"ìë¦¬ì•¼",t:"Rush"},{n:"ë§ˆìš°ê°€",t:"Rush"},{n:"ì •ì»¤í€¸",t:"Rush"},{n:"ë ˆí‚¹ë³¼",t:"Dive"},{n:"ë¡œë“œí˜¸ê·¸",t:"Poke"},{n:"í•´ì €ë“œ",t:"Dive"}],
        DPS: [{n:"íŠ¸ë ˆì´ì„œ",t:"Dive"},{n:"ê²ì§€",t:"Dive"},{n:"ì†Œì „",t:"Poke"},{n:"ìºì„œë””",t:"Poke"},{n:"ì—ì½”",t:"Dive"},{n:"ìœ„ë„ìš°ë©”ì´ì»¤",t:"Poke"},{n:"ë©”ì´",t:"Rush"},{n:"ë¦¬í¼",t:"Rush"},{n:"ì• ì‰¬",t:"Poke"},{n:"ì†œë¸Œë¼",t:"Dive"},{n:"ì†”ì €: 76",t:"Poke"},{n:"íŒŒë¼",t:"Poke"},{n:"ë°”ìŠ¤í‹°ì˜¨",t:"Poke"},{n:"ë²¤ë°íƒ€",t:"Dive"},{n:"ë²¤ì²˜",t:"Dive"},{n:"ì‹œë©”íŠ¸ë¼",t:"Rush"},{n:"ì •í¬ë«",t:"Poke"},{n:"í† ë¥´ë¹„ìš˜",t:"Poke"},{n:"í”„ë ˆì•¼",t:"Poke"},{n:"í•œì¡°",t:"Poke"}],
        SUP: [{n:"ì•„ë‚˜",t:"Poke"},{n:"í‚¤ë¦¬ì½”",t:"Dive"},{n:"ë£¨ì‹œìš°",t:"Rush"},{n:"ë¸Œë¦¬ê¸°í…Œ",t:"Poke"},{n:"ë°”í‹°ìŠ¤íŠ¸",t:"Poke"},{n:"ì£¼ë…¸",t:"Rush"},{n:"ì  ì•¼íƒ€",t:"Poke"},{n:"ì¼ë¦¬ì•„ë¦¬",t:"Poke"},{n:"ë¼ì´í”„ìœ„ë²„",t:"Poke"},{n:"ëª¨ì´ë¼",t:"Rush"},{n:"ë©”ë¥´ì‹œ",t:"Poke"},{n:"ìš°ì–‘",t:"Poke"}]
    };
    
    const HERO_SKILLS = {
        "ë””ë°”": "ìí­", "ë‘ í”¼ìŠ¤íŠ¸": "íŒŒë©¸ì˜ ì¼ê²©", "ìœˆìŠ¤í„´": "ì›ì‹œì˜ ë¶„ë…¸", "ì‹œê·¸ë§ˆ": "ì¤‘ë ¥ ë¶•ê´´", "ë¼ì¸í•˜ë¥´íŠ¸": "ëŒ€ì§€ë¶„ì‡„", "ë¼ë§ˆíŠ¸ë¼": "ì ˆë©¸", "ì˜¤ë¦¬ì‚¬": "ëŒ€ì§€ì˜ ì°½", "ìë¦¬ì•¼": "ì¤‘ë ¥ìíƒ„", "ë§ˆìš°ê°€": "ì¼€ì´ì§€", "ì •ì»¤í€¸": "ì‚´ìœ¡", "ë ˆí‚¹ë³¼": "ì§€ë¢°ë°­", "ë¡œë“œí˜¸ê·¸": "ë¼ì¬ì•™", "í•´ì €ë“œ": "ê°€ì‹œì†Œë‚˜ê¸°",
        "íŠ¸ë ˆì´ì„œ": "í„ìŠ¤ í­íƒ„", "ê²ì§€": "ìš©ê²€", "ì†Œì „": "ì˜¤ë²„í´ëŸ­", "ìºì„œë””": "í™©ì•¼ì˜ ë¬´ë²•ì", "ì—ì½”": "ë³µì œ", "ìœ„ë„ìš°ë©”ì´ì»¤": "í—¤ë“œìƒ·", "ë©”ì´": "ëˆˆë³´ë¼", "ë¦¬í¼": "ì£½ìŒì˜ ê½ƒ", "ì• ì‰¬": "ë°¥(B.O.B)", "ì†œë¸Œë¼": "EMP", "ì†”ì €: 76": "ì „ìˆ  ì¡°ì¤€ê²½", "íŒŒë¼": "í¬í™”", "ë°”ìŠ¤í‹°ì˜¨": "í¬ê²©", "ë²¤ë°íƒ€": "ê°ˆë¼ë‚´ëŠ” ì¹¼ë‚ ", "ë²¤ì²˜": "ì§€ê° ì¶©ê²©", "ì‹œë©”íŠ¸ë¼": "ê´‘ì ë°©ë²½", "ì •í¬ë«": "ì£½ì´ëŠ” íƒ€ì´ì–´", "í† ë¥´ë¹„ìš˜": "ì´ˆê³ ì—´ ìš©ê´‘ë¡œ", "í”„ë ˆì•¼": "ì˜¬ê°€ë¯¸ ì‚¬ê²©", "í•œì¡°": "ìš©ì˜ ì¼ê²©",
        "ì•„ë‚˜": "ë‚˜ë…¸ ê°•í™”ì œ", "í‚¤ë¦¬ì½”": "ì—¬ìš°ê¸¸", "ë£¨ì‹œìš°": "ì†Œë¦¬ ë°©ë²½", "ë¸Œë¦¬ê¸°í…Œ": "ì§‘ê²°", "ë°”í‹°ìŠ¤íŠ¸": "ì¦í­ ë§¤íŠ¸ë¦­ìŠ¤", "ì£¼ë…¸": "ê¶¤ë„ ê´‘ì„ ", "ì  ì•¼íƒ€": "ì´ˆì›”", "ì¼ë¦¬ì•„ë¦¬": "íƒœì–‘ ì‘ë ¬", "ë¼ì´í”„ìœ„ë²„": "ìƒëª…ì˜ ë‚˜ë¬´", "ëª¨ì´ë¼": "ìœµí™”", "ë©”ë¥´ì‹œ": "ë°œí‚¤ë¦¬", "ìš°ì–‘": "í•´ì¼ í­ë°œ"
    };

    const COMMENTARY_DB = {
        OPENING: [
            "ê±°ì ì´ ì—´ë¦½ë‹ˆë‹¤! ì–‘ íŒ€ ëª¨ë‘ ì¹˜ì—´í•˜ê²Œ ìë¦¬ë¥¼ ì¡ìŠµë‹ˆë‹¤.",
            "ì´ˆë°˜ êµì „, ì„œë¡œ ì‹ ì¤‘í•˜ê²Œ ìŠ¤í‚¬ì„ êµí™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
            "ë¹ ë¥´ê²Œ ì¹˜ê³  ë“¤ì–´ê°€ëŠ” ì„ ê³µ! ë°˜ì‘ ì†ë„ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "íƒ±ì»¤ì§„ì˜ í˜ì‹¸ì›€ì´ ì‹œì‘ë©ë‹ˆë‹¤. ìì¡´ì‹¬ ëŒ€ê²°ì´ë„¤ìš”."
        ],
        MISTAKE: [
            "ì•„, **{player}**ì˜ **{hero}**! **{skill}**ì´ í—ˆê³µì„ ê°€ë¦…ë‹ˆë‹¤! ë¼ˆì•„í”ˆ ì‹¤ìˆ˜ë„¤ìš”.",
            "**{player}** ì„ ìˆ˜, ë„ˆë¬´ ê¹Šê²Œ ë“¤ì–´ê°”ì–´ìš”! ì•„êµ° ì¼€ì–´ë¥¼ ë°›ì§€ ëª»í•˜ê³  ì˜ë¦½ë‹ˆë‹¤.",
            "**{hero}**(**{player}**)ì˜ í¬ì§€ì…˜ì´ ê¼¬ì˜€ìŠµë‹ˆë‹¤. í—ˆë¬´í•˜ê²Œ ì£½ê³  ë§ˆë„¤ìš”.",
            "ë‚™ì‚¬! **{player}** ì„ ìˆ˜ê°€ ë§µì„ ì œëŒ€ë¡œ í™•ì¸í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¶„ìœ„ê¸° ì‹¸í•´ì§€ëŠ”ë°ìš”.",
            "ìŠ¤í‚¬ ì¿¨íƒ€ì„ ê³„ì‚° ë¯¸ìŠ¤ì¸ê°€ìš”? **{player}** ì„ ìˆ˜, ì¤‘ìš”í•  ë•Œ **{skill}**ì´ ì—†ì–´ìš”!"
        ],
        CRACK: [
            "**{player}**ì˜ **{hero}**! ë§ë„ ì•ˆ ë˜ëŠ” í”¼ì§€ì»¬ë¡œ ì „ì¥ì„ íœ©ì“¸ì–´ë²„ë¦½ë‹ˆë‹¤!",
            "ì €ê±¸ ì‚´ì•„ê°€ë‚˜ìš”? ì•„ë‹ˆ, ì˜¤íˆë ¤ **{player}** ì„ ìˆ˜ê°€ ìƒëŒ€ë¥¼ ì¡ì•„ëƒ…ë‹ˆë‹¤! ìŠˆí¼í”Œë ˆì´!",
            "**{hero}**(**{player}**)ì˜ ì™„ë²½í•œ ì—ì„ íŠ¸ë˜í‚¹! ìƒëŒ€ê°€ ìˆ¨ë„ ëª» ì‰¬ê³  ì‚­ì œë©ë‹ˆë‹¤.",
            "ì…ì´ ë‹¤ë¬¼ì–´ì§€ì§€ ì•ŠëŠ” ë³€ìˆ˜ ì°½ì¶œ! **{player}** ì„ ìˆ˜ê°€ ë°”ë¡œ 'í¬ë™'ì…ë‹ˆë‹¤!",
            "**{player}**ì˜ **{hero}**! ë°˜ì‘ì†ë„ë¡œ ìƒëŒ€ ê¶ê·¹ê¸°ë¥¼ **{skill}**ë¡œ ì”¹ì–´ë²„ë¦½ë‹ˆë‹¤! ë¯¸ì³¤ìŠµë‹ˆë‹¤!"
        ],
        TEAMWORK_COMEBACK: [
            "ë¶ˆë¦¬í•œ ìƒí™©, í•˜ì§€ë§Œ ì—„ì²­ë‚œ í•œíƒ€ ì§‘ì¤‘ë ¥ìœ¼ë¡œ ë²„í…¨ëƒ…ë‹ˆë‹¤!",
            "ìƒëŒ€ì˜ ì‹¤ìˆ˜ë¥¼ ë†“ì¹˜ì§€ ì•Šê³  ì™„ë²½í•œ í¬ì»¤ì‹±ìœ¼ë¡œ ì—­ì „ê°ì„ ë´…ë‹ˆë‹¤.",
            "ê¶ê·¹ê¸° ì—°ê³„ê°€ ì˜ˆìˆ ì…ë‹ˆë‹¤! í•œíƒ€ ëŒ€ìŠ¹!",
            "íŒ€í•©ì´ ë¬´ë„ˆì§„ ìƒëŒ€ë¥¼ ê°ê°œê²©íŒŒí•©ë‹ˆë‹¤. ë¶„ìœ„ê¸° ë„˜ì–´ì™”ì–´ìš”!"
        ],
        TEAMWORK_FAIL: [
            "íŒ€ì› ê°„ì˜ ì‚¬ì¸ì´ ì „í˜€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¡œ ë†€ê³  ìˆì–´ìš”.",
            "ê¶ê·¹ê¸°ë¥¼ ì•„ë¼ë‹¤ê°€ í•œíƒ€ê°€ í„°ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤. ì†Œí†µ ë¶€ì¬ë„¤ìš”.",
            "ë°±ì—…ì´ ë„ˆë¬´ ëŠ¦ìŠµë‹ˆë‹¤! ê°ê°œê²©íŒŒ ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤."
        ]
    };

    const sorter = (a, b) => a.n.localeCompare(b.n);
    HEROES.TANK.sort(sorter);
    HEROES.DPS.sort(sorter);
    HEROES.SUP.sort(sorter);

    const ALL_HEROES = [...HEROES.TANK, ...HEROES.DPS, ...HEROES.SUP].map(h=>h.n).sort();
    
    function getHeroRole(name) {
        if(HEROES.TANK.find(h=>h.n===name)) return "TANK";
        if(HEROES.DPS.find(h=>h.n===name)) return "DPS";
        if(HEROES.SUP.find(h=>h.n===name)) return "SUP";
        return "UNKNOWN";
    }

    // CHANGED TO LET FOR SAVE/LOAD OVERWRITE
    let TEAM_DB = {
        "Crazy Raccoon": [
            {n:"Junbin",r:"TANK",a:90,s:98,m:96,t:99,ms:["ìœˆìŠ¤í„´","ë ˆí‚¹ë³¼"]},
            {n:"Max",r:"TANK",a:93,s:95,m:92,t:95,ms:["ì‹œê·¸ë§ˆ","ìë¦¬ì•¼"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Lip",r:"DPS",a:99,s:96,m:98,t:95,ms:["ì†Œì „","ì†œë¸Œë¼"], trait:"ë² í…Œë‘"},
            {n:"HeeSang",r:"DPS",a:96,s:95,m:93,t:96,ms:["íŠ¸ë ˆì´ì„œ","íŒŒë¼"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Sp1nt",r:"DPS",a:94,s:88,m:89,t:87,ms:["ê²ì§€","íŒŒë¼"], trait:"ìœ ë§ì£¼"},
            {n:"Shu",r:"SUP",a:97,s:99,m:98,t:98,ms:["ì•„ë‚˜","ë°”í‹°ìŠ¤íŠ¸"], trait:"ë² í…Œë‘"},
            {n:"Chorong",r:"SUP",a:88,s:99,m:97,t:99,ms:["ë£¨ì‹œìš°","ë¸Œë¦¬ê¸°í…Œ"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"}
        ],
        "Team Falcons": [
            {n:"Someone",r:"TANK",a:92,s:99,m:97,t:98,ms:["ë¼ë§ˆíŠ¸ë¼"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Hanbin",r:"TANK",a:93,s:97,m:98,t:98,ms:["ì •ì»¤í€¸","ë””ë°”"], trait:"ë² í…Œë‘"},
            {n:"Proper",r:"DPS",a:99,s:98,m:96,t:95,ms:["íŠ¸ë ˆì´ì„œ","ê²ì§€"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Mer1t",r:"DPS",a:97,s:94,m:94,t:95,ms:["ì†Œì „","ìºì„œë””"]},
            {n:"Fielder",r:"SUP",a:90,s:99,m:98,t:99,ms:["ì•„ë‚˜","í‚¤ë¦¬ì½”"], trait:"ë² í…Œë‘"},
            {n:"Chiyo",r:"SUP",a:85,s:98,m:98,t:99,ms:["ë£¨ì‹œìš°","ë¸Œë¦¬ê¸°í…Œ"], trait:"ë² í…Œë‘"}
        ],
        "ZETA DIVISION": [
            {n:"Mag",r:"TANK",a:88,s:89,m:88,t:88,ms:["ìœˆìŠ¤í„´","ë¼ì¸í•˜ë¥´íŠ¸"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Bernar",r:"TANK",a:92,s:94,m:94,t:94,ms:["ì˜¤ë¦¬ì‚¬"], trait:"ë² í…Œë‘"},
            {n:"AlphaYi",r:"DPS",a:96,s:94,m:92,t:93,ms:["ê²ì§€","íŠ¸ë ˆì´ì„œ"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Pelican",r:"DPS",a:95,s:95,m:93,t:94,ms:["ì—ì½”","ë©”ì´"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Probe",r:"DPS",a:96,s:85,m:84,t:90,ms:["í”„ë ˆì•¼","ì• ì‰¬"]},
            {n:"Bliss",r:"SUP",a:87,s:95,m:94,t:97,ms:["ë£¨ì‹œìš°","ë¸Œë¦¬ê¸°í…Œ"]},
            {n:"Finn",r:"SUP",a:92,s:92,m:90,t:92,ms:["í‚¤ë¦¬ì½”"]}
        ],
        "T1": [
            {n:"Donghak",r:"TANK",a:87,s:91,m:88,t:91,ms:["ìœˆìŠ¤í„´","ë ˆí‚¹ë³¼"]},
            {n:"Jasm1ne",r:"TANK",a:88,s:91,m:89,t:91,ms:["ìë¦¬ì•¼","ì‹œê·¸ë§ˆ"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Proud",r:"DPS",a:97,s:90,m:90,t:89,ms:["í”„ë ˆì•¼","ì†Œì „"], trait:"ìœ ë§ì£¼"},
            {n:"Zest",r:"DPS",a:94,s:94,m:92,t:93,ms:["íŠ¸ë ˆì´ì„œ","ë²¤ì²˜"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Viper",r:"DPS",a:94,s:89,m:92,t:93,ms:["ê²ì§€"]},
            {n:"Skewed",r:"SUP",a:86,s:95,m:94,t:96,ms:["ë£¨ì‹œìš°","ë¸Œë¦¬ê¸°í…Œ"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Vigilante",r:"SUP",a:93,s:91,m:90,t:91,ms:["ì•„ë‚˜","ì  ì•¼íƒ€"]}
        ],
        "WAE": [
            {n:"Mealgaru",r:"TANK",a:86,s:89,m:88,t:89,ms:["ë ˆí‚¹ë³¼"]},
            {n:"Ade",r:"DPS",a:94,s:88,m:87,t:88,ms:["ì†Œì „","í”„ë ˆì•¼"], trait:"ìœ ë§ì£¼"},
            {n:"SeonJun",r:"DPS",a:89,s:88,m:87,t:88,ms:["íŠ¸ë ˆì´ì„œ","ë²¤ì²˜"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Taejong",r:"DPS",a:92,s:80,m:82,t:85,ms:["íŠ¸ë ˆì´ì„œ"]},
            {n:"Maka",r:"SUP",a:88,s:89,m:88,t:89,ms:["ì•„ë‚˜"]},
            {n:"Leesoomin",r:"SUP",a:88,s:89,m:88,t:89,ms:["í‚¤ë¦¬ì½”"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"}
        ],
        "Onside Gaming": [
            {n:"Attack",r:"TANK",a:87,s:88,m:88,t:89,ms:["ë””ë°”"]},
            {n:"Kellan",r:"TANK",a:89,s:88,m:87,t:89,ms:["ìœˆìŠ¤í„´"]},
            {n:"Knife",r:"DPS",a:93,s:89,m:88,t:89,ms:["íŠ¸ë ˆì´ì„œ"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Ado",r:"DPS",a:85,s:88,m:88,t:89,ms:["ê²ì§€"]},
            {n:"Kilo",r:"DPS",a:90,s:80,m:85,t:87,ms:["í”„ë ˆì•¼","ìºì„œë””"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Opener",r:"SUP",a:80,s:87,m:85,t:88,ms:["ë£¨ì‹œìš°"]},
            {n:"Irony",r:"SUP",a:88,s:87,m:86,t:88,ms:["ì•„ë‚˜"]}
        ],
        "Mir Gaming": [
            {n:"Ruler",r:"TANK",a:88,s:87,m:86,t:87,ms:["ìë¦¬ì•¼"], trait:"ìœ ë§ì£¼"},
            {n:"Azent",r:"DPS",a:90,s:87,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ","ê²ì§€"]},
            {n:"K4ne",r:"DPS",a:86,s:87,m:88,t:86,ms:["ë¦¬í¼"]},
            {n:"Flos",r:"DPS",a:88,s:87,m:88,t:86,ms:["ì†Œì „"]},
            {n:"Mcd",r:"SUP",a:82,s:88,m:85,t:88,ms:["ì  ì•¼íƒ€"], trait:"ë² í…Œë‘"},
            {n:"Univ2r",r:"SUP",a:87,s:88,m:85,t:88,ms:["í‚¤ë¦¬ì½”"]}
        ],
        "Old Ocean": [
            {n:"Gur3um",r:"TANK",a:86,s:89,m:88,t:89,ms:["í•´ì €ë“œ","ë””ë°”"]},
            {n:"Heiser",r:"TANK",a:86,s:89,m:88,t:89,ms:["ìœˆìŠ¤í„´","ë ˆí‚¹ë³¼"], trait:"ìœ ë§ì£¼"},
            {n:"A1ien",r:"DPS",a:90,s:88,m:88,t:86,ms:["ìœ„ë„ìš°ë©”ì´ì»¤","í•œì¡°"]},
            {n:"D4rt",r:"DPS",a:86,s:87,m:88,t:86,ms:["ë¦¬í¼"]},
            {n:"Becky",r:"DPS",a:91,s:87,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ","ê²ì§€"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Ryujehong",r:"SUP",a:85,s:92,m:90,t:90,ms:["ì•„ë‚˜","ë¼ì´í”„ìœ„ë²„"], trait:"ë² í…Œë‘"},
            {n:"Kivis",r:"SUP",a:91,s:86,m:85,t:88,ms:["í‚¤ë¦¬ì½”"], trait:"ìœ ë§ì£¼"}
        ],
        "Cheeseburger": [
            {n:"Farmer",r:"TANK",a:87,s:87,m:86,t:87,ms:["ìœˆìŠ¤í„´"]},
            {n:"SeungAn",r:"TANK",a:87,s:87,m:86,t:87,ms:["ì‹œê·¸ë§ˆ"]},
            {n:"Argon",r:"DPS",a:88,s:86,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ"]},
            {n:"D0d0",r:"DPS",a:88,s:86,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ"], trait:"ìœ ë§ì£¼"},
            {n:"Zesin",r:"DPS",a:88,s:86,m:86,t:87,ms:["í”„ë ˆì•¼"]},
            {n:"Woochan",r:"SUP",a:86,s:86,m:85,t:88,ms:["ì•„ë‚˜"]},
            {n:"Faith",r:"SUP",a:86,s:86,m:85,t:88,ms:["ë¸Œë¦¬ê¸°í…Œ"]}
        ]
    };
    const MAP_META = {
        "ì‚¬ëª¨ì•„": { type: "Rush", good: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë©”ì´", "ë£¨ì‹œìš°", "ì‹œë©”íŠ¸ë¼"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤", "ì‹œê·¸ë§ˆ"] },
        "ì˜¤ì•„ì‹œìŠ¤": { type: "Rush", good: ["ë¦¬í¼", "ì •ì»¤í€¸", "ë£¨ì‹œìš°"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤"] },
        "ì¼ë¦¬ì˜¤ìŠ¤": { type: "Control", good: ["ë¡œë“œí˜¸ê·¸", "ì˜¤ë¦¬ì‚¬", "ë£¨ì‹œìš°", "íŒŒë¼"], bad: [] },
        "ë¶€ì‚°": { type: "Dive", good: ["ìœˆìŠ¤í„´", "íŠ¸ë ˆì´ì„œ", "ì†œë¸Œë¼"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸"] },
        "ì™•ì˜ ê¸¸": { type: "Rush", good: ["ë¼ì¸í•˜ë¥´íŠ¸", "ìë¦¬ì•¼", "ë©”ì´", "í•œì¡°"], bad: ["ìœˆìŠ¤í„´", "ë³¼"] },
        "í• ë¦¬ìš°ë“œ": { type: "Hybrid", good: ["ì‹œê·¸ë§ˆ", "ì†Œì „", "ì• ì‰¬"], bad: [] },
        "ì•„ì´í—¨ë°œë°": { type: "Rush", good: ["ë¼ì¸í•˜ë¥´íŠ¸", "íŒŒë¼", "ë°”ìŠ¤í‹°ì˜¨"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤"] },
        "ìˆ˜ë¼ë°”ì‚¬": { type: "Dive", good: ["ìœˆìŠ¤í„´", "ë‘ í”¼ìŠ¤íŠ¸", "ë£¨ì‹œìš°", "í‚¤ë¦¬ì½”"], bad: ["ì‹œê·¸ë§ˆ", "ë¡œë“œí˜¸ê·¸"] },
        "ì•„í‹€ë¦¬ìŠ¤": { type: "Flashpoint", good: ["ì •ì»¤í€¸", "íŠ¸ë ˆì´ì„œ", "ë£¨ì‹œìš°"], bad: [] },
        "ë‰´ í€¸ ìŠ¤íŠ¸ë¦¬íŠ¸": { type: "Push", good: ["íŠ¸ë ˆì´ì„œ", "ì†Œì „", "ë£¨ì‹œìš°", "í‚¤ë¦¬ì½”"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸"] },
        "ì—ìŠ¤í˜ë€ì‚¬": { type: "Dive", good: ["ìœˆìŠ¤í„´", "íŠ¸ë ˆì´ì„œ", "ì†Œì „"], bad: ["ë¡œë“œí˜¸ê·¸"] },
        "ì“°ë ˆê¸°ì´Œ": { type: "Poke", good: ["ì‹œê·¸ë§ˆ", "ìœ„ë„ìš°ë©”ì´ì»¤", "ì†Œì „", "ë°”í‹°ìŠ¤íŠ¸", "ì  ì•¼íƒ€"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë¦¬í¼", "ë©”ì´"] },
        "ê°ì‹œ ê¸°ì§€: ì§€ë¸Œë¡¤í„°": { type: "Dive", good: ["ìœˆìŠ¤í„´", "ë””ë°”", "ê²ì§€", "ì—ì½”"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ìë¦¬ì•¼"] },
        "ë¦¬ì•Œí† ": { type: "Poke", good: ["ì• ì‰¬", "ìºì„œë””", "ì‹œê·¸ë§ˆ"], bad: [] }
    };
    const MAP_POOLS = {
        "ìŸíƒˆ": ["ì‚¬ëª¨ì•„","ì˜¤ì•„ì‹œìŠ¤","ì¼ë¦¬ì˜¤ìŠ¤","ë¶€ì‚°"],
        "í˜¼í•©": ["ì™•ì˜ ê¸¸","í• ë¦¬ìš°ë“œ","ì•„ì´í—¨ë°œë°"],
        "í”Œë˜ì‹œ": ["ìˆ˜ë¼ë°”ì‚¬","ì•„í‹€ë¦¬ìŠ¤"],
        "ë°€ê¸°": ["ë‰´ í€¸ ìŠ¤íŠ¸ë¦¬íŠ¸","ì—ìŠ¤í˜ë€ì‚¬"],
        "í˜¸ìœ„": ["ì“°ë ˆê¸°ì´Œ","ê°ì‹œ ê¸°ì§€: ì§€ë¸Œë¡¤í„°","ë¦¬ì•Œí† "]
    };

    // --- STATE ---
    let myTeam = ""; 
    let leagueStats = {};
    let schedule = [];
    let currentWeek = 1; 
    let currentDayStep = 0; 
    let seasonState = "REGULAR";
    let seasonCount = 1;

    let currentMatch = null; 
    let setScores = [0, 0];
    let currentSet = 1;
    let currentMap = "";
    let bans = {my:[], opp:[]};
    let lastBanRole = { my: null, opp: null };
    
    let myLockedPlayers = []; 
    let oppLockedPlayers = []; 
    let myHeroPicks = [];
    let oppHeroPicks = [];
    let playedMaps = [];
    
    let playerSetCounts = {}; 

    let setWinner = -1; 
    let playoffMatches = {};

    window.onload = function() {
        Object.values(TEAM_DB).forEach(roster => {
            roster.forEach(p => { 
                p.hp = 100; 
                p.practiceProgress = {}; 
                p.potm = 0; 
            });
        });

        const btnBox = document.getElementById('team-buttons');
        Object.keys(TEAM_DB).forEach(t => {
            let btn = document.createElement('button');
            btn.className = 'team-btn';
            btn.innerText = t;
            btn.onclick = () => selectTeam(t);
            btnBox.appendChild(btn);
        });

        // CHECK SAVE
        if(localStorage.getItem("owcs_save_v1")) {
            document.getElementById('load-btn-start').style.display = 'block';
        }
    };

    // --- SAVE & LOAD SYSTEM ---
    function saveGame() {
        if(!myTeam) return;
        const saveData = {
            myTeam, seasonCount, currentWeek, currentDayStep, seasonState,
            leagueStats, schedule, TEAM_DB, playoffMatches, currentMatch
        };
        localStorage.setItem("owcs_save_v1", JSON.stringify(saveData));
        alert("ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function loadGame() {
        const dataStr = localStorage.getItem("owcs_save_v1");
        if(!dataStr) { alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
        
        const data = JSON.parse(dataStr);
        myTeam = data.myTeam;
        seasonCount = data.seasonCount;
        currentWeek = data.currentWeek;
        currentDayStep = data.currentDayStep;
        seasonState = data.seasonState;
        leagueStats = data.leagueStats;
        schedule = data.schedule;
        TEAM_DB = data.TEAM_DB; // Overwrite DB
        playoffMatches = data.playoffMatches;
        currentMatch = data.currentMatch;

        document.getElementById('start-screen').style.display = 'none';
        
        // RE-INIT UI
        const pSel = document.getElementById('train-p-select');
        const hSel = document.getElementById('train-h-select');
        pSel.innerHTML = "";
        TEAM_DB[myTeam].forEach(p => {
             let op = document.createElement('option');
             op.value = p.n; op.innerText = p.n;
             pSel.appendChild(op);
        });
        hSel.innerHTML = "";
        ALL_HEROES.forEach(h => {
             let op = document.createElement('option');
             op.value = h; op.innerText = h;
             hSel.appendChild(op);
        });

        updateRoundUI();
        updateStandings();
        log(`[SYSTEM] ê²Œì„ ë¡œë“œ ì™„ë£Œ. (Season ${seasonCount})`);
    }

    function resetGame() {
        if(confirm("ì €ì¥ëœ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem("owcs_save_v1");
            location.reload();
        }
    }

    function selectTeam(t) {
        myTeam = t;
        document.getElementById('start-screen').style.display = 'none';
        initLeague();
    }

    function initLeague() {
        Object.keys(TEAM_DB).forEach(t => leagueStats[t] = {w:0, l:0, d:0, name:t});
        schedule = [];
        generateSchedule();
        
        const pSel = document.getElementById('train-p-select');
        const hSel = document.getElementById('train-h-select');
        pSel.innerHTML = "";
        TEAM_DB[myTeam].forEach(p => {
             let op = document.createElement('option');
             op.value = p.n; op.innerText = p.n;
             pSel.appendChild(op);
        });
        hSel.innerHTML = "";
        ALL_HEROES.forEach(h => {
             let op = document.createElement('option');
             op.value = h; op.innerText = h;
             hSel.appendChild(op);
        });

        updateRoundUI();
        updateStandings();
        log(`== SEASON ${seasonCount} START ==`);
        log(`ê°ë…ë‹˜, ${myTeam}ì˜ ${seasonCount}ë²ˆì§¸ ì‹œì¦Œì´ ì‹œì‘ë©ë‹ˆë‹¤.`);
    }

    // --- UTILS & CORE ---
    function getCurrentOpponentName() {
        if (seasonState === "REGULAR") {
            if(!currentMatch) return null;
            return (currentMatch.h === myTeam) ? currentMatch.a : currentMatch.h;
        } else if (seasonState === "POST_SEMI") {
            if (!playoffMatches.semiA) return null;
            if (playoffMatches.semiA.h === myTeam) return playoffMatches.semiA.a;
            if (playoffMatches.semiA.a === myTeam) return playoffMatches.semiA.h;
            if (playoffMatches.semiB.h === myTeam) return playoffMatches.semiB.a;
            return playoffMatches.semiB.h;
        } else if (seasonState === "POST_FINAL") {
            if (!playoffMatches.final) return null;
            return (playoffMatches.final.h === myTeam) ? playoffMatches.final.a : playoffMatches.final.h;
        }
        return null;
    }

    function toggleModal(id) {
        if(!myTeam) return;
        const m = document.getElementById(id);
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
    }
    function toggleRoster() {
        if(!myTeam) return;
        toggleModal('roster-modal');
        const content = document.getElementById('roster-content');
        const players = TEAM_DB[myTeam];
        let html = "";
        players.forEach(p => {
            let msStr = p.ms.join(", ");
            let hpColor = p.hp > 80 ? '#2ecc71' : (p.hp > 50 ? '#f1c40f' : '#e74c3c');
            html += `<div class="player-card">
                    <div style="font-weight:bold; color:var(--ow-orange); font-size:1.2em;">${p.n}</div>
                    <div class="stat-bars">
                        <div>AIM: <span class="stat-val">${p.a}</span></div>
                        <div>SEN: <span class="stat-val">${p.s}</span></div>
                        <div>MEN: <span class="stat-val">${p.m}</span></div>
                        <div>TEAM: <span class="stat-val">${p.t}</span></div>
                        <div>HP: <span class="hp-val" style="color:${hpColor}">${p.hp}%</span></div>
                    </div>
                    <div style="text-align:right; font-size:0.85em; color:#ccc;">
                        <div>${p.r}</div>
                        <div style="color:var(--accent);">â˜… ${msStr}</div>
                    </div>
                </div>`;
        });
        content.innerHTML = html;
    }
    function togglePOTM() {
        if(!myTeam) return;
        toggleModal('potm-modal');
        const content = document.getElementById('potm-content');
        let allPlayers = [];
        Object.keys(TEAM_DB).forEach(tName => {
            TEAM_DB[tName].forEach(p => allPlayers.push({ ...p, team: tName }));
        });
        allPlayers.sort((a,b) => b.potm - a.potm || b.a - a.a);
        let html = "";
        allPlayers.forEach((p, i) => {
            if(p.potm > 0 || i < 10) { 
                let rankClass = (i===0) ? 'potm-rank-1' : '';
                html += `<div class="potm-row"><div class="${rankClass}">${i+1}</div><div class="${rankClass}">${p.n}</div><div style="font-size:0.8em; color:#888;">${p.team}</div><div><span class="potm-count">${p.potm}</span></div></div>`;
            }
        });
        content.innerHTML = html;
    }

    function generateSchedule() {
        let teams = Object.keys(TEAM_DB);
        let n = teams.length; 
        for(let r=0; r<n; r++) schedule.push(makeRoundPairing(teams, r));
    }
    function makeRoundPairing(teams, roundNum) {
        let shifted = [...teams];
        for(let k=0; k<roundNum; k++) shifted.unshift(shifted.pop());
        let matches = [];
        for(let i=1; i<5; i++) matches.push({h: shifted[i], a: shifted[9-i]});
        return matches;
    }

    function updateRoundUI() {
        if (seasonState !== "REGULAR") { handlePostSeasonUI(); return; }
        if (currentDayStep === 0) {
            document.getElementById('round-display').innerText = `SEASON ${seasonCount} / WEEK ${currentWeek} - TRAINING`;
            document.getElementById('match-subtitle').innerText = "í›ˆë ¨ ë° ì •ë¹„ ì‹œê°„";
            document.getElementById('match-title').innerText = "TEAM MANAGEMENT";
            document.getElementById('train-desc-txt').innerText = "ì´ë²ˆ ì£¼ ê²½ê¸°ë¥¼ ìœ„í•´ í›ˆë ¨ ì¼ì •ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤.";
            switchPhase('ui-training');
            return;
        }
        const daysText = ["", "Friday", "Saturday", "Sunday"];
        const dayTxt = daysText[currentDayStep];
        const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
        document.getElementById('round-display').innerText = `SEASON ${seasonCount} / WEEK ${currentWeek} - ${dayTxt}`;
        document.getElementById('match-subtitle').innerText = `Round ${roundIdx + 1} / 9`;
        const myM = schedule[roundIdx].find(m => m.h === myTeam || m.a === myTeam);
        if (myM) {
            currentMatch = myM;
            const opp = (myM.h === myTeam) ? myM.a : myM.h;
            document.getElementById('match-title').innerText = `VS ${opp}`;
            document.getElementById('next-match-info').innerText = "ë§¤ì¹˜ ì¤€ë¹„ ì™„ë£Œ";
            document.getElementById('lobby-desc').innerText = "Bo5 ì •ê·œ ë¦¬ê·¸ ê²½ê¸°ì…ë‹ˆë‹¤.";
            document.getElementById('btn-start-match').innerText = "ê²½ê¸° ì‹œì‘";
            document.getElementById('btn-start-match').onclick = startMatchSequence;
            document.getElementById('btn-start-match').disabled = false;
        } else {
            currentMatch = null;
            document.getElementById('match-title').innerText = "BYE DAY (íœ´ì‹)";
            document.getElementById('next-match-info').innerText = "ê²½ê¸° ì¼ì • ì—†ìŒ";
            document.getElementById('lobby-desc').innerText = "ì˜¤ëŠ˜ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ìë™ ì§„í–‰ë©ë‹ˆë‹¤ (ì²´ë ¥ ì†Œí­ íšŒë³µ).";
            document.getElementById('btn-start-match').innerText = "íœ´ì‹ ì§„í–‰";
            document.getElementById('btn-start-match').onclick = simByeRound; 
            document.getElementById('btn-start-match').disabled = false;
        }
        switchPhase('ui-lobby');
    }

    function updateStandings() {
        const tbody = document.getElementById('standings-body');
        if(!tbody || Object.keys(leagueStats).length === 0) return;
        tbody.innerHTML = "";
        const sorted = Object.values(leagueStats).sort((a,b) => b.w - a.w || b.d - a.d);
        let html = "";
        sorted.forEach((s, i) => {
            html += `<tr class="${s.name === myTeam ? 'my-team-row' : ''}"><td>${i+1}</td><td>${s.name}</td><td>${s.w}</td><td>${s.l}</td><td>${s.d}</td></tr>`;
        });
        tbody.innerHTML = html;
    }

    function handlePostSeasonUI() {
        if (seasonState === "POST_BUFFER") {
            document.getElementById('round-display').innerText = "POST SEASON PREP";
            document.getElementById('match-subtitle').innerText = "ì‹œë“œ ê²°ì •ì „ ì „ë‚ ";
            document.getElementById('match-title').innerText = "EXTRA TRAINING";
            switchPhase('ui-training');
        } else if (seasonState === "POST_SEED") {
            setupPlayoffs();
        } else if (seasonState === "POST_SEMI") {
            document.getElementById('round-display').innerText = "PLAYOFFS - SATURDAY";
            document.getElementById('match-subtitle').innerText = "SEMIFINALS";
            if (playoffMatches.semiA.h === myTeam || playoffMatches.semiA.a === myTeam || 
                playoffMatches.semiB.h === myTeam || playoffMatches.semiB.a === myTeam) {
                let opp = (playoffMatches.semiA.h === myTeam) ? playoffMatches.semiA.a : 
                          (playoffMatches.semiA.a === myTeam) ? playoffMatches.semiA.h : 
                          (playoffMatches.semiB.h === myTeam) ? playoffMatches.semiB.a : playoffMatches.semiB.h;
                document.getElementById('match-title').innerText = `VS ${opp}`;
                document.getElementById('btn-start-match').innerText = "4ê°•ì „ ì‹œì‘";
                document.getElementById('btn-start-match').onclick = startMatchSequence;
            } else {
                document.getElementById('match-title').innerText = "ELIMINATED";
                document.getElementById('lobby-desc').innerText = "4ê°• ì§„ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                document.getElementById('btn-start-match').onclick = prepareNextSeason; 
            }
            switchPhase('ui-lobby');
        } else if (seasonState === "POST_FINAL") {
            document.getElementById('round-display').innerText = "PLAYOFFS - SUNDAY";
            document.getElementById('match-subtitle').innerText = "GRAND FINALS";
            if (playoffMatches.final.h === myTeam || playoffMatches.final.a === myTeam) {
                 let opp = (playoffMatches.final.h === myTeam) ? playoffMatches.final.a : playoffMatches.final.h;
                 document.getElementById('match-title').innerText = `FINAL VS ${opp}`;
                 document.getElementById('lobby-desc').innerText = "ê²°ìŠ¹ì „ (Bo7)"; 
                 document.getElementById('btn-start-match').innerText = "ê²°ìŠ¹ì „ ì‹œì‘";
                 document.getElementById('btn-start-match').onclick = startMatchSequence;
            } else {
                 document.getElementById('match-title').innerText = "SEASON FINALE";
                 document.getElementById('lobby-desc').innerText = "ì´ë²ˆ ì‹œì¦Œì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                 document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                 document.getElementById('btn-start-match').onclick = prepareNextSeason;
            }
            switchPhase('ui-lobby');
        }
    }

    function prepareNextSeason() {
        if(confirm("ì´ë²ˆ ì‹œì¦Œì„ ì¢…ë£Œí•˜ê³  ë‹¤ìŒ ì‹œì¦Œì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì„ ìˆ˜ ëŠ¥ë ¥ì¹˜ëŠ” ìœ ì§€ë©ë‹ˆë‹¤)")) {
            seasonCount++;
            currentWeek = 1;
            currentDayStep = 0;
            seasonState = "REGULAR";
            initLeague();
        }
    }

    function runTraining(type) {
        const roster = TEAM_DB[myTeam];
        const chance = () => Math.random() < 0.1;

        if(type === 'REST') { 
            recoverAllStamina(30); 
            log("ì „ì› íœ´ì‹ ì™„ë£Œ. ì²´ë ¥ +30"); 
        } 
        else if(type === 'HERO') {
            const pName = document.getElementById('train-p-select').value;
            const hName = document.getElementById('train-h-select').value;
            const player = roster.find(p=>p.n === pName);
            
            if(!player.practiceProgress[hName]) player.practiceProgress[hName] = 0;
            player.practiceProgress[hName]++;
            let count = player.practiceProgress[hName];
            
            let req = (player.trait === "ë‹¤ì¬ë‹¤ëŠ¥") ? 2 : 3;

            if(count >= req) {
                if(!player.ms.includes(hName)) { player.ms.push(hName); log(`[ê²½ì¶•] ${pName} ì„ ìˆ˜ ${hName} ëª¨ìŠ¤íŠ¸ ë“±ë¡!`); }
                else log(`${pName} ì„ ìˆ˜ëŠ” ì´ë¯¸ ${hName} ì¥ì¸ì…ë‹ˆë‹¤.`);
            } else log(`${pName}: ${hName} ì—°ìŠµ ì™„ë£Œ (${count}/${req})`);
            
            recoverAllStamina(10);
        } else {
            let statMap = {'AIM':'a', 'SENSE':'s', 'MENTAL':'m', 'TEAM':'t'};
            let traitMap = {'AIM':'ìœ ë§ì£¼', 'SENSE':'ë² í…Œë‘', 'MENTAL':'ì†Œë…„ê°€ì¥', 'TEAM':'ë¶„ìœ„ê¸°ë©”ì´ì»¤'};
            
            let key = statMap[type];
            let targetTrait = traitMap[type];
            let bonusMsg = "";

            roster.forEach(p => {
                let gain = 1;
                if(p.trait === targetTrait && chance()) {
                    gain = 2;
                    bonusMsg = ` (${p.n} íŠ¹ì„± ë°œë™!)`;
                }
                if(p[key] < 99) p[key] = Math.min(99, p[key] + gain);
            });
            
            recoverAllStamina(10);
            log(`[í›ˆë ¨] íŒ€ ì „ì²´ ${type} í›ˆë ¨ ì™„ë£Œ.${bonusMsg} ì²´ë ¥ +10`);
        }
        if (seasonState === "REGULAR") currentDayStep = 1; 
        else if (seasonState === "POST_BUFFER") seasonState = "POST_SEED"; 
        else if (seasonState === "POST_SEED_TRAIN") { runSeedMatchesSimOnly(); seasonState = "POST_SEMI"; }
        updateRoundUI();
    }

    function simByeRound() {
        const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
        schedule[roundIdx].forEach(m => {
            if (m.h !== myTeam && m.a !== myTeam) {
                let s1 = Math.floor(Math.random()*4);
                let s2 = s1===3 ? Math.floor(Math.random()*3) : 3;
                let winner = s1 > s2 ? m.h : m.a;
                calcMatchPOTM(winner);
                recordStats(m.h, m.a, s1, s2);
            }
        });
        recoverAllStamina(5);
        log(`[íœ´ì‹ì¼] ìë™ ì§„í–‰ ì™„ë£Œ. ì²´ë ¥ +5 íšŒë³µ.`);
        advanceDay();
    }

    function advanceDay() {
        if (seasonState === "REGULAR") {
            currentDayStep++;
            if (currentDayStep > 3) {
                currentWeek++;
                currentDayStep = 0; 
                if (currentWeek > 3) {
                    seasonState = "POST_BUFFER";
                    currentDayStep = 0; 
                    log("ì •ê·œ ì‹œì¦Œ ì¢…ë£Œ! í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì¤€ë¹„.");
                }
            }
        }
        updateRoundUI();
        updateStandings();
    }

    function startMatchSequence() {
        setScores = [0, 0];
        currentSet = 1;
        bans = {my:[], opp:[]};
        lastBanRole = { my: null, opp: null }; 
        playedMaps = [];
        playerSetCounts = {}; // Reset participation
        
        if(seasonState === "REGULAR") {
            const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
            schedule[roundIdx].forEach(m => {
                if (m.h !== myTeam && m.a !== myTeam) {
                    let s1 = Math.floor(Math.random()*4);
                    let s2 = s1===3 ? Math.floor(Math.random()*3) : 3;
                    let winner = s1 > s2 ? m.h : m.a;
                    calcMatchPOTM(winner);
                    recordStats(m.h, m.a, s1, s2);
                }
            });
        }
        updateScoreBoard();
        startSet();
    }

    function calcMatchPOTM(winnerTeam) {
        if(!TEAM_DB[winnerTeam]) return "Unknown";
        const roster = TEAM_DB[winnerTeam];
        let bestScore = -1;
        let bestPlayer = null;
        
        let candidates = roster;
        if (winnerTeam === myTeam && Object.keys(playerSetCounts).length > 0) {
             candidates = roster.filter(p => playerSetCounts[p.n] > 0);
        }

        candidates.forEach(p => {
            let setBonus = (winnerTeam === myTeam) ? (playerSetCounts[p.n] || 0) * 5 : 0;
            let score = (p.a + p.s + p.m + p.t) + (Math.random() * 50) + setBonus; 
            if(score > bestScore) { bestScore = score; bestPlayer = p; }
        });
        
        if(bestPlayer) { bestPlayer.potm++; return bestPlayer.n; }
        return "Unknown";
    }

    function startSet() {
        let maxSets = (seasonState === 'POST_FINAL') ? 7 : 5;
        document.getElementById('set-score-txt').innerText = `SET ${currentSet} (Bo${maxSets})`;
        bans = {my:[], opp:[]}; 
        
        switchPhase('ui-map');
        const modes = ["ìŸíƒˆ","í˜¼í•©","í”Œë˜ì‹œ","ë°€ê¸°","í˜¸ìœ„"];
        let modeIndex = (currentSet - 1) % 5;
        const mode = modes[modeIndex];
        const selector = document.getElementById('map-select');
        selector.innerHTML = "";
        
        let userPicks = (currentSet === 1 || setWinner === 1);
        let pool = MAP_POOLS[mode].filter(m => !playedMaps.includes(m));
        if(pool.length === 0) pool = MAP_POOLS[mode]; 

        if(userPicks) {
            document.getElementById('map-msg').innerText = `[íŒ¨ì ì„ íƒê¶Œ] ${mode} ë§µì„ ì„ íƒí•˜ì‹­ì‹œì˜¤.`;
            pool.forEach(m => selector.innerHTML += `<option>${m}</option>`);
            document.querySelector('#ui-map button').disabled = false;
        } else {
            let aiMap = pool[Math.floor(Math.random()*pool.length)];
            currentMap = aiMap;
            document.getElementById('map-msg').innerText = `ìƒëŒ€íŒ€ì´ ${aiMap}ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.`;
            selector.innerHTML = `<option>${aiMap}</option>`;
            document.querySelector('#ui-map button').disabled = true;
            setTimeout(confirmMap, 1500);
        }
    }

    function confirmMap() {
        if(!document.querySelector('#ui-map button').disabled) currentMap = document.getElementById('map-select').value;
        playedMaps.push(currentMap);
        log(`[MAP] ${currentSet}ì„¸íŠ¸ ì „ì¥: ${currentMap}`);
        setupRosterCheck();
    }

    function setupRosterCheck() {
        switchPhase('ui-roster');
        let meta = MAP_META[currentMap] || {type:"General", good:[], bad:[]};
        document.getElementById('map-meta-roster').innerHTML = `Map Type: <strong>${meta.type}</strong>`;
        const el = document.getElementById('roster-slots');
        el.innerHTML = "";
        const roles = ["TANK","DPS","DPS","SUP","SUP"];
        const myRoster = TEAM_DB[myTeam];
        roles.forEach((r, i) => {
            let pSel = `<select id="rp${i}">`;
            myRoster.filter(p=>p.r===r).forEach(p => pSel += `<option value="${p.n}">${p.n} (${p.hp}%)</option>`);
            pSel += `</select>`;
            el.innerHTML += pSel;
        });
        document.getElementById('roster-opp-display').innerText = "(Waiting for your confirmation...)";
    }

    function confirmRoster() {
        myLockedPlayers = [];
        for(let i=0; i<5; i++) {
            let val = document.getElementById(`rp${i}`).value;
            if(myLockedPlayers.includes(val)) { alert("ì¤‘ë³µ ì„ ìˆ˜!"); return; }
            myLockedPlayers.push(val);
        }
        
        generateOpponentPlayers();
        let oppHtml = "";
        oppLockedPlayers.forEach(p => {
            oppHtml += `<div style="background:#333; margin:5px; padding:5px; border-radius:4px;">${p.n} <span style="font-size:0.8em; color:#888;">(${p.r})</span></div>`;
        });
        document.getElementById('roster-opp-display').innerHTML = oppHtml;
        log("[LINEUP] ì–‘ íŒ€ ë¡œìŠ¤í„° í™•ì •.");
        setTimeout(setupHeroBan, 1500);
    }

    function generateOpponentPlayers() {
        let oppTeamName = getCurrentOpponentName();
        if(!oppTeamName || !TEAM_DB[oppTeamName]) {
            let allTeams = Object.keys(TEAM_DB).filter(t => t !== myTeam);
            oppTeamName = allTeams[0];
        }

        const oppRoster = TEAM_DB[oppTeamName];
        const roles = ["TANK","DPS","DPS","SUP","SUP"];
        oppLockedPlayers = []; 
        let usedPlayers = [];
        roles.forEach(r => {
            let availablePlayers = oppRoster.filter(p => p.r === r && !usedPlayers.includes(p.n));
            if(availablePlayers.length === 0) availablePlayers = oppRoster.filter(p => p.r === r);
            let pickP = availablePlayers[Math.floor(Math.random()*availablePlayers.length)];
            usedPlayers.push(pickP.n);
            oppLockedPlayers.push(pickP);
        });
    }

    function setupHeroBan() {
        switchPhase('ui-ban');
        let oppListHtml = "";
        oppLockedPlayers.forEach(p => oppListHtml += `<div>${p.n}</div>`);
        document.getElementById('ban-phase-opp-list').innerHTML = oppListHtml;
        const s = document.getElementById('ban-select');
        s.innerHTML = "";
        
        if(lastBanRole.my) log(`[BAN RULE] ì´ë²ˆ ì„¸íŠ¸ ìš°ë¦¬ íŒ€ì€ '${lastBanRole.my}' ë°´ ë¶ˆê°€.`);
        
        ["TANK","DPS","SUP"].forEach(r => {
            if (lastBanRole.my === r) return; 
            HEROES[r].forEach(h => {
                if(!bans.my.includes(h.n)) s.innerHTML += `<option value="${h.n}">[${r}] ${h.n}</option>`;
            });
        });
        document.getElementById('opp-ban-display').innerText = "-";
    }

    function confirmBan() {
        let mb = document.getElementById('ban-select').value;
        bans.my.push(mb);
        let myRole = getHeroRole(mb);
        lastBanRole.my = myRole; 
        
        let pool = [];
        ["TANK","DPS","SUP"].forEach(r => {
            if(r === myRole) return; 
            if(r === lastBanRole.opp) return; 
            HEROES[r].forEach(h => { if(!bans.opp.includes(h.n)) pool.push(h.n); });
        });
        
        if(pool.length === 0) {
             ["TANK","DPS","SUP"].forEach(r => {
                if(r === myRole) return;
                HEROES[r].forEach(h => { if(!bans.opp.includes(h.n)) pool.push(h.n); });
            });
        }

        let ab = pool[Math.floor(Math.random()*pool.length)];
        bans.opp.push(ab);
        lastBanRole.opp = getHeroRole(ab);
        
        document.getElementById('opp-ban-display').innerText = `ğŸš« ${ab}`;
        log(`[BAN] My: ${mb} | Opp: ${ab}`);
        setTimeout(setupHeroPick, 1000);
    }

    function setupHeroPick() {
        switchPhase('ui-pick');
        const el = document.getElementById('pick-slots');
        el.innerHTML = "";
        myLockedPlayers.forEach((pName, i) => {
            let pObj = TEAM_DB[myTeam].find(p=>p.n===pName);
            let role = pObj.r;
            let html = `<div style="margin-bottom:10px;">
                <div style="font-weight:bold; color:var(--ow-orange);">${pName} (${role})</div>
                <select id="hpick${i}">`;
            
            HEROES[role].filter(h => !bans.my.includes(h.n) && !bans.opp.includes(h.n)).forEach(h => {
                html += `<option value="${h.n}">${h.n}</option>`;
            });

            html += `</select></div>`;
            el.innerHTML += html;
        });
        generateOpponentHeroes();
    }

    function generateOpponentHeroes() {
        oppHeroPicks = [];
        let usedHeroes = [];
        oppLockedPlayers.forEach(p => {
            let role = p.r;
            let availableHeroes = HEROES[role].filter(h => !bans.opp.includes(h.n) && !bans.my.includes(h.n) && !usedHeroes.includes(h.n));
            if(availableHeroes.length === 0) availableHeroes = HEROES[role].filter(h => !bans.opp.includes(h.n) && !bans.my.includes(h.n)); 

            let pickH = availableHeroes[Math.floor(Math.random()*availableHeroes.length)];
            if(!pickH) pickH = HEROES[role][0];

            usedHeroes.push(pickH.n);
            oppHeroPicks.push({ player: p, hero: pickH.n });
        });
        const disp = document.getElementById('opp-entry-display');
        disp.innerHTML = "";
        oppLockedPlayers.forEach(p => {
            disp.innerHTML += `<div class="opp-card"><div>${p.n}</div><div class="opp-hero hidden">?????</div></div>`;
        });
    }

    function runSimulation() {
        let myHs = [];
        for(let i=0; i<5; i++) {
            let h = document.getElementById(`hpick${i}`).value;
            if(myHs.includes(h)) { alert("ì¤‘ë³µ ì˜ì›… ë¶ˆê°€!"); return; }
            myHs.push(h);
        }
        const disp = document.getElementById('opp-entry-display');
        disp.innerHTML = "";
        oppHeroPicks.forEach(o => {
            disp.innerHTML += `<div class="opp-card"><div>${o.player.n}</div><div class="opp-hero" style="color:var(--ban-red);">${o.hero}</div></div>`;
        });
        
        let meta = MAP_META[currentMap] || {type:"General", good:[], bad:[]};
        let logEvents = []; 
        
        function calcTeamPower(playerNames, heroes, isMyTeam) {
            let totalPower = 0;
            let teamAvgTeamwork = 0;
            let teamCompCount = 0;

            let players = [];
            if(isMyTeam) players = playerNames.map(n => TEAM_DB[myTeam].find(p=>p.n===n));
            else players = playerNames.map(o => o.player);

            let moodMakerCount = players.filter(p => p.trait === "ë¶„ìœ„ê¸°ë©”ì´ì»¤").length;
            let mistakeReduction = moodMakerCount * 0.5;

            let myScore = isMyTeam ? setScores[0] : setScores[1];
            let oppScore = isMyTeam ? setScores[1] : setScores[0];
            let isBehind = myScore < oppScore;

            players.forEach((p, idx) => {
                let hName = isMyTeam ? heroes[idx] : heroes[idx].hero;
                
                let bonus = (p.trait === "ì†Œë…„ê°€ì¥" && isBehind) ? 2 : 0;
                let t_a = p.a + bonus; 
                let t_s = p.s + bonus; 
                let t_m = p.m + bonus; 
                let t_t = p.t + bonus;

                let val = (t_a * 0.4) + (t_s * 0.3) + (t_m * 0.15) + (t_t * 0.15);
                
                let simHp = isMyTeam ? p.hp : (80 + Math.random()*20);
                val *= (0.9 + (simHp/1000));

                if(p.ms.includes(hName)) val += 5;
                if(meta.good.includes(hName)) val += 5;
                if(meta.bad.includes(hName)) val -= 5;
                let hData = HEROES[p.r].find(h=>h.n===hName);
                if(hData && hData.t === meta.type) { val += 3; teamCompCount++; }

                let mistakeChance = ((100 - t_m) / 3) * (1 - (mistakeReduction * 0.2)); 
                let roll = Math.random() * 100;
                
                if (roll < mistakeChance) {
                    val *= 0.7; 
                    logEvents.push({ type: 'mistake', team: isMyTeam ? 'MY' : 'OPP', player: p.n, hero: hName });
                } 
                else {
                    let crackThreshold = 0.15;
                    if (p.trait === "ë² í…Œë‘") crackThreshold = 0.25; 

                    if (t_a > 92 && t_s > 92 && Math.random() < crackThreshold) {
                        val *= 1.25; 
                        logEvents.push({ type: 'crack', team: isMyTeam ? 'MY' : 'OPP', player: p.n, hero: hName });
                    }
                }

                totalPower += val;
                teamAvgTeamwork += t_t;
            });

            if(teamCompCount >= 3) totalPower += 10;
            return { power: totalPower, avgTeamwork: teamAvgTeamwork / 5 };
        }

        let myStats = calcTeamPower(myLockedPlayers, myHs, true);
        let oppStats = calcTeamPower(oppHeroPicks, oppHeroPicks, false);

        let myFinalPower = myStats.power;
        let oppFinalPower = oppStats.power;

        let diff = myFinalPower - oppFinalPower;
        let winningTeam = diff > 0 ? 'MY' : 'OPP';

        if (Math.abs(diff) < 30) { 
            if (winningTeam === 'OPP' && myStats.avgTeamwork > oppStats.avgTeamwork) {
                let twDiff = myStats.avgTeamwork - oppStats.avgTeamwork;
                let bonus = twDiff * 2.5; 
                myFinalPower += bonus;
                logEvents.push({ type: 'comeback', team: 'MY' });
            } 
            else if (winningTeam === 'MY' && oppStats.avgTeamwork > myStats.avgTeamwork) {
                let twDiff = oppStats.avgTeamwork - myStats.avgTeamwork;
                let bonus = twDiff * 2.5;
                oppFinalPower += bonus;
                logEvents.push({ type: 'comeback', team: 'OPP' });
            }
        }

        let isWin = myFinalPower > oppFinalPower;

        function getSkillName(hName) { return HERO_SKILLS[hName] || "ê¶ê·¹ê¸°"; }
        function parseMsg(template, pName, hName) {
            let skill = getSkillName(hName);
            return template.replace(/{player}/g, pName).replace(/{hero}/g, hName).replace(/{skill}/g, skill);
        }

        let logHTML = `<div style="margin-top:10px; border-top:1px dashed #444; padding-top:5px; color:#aaa;">--- ${currentSet}ì„¸íŠ¸ ì¤‘ê³„ ---</div>`;
        logHTML += `<div class="log-caster">"${COMMENTARY_DB.OPENING[Math.floor(Math.random()*COMMENTARY_DB.OPENING.length)]}"</div>`;

        if (logEvents.length > 0) {
            logEvents.forEach(ev => {
                let teamColor = ev.team === 'MY' ? 'var(--ow-orange)' : 'var(--ban-red)';
                if(ev.type === 'mistake') {
                    let tpl = COMMENTARY_DB.MISTAKE[Math.floor(Math.random()*COMMENTARY_DB.MISTAKE.length)];
                    let msg = parseMsg(tpl, ev.player, ev.hero);
                    logHTML += `<div><span style="color:${teamColor};">â–¶</span> <span class="log-mistake">${msg}</span></div>`;
                } else if (ev.type === 'crack') {
                    let tpl = COMMENTARY_DB.CRACK[Math.floor(Math.random()*COMMENTARY_DB.CRACK.length)];
                    let msg = parseMsg(tpl, ev.player, ev.hero);
                    logHTML += `<div><span style="color:${teamColor};">â–¶</span> <span class="log-crack">${msg}</span></div>`;
                } else if (ev.type === 'comeback') {
                    let tpl = COMMENTARY_DB.TEAMWORK_COMEBACK[Math.floor(Math.random()*COMMENTARY_DB.TEAMWORK_COMEBACK.length)];
                    let teamName = ev.team === 'MY' ? 'ì•„êµ°' : 'ìƒëŒ€íŒ€';
                    logHTML += `<div class="log-teamwork" style="color:${teamColor};">"${teamName}, ${tpl}" (íŒ€ì›Œí¬ ë°œë™)</div>`;
                }
            });
        } else {
            let rIdx = Math.floor(Math.random()*5);
            let pName = myLockedPlayers[rIdx];
            let hName = myHs[rIdx];
            logHTML += `<div>**${pName}**ì˜ **${hName}**ì™€ ìƒëŒ€ì˜ ì¹˜ì—´í•œ êµì „ì´ ê³„ì†ë©ë‹ˆë‹¤.</div>`;
        }

        if (!logEvents.some(e=>e.type==='comeback') && Math.abs(myFinalPower - oppFinalPower) > 50) {
             let tpl = COMMENTARY_DB.TEAMWORK_FAIL[Math.floor(Math.random()*COMMENTARY_DB.TEAMWORK_FAIL.length)];
             logHTML += `<div class="log-caster">"${tpl} ì¼ë°©ì ì¸ ê²½ê¸°ì…ë‹ˆë‹¤."</div>`;
        }

        if(isWin) { 
            setScores[0]++; setWinner = 0; 
            logHTML += `<div class="log-win" style="font-size:1.1em; margin-top:5px;">>> ${currentSet}ì„¸íŠ¸ ìŠ¹ë¦¬! (ì ìˆ˜ì°¨: ${Math.floor(myFinalPower-oppFinalPower)})</div>`; 
        } else { 
            setScores[1]++; setWinner = 1; 
            logHTML += `<div class="log-lose" style="font-size:1.1em; margin-top:5px;">>> ${currentSet}ì„¸íŠ¸ íŒ¨ë°°... (ì ìˆ˜ì°¨: ${Math.floor(oppFinalPower-myFinalPower)})</div>`; 
        }
        
        const logWin = document.getElementById('log-window');
        logWin.innerHTML += logHTML;
        logWin.scrollTop = logWin.scrollHeight;

        myLockedPlayers.forEach(n => {
            playerSetCounts[n] = (playerSetCounts[n] || 0) + 1;
        });

        updateScoreBoard();
        let winTarget = (seasonState === 'POST_FINAL') ? 4 : 3;
        if(setScores[0]===winTarget || setScores[1]===winTarget) endMatch(); 
        else { currentSet++; setTimeout(startSet, 2500); }
    }

    function endMatch() {
        let winTarget = (seasonState === 'POST_FINAL') ? 4 : 3;
        let won = setScores[0] === winTarget;
        let opp = getCurrentOpponentName();
        let winnerTeam = won ? myTeam : opp;
        
        let potmName = calcMatchPOTM(winnerTeam);
        
        log(`ë§¤ì¹˜ ì¢…ë£Œ. ${won ? 'ìŠ¹ë¦¬' : 'íŒ¨ë°°'}.`);
        log(`<span class="log-potm">â˜… POTM: ${potmName} (${winnerTeam})</span>`);

        let totalSets = setScores[0] + setScores[1];
        Object.keys(playerSetCounts).forEach(pName => {
            let setsPlayed = playerSetCounts[pName];
            let ratio = setsPlayed / totalSets;
            
            let p = TEAM_DB[myTeam].find(x=>x.n===pName);
            if(p) {
                let baseLoss = (p.trait === "ìœ ë§ì£¼") ? 6 : 9; 
                let loss = Math.round(ratio * baseLoss);
                p.hp = Math.max(0, p.hp - loss);
            }
        });

        if (seasonState === "REGULAR") {
            recordStats(myTeam, opp, setScores[0], setScores[1]);
            advanceDay();
        } else if (seasonState === "POST_SEMI") {
            if(won) {
                let otherSemi = (playoffMatches.semiA.h === myTeam || playoffMatches.semiA.a === myTeam) ? playoffMatches.semiB : playoffMatches.semiA;
                let wOther = Math.random() > 0.5 ? otherSemi.h : otherSemi.a;
                calcMatchPOTM(wOther); 
                playoffMatches.final = {h: myTeam, a: wOther};
                log(`[ê²°ìŠ¹ ìƒëŒ€] ${wOther} íŒ€ì´ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤.`);
            } else { playoffMatches.final = {h: "Team A", a: "Team B"}; }
            seasonState = "POST_FINAL";
            setTimeout(updateRoundUI, 2000);
        } else if (seasonState === "POST_FINAL") {
            if (won) {
                document.getElementById('ending-screen').style.display = 'flex';
            } else {
                log(`ê²°ìŠ¹ì „ ì¢…ë£Œ. ì¤€ìš°ìŠ¹.`);
                document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                document.getElementById('btn-start-match').onclick = prepareNextSeason;
            }
        }
    }

    function setupPlayoffs() {
        if(seasonState === "POST_SEED") {
            document.getElementById('match-title').innerText = "POST-SEASON";
            document.getElementById('round-display').innerText = "PLAYOFFS - FRIDAY";
            document.getElementById('lobby-desc').innerText = "3~6ìœ„ ì‹œë“œ ê²°ì •ì „ ì§„í–‰ì¼ì…ë‹ˆë‹¤.";
            let sorted = Object.values(leagueStats).sort((a,b) => b.w - a.w || b.d - a.d);
            playoffMatches.seedA = {h: sorted[2].name, a: sorted[5].name};
            playoffMatches.seedB = {h: sorted[3].name, a: sorted[4].name};
            playoffMatches.rank1 = sorted[0].name;
            playoffMatches.rank2 = sorted[1].name;
            
            if (playoffMatches.rank1 === myTeam || playoffMatches.rank2 === myTeam) {
                seasonState = "POST_SEED_TRAIN"; 
                document.getElementById('match-subtitle').innerText = "ìƒìœ„ ì‹œë“œ(1-2ìœ„) íŠ¹ì „";
                document.getElementById('match-title').innerText = "BYE & TRAINING";
                document.getElementById('train-desc-txt').innerText = "ì‹œë“œ ê²°ì •ì „ ë™ì•ˆ íœ´ì‹/í›ˆë ¨ ê°€ëŠ¥.";
                switchPhase('ui-training');
            } else {
                const isInSeedA = (playoffMatches.seedA.h === myTeam || playoffMatches.seedA.a === myTeam);
                const isInSeedB = (playoffMatches.seedB.h === myTeam || playoffMatches.seedB.a === myTeam);
                if (isInSeedA || isInSeedB) {
                    document.getElementById('btn-start-match').innerText = "ì‹œë“œì „ ì‹œì‘";
                    document.getElementById('btn-start-match').onclick = runSeedMatches;
                    switchPhase('ui-lobby');
                } else {
                    document.getElementById('match-title').innerText = "SEASON ENDED";
                    document.getElementById('lobby-desc').innerText = "í”Œë ˆì´ì˜¤í”„ ì§„ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                    document.getElementById('btn-start-match').style.display = 'block';
                    document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                    document.getElementById('btn-start-match').onclick = prepareNextSeason;
                    switchPhase('ui-lobby');
                }
            }
        }
    }
    function runSeedMatches() {
        let winA = Math.random()>0.5 ? playoffMatches.seedA.h : playoffMatches.seedA.a;
        calcMatchPOTM(winA);
        let winB = Math.random()>0.5 ? playoffMatches.seedB.h : playoffMatches.seedB.a;
        calcMatchPOTM(winB);
        playoffMatches.winnerA = winA;
        playoffMatches.winnerB = winB;
        log(`[ì‹œë“œì „ ê²°ê³¼] ${winA}, ${winB} ìŠ¹ë¦¬.`);
        if (playoffMatches.rank1 === myTeam) {
            document.getElementById('lobby-desc').innerText = "1ìœ„ íŠ¹ì „: 4ê°• ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤.";
            document.getElementById('selection-area').style.display = 'block';
            let box = document.getElementById('pick-opponent-btns');
            box.innerHTML = "";
            [winA, winB].forEach(t => {
                let b = document.createElement('button');
                b.className = 'action-btn'; b.style.fontSize = "0.9em"; b.style.padding = "10px"; b.innerText = t;
                b.onclick = () => confirmPick(t); box.appendChild(b);
            });
            document.getElementById('btn-start-match').style.display = 'none';
        } else {
            let picked = Math.random()>0.5 ? winA : winB;
            let other = (picked === winA) ? winB : winA;
            log(`${playoffMatches.rank1} íŒ€ì´ ${picked}ë¥¼ ì§€ëª…í–ˆìŠµë‹ˆë‹¤.`);
            playoffMatches.semiA = {h: playoffMatches.rank1, a: picked};
            playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
            seasonState = "POST_SEMI";
            updateRoundUI();
        }
    }
    function runSeedMatchesSimOnly() {
        let winA = Math.random()>0.5 ? playoffMatches.seedA.h : playoffMatches.seedA.a;
        calcMatchPOTM(winA);
        let winB = Math.random()>0.5 ? playoffMatches.seedB.h : playoffMatches.seedB.a;
        calcMatchPOTM(winB);
        playoffMatches.winnerA = winA; playoffMatches.winnerB = winB;
        log(`[ì‹œë“œì „ ê²°ê³¼] ${winA}, ${winB} ìŠ¹ë¦¬.`);
        if (playoffMatches.rank1 === myTeam) {
             seasonState = "POST_PICK"; showPickUI([winA, winB]); return;
        } else {
            let picked = Math.random()>0.5 ? winA : winB;
            let other = (picked === winA) ? winB : winA;
            log(`${playoffMatches.rank1} íŒ€ì´ ${picked}ë¥¼ ì§€ëª…í–ˆìŠµë‹ˆë‹¤.`);
            playoffMatches.semiA = {h: playoffMatches.rank1, a: picked};
            playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
        }
    }
    function showPickUI(winners) {
        document.getElementById('round-display').innerText = "PLAYOFFS - FRIDAY NIGHT";
        document.getElementById('match-subtitle').innerText = "OPPONENT SELECTION";
        document.getElementById('match-title').innerText = "PICK PHASE";
        switchPhase('ui-lobby');
        document.getElementById('lobby-desc').innerText = "1ìœ„ íŠ¹ì „: 4ê°• ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤.";
        document.getElementById('selection-area').style.display = 'block';
        let box = document.getElementById('pick-opponent-btns');
        box.innerHTML = "";
        winners.forEach(t => {
            let b = document.createElement('button');
            b.className = 'action-btn'; b.style.fontSize = "0.9em"; b.style.padding = "10px"; b.innerText = t;
            b.onclick = () => confirmPick(t); box.appendChild(b);
        });
        document.getElementById('btn-start-match').style.display = 'none';
    }
    function confirmPick(opp) {
        document.getElementById('selection-area').style.display = 'none';
        document.getElementById('btn-start-match').style.display = 'block';
        let other = (opp === playoffMatches.winnerA) ? playoffMatches.winnerB : playoffMatches.winnerA;
        playoffMatches.semiA = {h: myTeam, a: opp};
        playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
        seasonState = "POST_SEMI";
        updateRoundUI();
    }
    function recoverAllStamina(amount) { Object.values(TEAM_DB).forEach(roster => roster.forEach(p => p.hp = Math.min(100, p.hp + amount))); }
    function recordStats(h, a, s1, s2) { leagueStats[h].w += (s1>s2?1:0); leagueStats[h].l += (s1>s2?0:1); leagueStats[h].d += (s1-s2); leagueStats[a].w += (s2>s1?1:0); leagueStats[a].l += (s2>s1?0:1); leagueStats[a].d += (s2-s1); }
    function switchPhase(id) { document.querySelectorAll('.ui-phase').forEach(e => e.classList.remove('active-phase')); document.getElementById(id).classList.add('active-phase'); }
    function updateScoreBoard() { document.getElementById('sc-my').innerText = setScores[0]; document.getElementById('sc-opp').innerText = setScores[1]; }
    function log(m) { const l = document.getElementById('log-window'); l.innerHTML += `<div>> ${m}</div>`; l.scrollTop = l.scrollHeight; }
</script>
</body>
</html>