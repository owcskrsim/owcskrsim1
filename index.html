<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì˜µì±”ìŠ¤ ê°ë… ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root { --ow-orange: #f99e1a; --ow-blue: #405275; --dark-bg: #121418; --card-bg: #1e2329; --accent: #00ffcc; --ban-red: #ff5e57; --good-green: #2ecc71; --stamina: #e1b12c; --gold: #ffd700; }
        body { background: var(--dark-bg); color: white; font-family: 'Pretendard', sans-serif; margin: 0; padding: 0; font-size: 14px; overflow: hidden; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        /* SCREENS */
        .full-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        #start-screen { display: flex; z-index: 9999; }
        
        .team-btn { background: #333; color: white; border: 1px solid #555; padding: 15px 30px; margin: 5px; cursor: pointer; font-size: 1.1em; width: 200px; transition: 0.2s; }
        .team-btn:hover { background: var(--ow-orange); color: black; border-color: var(--ow-orange); }
        .load-btn { background: #2b313a; color: var(--accent); border: 1px solid var(--accent); padding: 15px 30px; margin-top: 20px; cursor: pointer; font-size: 1.2em; width: 300px; font-weight: bold; transition: 0.2s; display: none; }
        
        /* MODE SELECT */
        .mode-card { background: #222; border: 2px solid #444; padding: 30px; margin: 20px; width: 300px; text-align: center; cursor: pointer; border-radius: 10px; transition: 0.3s; }
        .mode-card:hover { border-color: var(--ow-orange); background: #2a2a2a; transform: translateY(-5px); }
        .mode-title { font-size: 1.5em; font-weight: bold; color: var(--ow-orange); margin-bottom: 10px; }
        .mode-desc { color: #aaa; line-height: 1.4; }

        /* DRAFT SCREEN */
        #draft-screen { z-index: 9500; display: none; flex-direction: column; justify-content: flex-start; padding-top: 20px; overflow-y: auto; background: #111; }
        
        .draft-layout { 
            display: grid; 
            grid-template-columns: 250px 1fr 300px; 
            gap: 15px; 
            width: 98%; 
            height: 85vh; 
            margin-top: 15px; 
        }
        
        .draft-col { background: #1e1e1e; border: 1px solid #333; padding: 10px; overflow-y: auto; border-radius: 8px; display: flex; flex-direction: column; }
        .draft-col h3 { color: #ccc; border-bottom: 1px solid #555; padding-bottom: 10px; margin-top: 0; font-size: 1.1em; text-align: center; }
        .draft-my-area { border-color: var(--ow-orange); }
        .draft-history-area { border-color: #555; background: #151515; }

        .pool-filter-btn { background: #333; border: 1px solid #555; color: white; padding: 5px 15px; cursor: pointer; margin-right: 5px; }
        .pool-filter-btn.active { background: var(--ow-orange); color: black; border-color: var(--ow-orange); }
        
        .draft-card { background: #333; margin-bottom: 8px; padding: 10px; border-radius: 4px; display: grid; grid-template-columns: 50px 100px 1fr 60px; align-items: center; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .draft-card:hover { border-color: var(--accent); background: #444; }
        .draft-card.picked { display: none; } 
        .draft-card.disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); border: 1px solid #555; }
        
        .role-badge { font-size: 0.8em; padding: 2px 6px; border-radius: 4px; text-align: center; font-weight: bold; }
        .rb-tank { background: #2c3e50; color: #3498db; border: 1px solid #3498db; }
        .rb-dps { background: #3e2723; color: #e74c3c; border: 1px solid #e74c3c; }
        .rb-sup { background: #1b5e20; color: #2ecc71; border: 1px solid #2ecc71; }

        #turn-indicator { padding: 10px; background: #222; margin-top: 10px; border-radius: 5px; text-align: center; color: #aaa; border: 1px solid #444; width: 95%; align-self: center; }
        .turn-active { color: var(--accent); font-weight: bold; border-color: var(--accent) !important; background: #2b313a !important; }

        .hist-item { padding: 6px; border-bottom: 1px solid #333; font-size: 0.9em; display:flex; justify-content: space-between; align-items: center; }
        .hist-team { font-weight: bold; color: #aaa; width: 80px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .hist-player { color: white; }
        .hist-item.my-pick .hist-team { color: var(--ow-orange); }
        .hist-item.my-pick .hist-player { color: var(--accent); font-weight: bold; }

        /* MAIN LAYOUT */
        #layout { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        .sidebar { background: #181b21; border-right: 1px solid #333; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; position: relative; z-index: 10; }
        .league-table { width: 100%; border-collapse: collapse; font-size: 0.85em; margin-bottom: 20px; }
        .league-table th { color: var(--ow-orange); border-bottom: 2px solid #444; padding: 8px 4px; }
        .league-table td { padding: 8px 4px; text-align: center; border-bottom: 1px solid #333; }
        .my-team-row { background: rgba(249, 158, 26, 0.15); font-weight: bold; color: var(--ow-orange); }
        
        .side-btn { background: var(--ow-blue); color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 10px; width: 100%; transition:0.2s; }
        .side-btn:hover { background: #506485; }
        .potm-btn { background: #333; border: 1px solid var(--gold); color: var(--gold); }
        .potm-btn:hover { background: var(--gold); color: black; }
        .system-btn { background: #333; border: 1px solid #555; color: #aaa; font-size: 0.9em; margin-bottom: 5px; }
        .system-btn:hover { background: #444; color: white; border-color: white; }

        .main-panel { padding: 20px; display: flex; flex-direction: column; overflow-y: auto; position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        
        .scoreboard { font-size: 3em; font-weight: 800; text-align: center; color: var(--ow-orange); letter-spacing: 5px; margin: 10px 0; }
        .phase-badge { background: #333; padding: 5px 12px; border-radius: 20px; font-size: 0.9em; color: var(--accent); border: 1px solid var(--accent); }

        .game-container { flex-grow: 1; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid #333; position: relative; }
        .ui-phase { display: none; height: 100%; }
        .active-phase { display: flex; flex-direction: column; justify-content: center; align-items: center; }

        .setup-row { display: flex; gap: 20px; width: 100%; justify-content: center; }
        .setup-col { background: #2b313a; padding: 15px; border-radius: 8px; width: 32%; min-width: 200px; }
        select { width: 100%; padding: 10px; background: #121418; color: white; border: 1px solid #555; border-radius: 4px; margin-top: 5px; }
        select:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .action-btn { background: var(--ow-orange); color: #000; font-weight: 800; padding: 15px 40px; border: none; border-radius: 6px; font-size: 1.2em; cursor: pointer; margin-top: 20px; transition: transform 0.1s; }
        .action-btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .action-btn:disabled { background: #555; cursor: not-allowed; transform: none; }

        .train-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 800px; margin-top: 20px; }
        .train-card { background: #2b313a; padding: 20px; border-radius: 8px; border: 1px solid #444; cursor: pointer; transition: 0.2s; text-align: left; }
        .train-card:hover { border-color: var(--ow-orange); background: #333842; }
        .train-title { font-size: 1.1em; font-weight: bold; color: var(--ow-orange); margin-bottom: 5px; }
        .train-desc { font-size: 0.9em; color: #aaa; }

        .modal { display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 800px; max-height: 80vh; background: #1a1a1a; border: 2px solid var(--ow-orange); z-index: 10000; padding: 20px; border-radius: 10px; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .close-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }

        .player-card { background: #333; margin-bottom: 10px; padding: 15px; border-radius: 5px; display: grid; grid-template-columns: 100px 1fr 150px; align-items: center; }
        .stat-bars { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 5px; font-size: 0.8em; color: #aaa; margin-left: 20px; }
        .stat-val { color: var(--accent); font-weight: bold; }
        .hp-val { color: var(--stamina); font-weight: bold; }

        .potm-row { display: grid; grid-template-columns: 50px 1fr 1fr 100px; padding: 10px; border-bottom: 1px solid #333; align-items: center; }
        .potm-row:nth-child(even) { background: #222; }
        .potm-rank-1 { color: var(--gold); font-weight: bold; }
        .potm-count { background: var(--gold); color: black; padding: 2px 8px; border-radius: 10px; font-weight: bold; display: inline-block;}

        .opp-card { background: #1e1e1e; padding: 8px; margin-bottom: 5px; border-radius: 4px; border-left: 3px solid var(--ban-red); display:flex; justify-content: space-between; align-items: center; }
        .opp-hero { font-weight:bold; color: var(--ban-red); font-size: 0.9em; transition: all 0.5s ease; }
        .opp-hero.hidden { color: #555; letter-spacing: 2px; }

        /* ENDING SCREEN */
        #ending-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 20000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white;
        }

/* SNS ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.tweet-card { padding: 15px; border-bottom: 1px solid #333; display: flex; gap: 12px; transition: 0.2s; }
.tweet-card:hover { background: #0a0a0a; }
.tweet-avatar { width: 48px; height: 48px; border-radius: 50%; background: #333; flex-shrink: 0; display:flex; justify-content:center; align-items:center; font-size:1.5em; }
.tweet-body { flex-grow: 1; }
.tweet-header { margin-bottom: 4px; font-size: 0.95em; }
.tweet-name { font-weight: bold; color: white; margin-right: 5px; }
.tweet-handle { color: #71767b; font-size: 0.9em; }
.tweet-text { color: #e7e9ea; line-height: 1.4; font-size: 1em; margin-bottom: 10px; }
.tweet-footer { display: flex; justify-content: space-between; max-width: 300px; color: #71767b; font-size: 0.85em; }
.tweet-action { display: flex; align-items: center; gap: 5px; cursor: pointer; transition:0.2s; }
.tweet-action:hover { color: #1da1f2; }
.tweet-action.red:hover { color: #f91880; }
.tweet-action.green:hover { color: #00ba7c; }

/* â–¼â–¼â–¼ [4ë‹¨ê³„] í•´ì„¤ì°½(ë¡œê·¸) í¬ê¸° ê³ ì • ë° ìŠ¤í¬ë¡¤ ìŠ¤íƒ€ì¼ â–¼â–¼â–¼ */
        #log-window {
            height: 200px;           /* ë†’ì´ë¥¼ 200pxë¡œ ê³ ì • */
            min-height: 200px;       /* ìµœì†Œ ë†’ì´ í™•ë³´ */
            max-height: 200px;       /* ìµœëŒ€ ë†’ì´ ì œí•œ (ë” ëŠ˜ì–´ë‚˜ì§€ ì•ŠìŒ) */
            
            background: #0f0f0f;     /* ë°°ê²½ìƒ‰ì„ ë” ì–´ë‘¡ê²Œ */
            padding: 15px;           /* ë‚´ë¶€ ì—¬ë°± */
            border-top: 2px solid var(--ow-orange); /* ìƒë‹¨ì— í¬ì¸íŠ¸ ì»¬ëŸ¬ */
            
            font-size: 0.95em;       /* ê¸€ì í¬ê¸° */
            color: #ddd;             /* ê¸€ì ìƒ‰ìƒ */
            line-height: 1.6;        /* ì¤„ ê°„ê²© */
            
            overflow-y: scroll;      /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ë°” ìƒì„± */
            scroll-behavior: smooth; /* ìŠ¤í¬ë¡¤ì´ ë¶€ë“œëŸ½ê²Œ ì›€ì§ì„ */
            
            flex-shrink: 0;          /* ì°½ í¬ê¸°ê°€ ì¤„ì–´ë“¤ ë•Œ ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
            box-sizing: border-box;  /* íŒ¨ë”© í¬í•¨ í¬ê¸° ê³„ì‚° */
        }
        /* â–²â–²â–² 4ë‹¨ê³„ ë â–²â–²â–² */

/* â–¼â–¼â–¼ [6ë‹¨ê³„] ë¡¤ìŠ¤íƒ€ ì¹´ë“œ ë””ìì¸ â–¼â–¼â–¼ */
.rs-card {
    background: linear-gradient(145deg, #222, #1a1a1a);
    border: 2px solid #444;
    border-radius: 10px;
    width: 200px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    transition: 0.3s;
    position: relative;
    margin: 10px;
}
.rs-card:hover { 
    transform: translateY(-10px); 
    border-color: var(--gold); 
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.3); 
}
.rs-role { 
    font-weight: 800; font-size: 1.2em; margin-bottom: 10px; 
    display:inline-block; padding: 4px 12px; border-radius: 20px; 
    text-transform: uppercase; letter-spacing: 1px;
}
.rs-name { 
    font-size: 1.6em; font-weight: 800; color: white; margin: 15px 0; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
}
.rs-team { color: #888; font-size: 0.9em; font-weight: bold; }
.rs-score { color: var(--gold); font-weight: bold; margin-top: 15px; font-size: 0.85em; }
/* â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–² */

</style>
</head>
<body>

<div id="start-screen" class="full-screen">
    <h1 style="color:var(--ow-orange); font-size:3em; margin-bottom:10px;">ì˜µì±”ìŠ¤ ê°ë… ì‹œë®¬ë ˆì´í„°</h1>
    <p style="color:#aaa; margin-bottom:30px;">ê°ë…ì„ ë§¡ì„ íŒ€ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤. (ì´ 9íŒ€)</p>
    <button id="load-btn-start" class="load-btn" onclick="loadGame()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸° (Load Game)</button>
    <br><br>
    <div id="team-buttons" style="display:flex; flex-wrap:wrap; justify-content:center; max-width:800px;"></div>
</div>

<div id="mode-select-screen" class="full-screen">
    <h2 style="font-size:2.5em; margin-bottom:10px;">GAME MODE SELECT</h2>
    <p style="color:#aaa;">í”Œë ˆì´í•  ëª¨ë“œë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤.</p>
    <div style="display:flex;">
        <div class="mode-card" onclick="selectMode('NORMAL')">
            <div class="mode-title">ì¼ë°˜ ëª¨ë“œ (Normal)</div>
            <div class="mode-desc">
                ê¸°ì¡´ íŒ€ ë¡œìŠ¤í„° ê·¸ëŒ€ë¡œ ì‹œì¦Œì„ ì§„í–‰í•©ë‹ˆë‹¤.<br>
                íŒ€ì˜ ê³ ìœ í•œ ìƒ‰ê¹”ì„ ì‚´ë ¤ ìš°ìŠ¹ì— ë„ì „í•˜ì„¸ìš”.
            </div>
        </div>
        <div class="mode-card" onclick="selectMode('DRAFT')">
            <div class="mode-title">ë“œë˜í”„íŠ¸ ëª¨ë“œ (Draft)</div>
            <div class="mode-desc">
                ëª¨ë“  ì„ ìˆ˜ê°€ FAë¡œ í’€ë¦½ë‹ˆë‹¤.<br>
                <strong>[!] ì„ ìˆ˜ ìŠ¤íƒ¯ ì •ë³´ ë¹„ê³µê°œ</strong><br>
                <strong>[!] ë°¸ëŸ°ìŠ¤ ë³´í˜¸ (ì—­í• êµ° ë…ì  ë°©ì§€)</strong><br>
                ì¡°ê±´: íƒ±1/ë”œ2/í2 í•„ìˆ˜, ìµœëŒ€ 8ëª….
            </div>
        </div>
    </div>
</div>

<div id="draft-screen" class="full-screen">
    <h2 style="color:var(--accent);">SNAKE DRAFT PHASE (BLIND)</h2>
    <div style="display:flex; justify-content:space-between; width:95%; align-items:center;">
        <div id="draft-status" style="font-size:1.2em; font-weight:bold;">Round 1</div>
        <div>
            <button class="pool-filter-btn active" onclick="renderDraftPool('ALL')">ALL</button>
            <button class="pool-filter-btn" onclick="renderDraftPool('TANK')">TANK</button>
            <button class="pool-filter-btn" onclick="renderDraftPool('DPS')">DPS</button>
            <button class="pool-filter-btn" onclick="renderDraftPool('SUP')">SUP</button>
        </div>
    </div>
    
    <div id="turn-indicator">ëŒ€ê¸° ì¤‘...</div>

    <div class="draft-layout">
        <div class="draft-col draft-my-area">
            <h3>MY ROSTER</h3>
            <div id="roster-req-status" style="font-size:0.85em; color:#ccc; margin-bottom:10px; text-align:center;"></div>
            <div id="my-draft-roster"></div>
        </div>
        
        <div class="draft-col draft-pool-area">
            <h3>PLAYER POOL (SORTED A-Z)</h3>
            <div id="draft-pool-list"></div>
        </div>

        <div class="draft-col draft-history-area">
            <h3>DRAFT LOG</h3>
            <div id="draft-history-list"></div>
        </div>
    </div>
</div>

<div id="ending-screen">
    <h1 style="font-size:5em; color:var(--gold); text-shadow: 0 0 20px var(--gold); margin-bottom: 10px;">ğŸ† VICTORY ğŸ†</h1>
    <h2 style="font-size:2em; margin-bottom: 30px;">OWCS KOREA CHAMPIONS</h2>
    <p style="font-size:1.2em; color:#ccc; max-width: 600px; line-height: 1.6;">
        ì¶•í•˜í•©ë‹ˆë‹¤, ê°ë…ë‹˜! ì¹˜ì—´í•œ ìŠ¹ë¶€ ëì— íŒ€ì„ ì •ìƒìœ¼ë¡œ ì´ëŒì—ˆìŠµë‹ˆë‹¤.<br>
        ë‹¹ì‹ ì˜ ì „ìˆ ê³¼ ë¦¬ë”ì‹­ì€ ì „ì„¤ë¡œ ë‚¨ì„ ê²ƒì…ë‹ˆë‹¤.
    </p>
    <button class="action-btn" onclick="location.reload()" style="margin-top:40px;">íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°</button>
</div> 

<div id="release-modal" class="modal" style="width:400px; text-align:center;">
    <h3 style="color:var(--ban-red);">âš ï¸ ROSTER FULL</h3>
    <p style="color:#ccc;">í•´ë‹¹ í¬ì§€ì…˜ ì •ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.<br>ì˜ì…ì„ ìœ„í•´ <strong>ë°©ì¶œí•  ì„ ìˆ˜</strong>ë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤.</p>
    <div id="release-candidates" style="display:flex; flex-direction:column; gap:10px; margin:20px 0;"></div>
    <button class="action-btn" style="background:#555; font-size:1em; padding:10px;" onclick="closeReleaseModal()">ì·¨ì†Œ</button>
</div>


<div id="roster-modal" class="modal">
    <button class="close-btn" onclick="toggleModal('roster-modal')">Ã—</button>
    <h2 style="margin-top:0; color:var(--ow-orange);">MY TEAM ROSTER</h2>
    <div id="roster-content"></div>
</div>

<div id="potm-modal" class="modal">
    <button class="close-btn" onclick="toggleModal('potm-modal')">Ã—</button>
    <h2 style="margin-top:0; color:var(--gold);">ğŸ† LEAGUE POTM RANKING</h2>
    <div class="potm-row" style="font-weight:bold; color:#aaa; border-bottom:2px solid #555;">
        <div>#</div><div>PLAYER</div><div>TEAM</div><div>POTM</div>
    </div>
    <div id="potm-content"></div>
</div>

<div id="all-teams-modal" class="modal">
    <button class="close-btn" onclick="toggleModal('all-teams-modal')">Ã—</button>
    <h2 style="margin-top:0; color:#aaa;">ğŸ•µï¸ SCOUTING REPORT (íƒ€ íŒ€ ë¡œìŠ¤í„°)</h2>
    <div id="all-teams-content" style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
        </div>
</div>

<div id="community-modal" class="modal" style="width:500px; background:black; border:1px solid #333;">
    <button class="close-btn" onclick="toggleModal('community-modal')">Ã—</button>
    <h3 style="margin-top:0; color:#1da1f2; border-bottom:1px solid #333; padding-bottom:15px; display:flex; align-items:center; gap:10px;">
        <span>ğŸ“±</span> ì‹¤ì‹œê°„ íŠ¸ë Œë“œ
    </h3>
    <div id="community-content" style="display:flex; flex-direction:column; gap:0;"></div>
</div>

<div id="info-modal" class="modal" style="width:700px;">
    <button class="close-btn" onclick="toggleModal('info-modal')">Ã—</button>
    <h2 style="color:var(--accent); border-bottom:1px solid #444; padding-bottom:10px;">ğŸ“Š SEASON INFO</h2>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
        <div style="background:#222; padding:15px; border-radius:8px;">
            <h3 style="margin-top:0; color:var(--ow-orange);">ğŸ—ºï¸ ë§µ ë¡œí…Œì´ì…˜ (MAP POOL)</h3>
            <div id="info-map-list" style="font-size:0.9em; line-height:1.6;">
                </div>
        </div>

        <div style="background:#222; padding:15px; border-radius:8px;">
            <h3 style="margin-top:0; color:#ff5e57;">âš–ï¸ ì˜ì›… ë°¸ëŸ°ìŠ¤ (BALANCE)</h3>
            <div id="info-balance-list" style="height:300px; overflow-y:auto;">
                </div>
        </div>
    </div>
</div>

<div id="records-modal" class="modal" style="width:850px;">
    <button class="close-btn" onclick="toggleModal('records-modal')">Ã—</button>
    <h2 style="color:var(--good-green); border-bottom:1px solid #444; padding-bottom:10px;">ğŸ† TEAM HALL OF FAME</h2>
    <p style="color:#aaa; font-size:0.9em; margin-bottom:15px;">
        * ìš°ë¦¬ íŒ€ ì†Œì† ì„ ìˆ˜ë“¤ì˜ ëˆ„ì  ê¸°ë¡ì…ë‹ˆë‹¤. (ë°©ì¶œëœ ì„ ìˆ˜ì˜ ê¸°ë¡ì€ ë³´ì¡´ë˜ì§€ë§Œ ì´ê³³ì—” í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)<br>
        * ì„ ìˆ˜ê°€ ì¬ì˜ì…ë˜ë©´ ê¸°ì¡´ ê¸°ë¡ì— ì´ì–´ì„œ ì¹´ìš´íŠ¸ë©ë‹ˆë‹¤.
    </p>
    
    <div style="max-height:500px; overflow-y:auto;">
        <table style="width:100%; border-collapse:collapse; text-align:center; font-size:0.9em;">
            <thead style="background:#222; color:var(--ow-orange); position:sticky; top:0;">
                <tr>
                    <th style="padding:10px;">ROLE</th>
                    <th>NAME</th>
                    <th>ì„¸íŠ¸</th>
                    <th>K / D / A (Avg)</th>
                    <th>POTM</th>
                    <th>ROLE STAR</th>
                </tr>
            </thead>
            <tbody id="records-body"></tbody>
        </table>
    </div>
</div>


<div id="layout">
    <div class="sidebar">
        <button class="side-btn" onclick="toggleRoster()">ğŸ“‹ MY ROSTER (ì„ ìˆ˜ ì •ë³´)</button>
        <button class="side-btn" onclick="toggleAllTeams()">ğŸ” LEAGUE ROSTER (íƒ€ íŒ€ ì •ë³´)</button>
        <button class="side-btn potm-btn" onclick="togglePOTM()">ğŸ† LEAGUE POTM</button>
         <button class="side-btn" style="background:#1da1f2; color:white;" onclick="toggleCommunity()">ğŸ¦ SNS ë°˜ì‘ (FAN)</button>
         <button class="side-btn" style="background:#8e44ad; margin-top:5px;" onclick="toggleInfo()">ğŸ“œ ì‹œì¦Œ ì •ë³´ (ë§µ/ë°¸ëŸ°ìŠ¤)</button>
         <button class="side-btn" style="background:#27ae60; margin-top:5px;" onclick="toggleRecords()">ğŸ† íŒ€ ê¸°ë¡ì‹¤ (ëª…ì˜ˆì˜ ì „ë‹¹)</button>

        <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
            <div style="color:#666; font-size:0.8em; margin-bottom:5px;">SYSTEM</div>
            <button class="side-btn system-btn" onclick="saveGame()">ğŸ’¾ GAME SAVE</button>
            <button class="side-btn system-btn" onclick="resetGame()">ğŸ—‘ï¸ RESET DATA</button>
        </div>

        <h3 style="text-align:center; margin-top:20px;">ğŸ† SEASON STANDINGS</h3>
        <div id="round-display" style="text-align:center; color:var(--accent); margin-bottom:15px; font-weight:bold;">PRE-SEASON</div>
        
        <table class="league-table">
            <thead><tr><th>#</th><th>TEAM</th><th>W</th><th>L</th><th>DIFF</th></tr></thead>
            <tbody id="standings-body"></tbody>
        </table>

        <div id="tournament-tree" style="display:none; background:#111; padding:10px; border-radius:8px; font-size:0.85em;">
            <h4 style="margin:5px 0; color:var(--ow-orange);">PLAYOFFS</h4>
            <div id="bracket-view"></div>
        </div>
    </div>

    <div class="main-panel">
        <div class="header">
            <div>
                <h1 id="match-title" style="margin:0; font-size:1.8em;">WAITING...</h1>
                <div id="match-subtitle" style="color:#888; margin-top:5px;">ì‹œì¦Œ ì¤€ë¹„ ì¤‘</div>
            </div>
            <div style="text-align:right;">
                <div class="phase-badge" id="current-phase-badge">LOBBY</div>
                <div id="set-score-txt" style="font-weight:bold; margin-top:5px; font-size:1.2em;">Bo5</div>
            </div>
        </div>

        <div class="scoreboard">
            <span id="sc-my">0</span> - <span id="sc-opp">0</span>
        </div>

        <div class="game-container">
            <div id="ui-training" class="ui-phase">
                <h2 style="color:var(--good-green);">ğŸ‹ï¸ TRAINING CENTER</h2>
                <p id="train-desc-txt" style="color:#aaa;">í›ˆë ¨ ì‹œ ì²´ë ¥ +10, íœ´ì‹ ì‹œ ì²´ë ¥ +30 íšŒë³µë©ë‹ˆë‹¤.</p>
                <div class="train-grid">
                    <div class="train-card" onclick="runTraining('AIM')">
                        <div class="train-title">ğŸ¯ ì—ì„ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">AIM +1</span> ìƒìŠ¹ (Max 99)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('SENSE')">
                        <div class="train-title">ğŸ§  ì„¼ìŠ¤ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">SENSE +1</span> ìƒìŠ¹ (Max 99)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('MENTAL')">
                        <div class="train-title">ğŸ§˜ ë©˜íƒˆ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">MENTAL +1</span> (ì‹¤ìˆ˜ í™•ë¥  ê°ì†Œ)</div>
                    </div>
                    <div class="train-card" onclick="runTraining('TEAM')">
                        <div class="train-title">ğŸ¤ íŒ€ì›Œí¬ í›ˆë ¨</div>
                        <div class="train-desc">íŒ€ ì „ì²´ì˜ <span style="color:white;">TEAM +1</span> (ì—­ì „ í™•ë¥  ì¦ê°€)</div>
                    </div>
                    <div class="train-card" style="grid-column: span 2; cursor:default; border-color:#555;">
                          <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div class="train-title" style="color:var(--accent);">âš”ï¸ ì˜ì›… ì§‘ì¤‘ ì—°ìŠµ</div>
                                <div class="train-desc">ì„ ìˆ˜ 1ëª…ì´ ì˜ì›…ì„ ì—°ìŠµí•©ë‹ˆë‹¤. (ê¸°ë³¸ 3íšŒ / ë‹¤ì¬ë‹¤ëŠ¥ 2íšŒ)</div>
                            </div>
                            <div style="display:flex; gap:10px;">
                                <select id="train-p-select" style="width:120px;" onchange="updateTrainHeroList()"></select>
                                <select id="train-h-select" style="width:120px;"></select>
                                <button onclick="runTraining('HERO')" style="background:var(--accent); border:none; border-radius:4px; font-weight:bold; cursor:pointer;">GO</button>
                            </div>
                          </div>
                    </div>
                    <div class="train-card" style="grid-column: span 2; border-color:var(--stamina);" onclick="runTraining('REST')">
                        <div class="train-title" style="color:var(--stamina);">ğŸ›Œ ì „ì› íœ´ì‹</div>
                        <div class="train-desc">í›ˆë ¨ì„ ì‰¬ê³  ì»¨ë””ì…˜ì„ ì¡°ì ˆí•©ë‹ˆë‹¤. <span style="color:white;">ì²´ë ¥ +30</span> íšŒë³µ</div>
                    </div>
                </div>
            </div>

            <div id="ui-lobby" class="ui-phase">
                <h2 id="next-match-info" style="color:var(--accent);"></h2>
                <p id="lobby-desc" style="color:#aaa; max-width:600px; text-align:center;"></p>
                <div id="selection-area" style="display:none; width:100%; text-align:center;">
                    <h3 style="color:var(--ow-orange);">ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤ (1ìœ„ íŠ¹ì „)</h3>
                    <div id="pick-opponent-btns" style="display:flex; justify-content:center; gap:10px;"></div>
                </div>
                <button id="btn-start-match" class="action-btn" onclick="proceedLobby()">ì¼ì • ì§„í–‰</button>
            </div>

            <div id="ui-map" class="ui-phase">
                <h2>ğŸ—ºï¸ MAP SELECTION</h2>
                <p id="map-msg" style="color:#ccc;"></p>
                <div style="width:300px;">
                    <select id="map-select"></select>
                </div>
                <button class="action-btn" onclick="confirmMap()">CONFIRM</button>
            </div>

            <div id="ui-roster" class="ui-phase">
                <h2>ğŸ“‹ LINEUP CHECK</h2>
                <div id="map-meta-roster" style="text-align:center; margin-bottom:15px; font-size:0.9em; color:#888;"></div>
                <div class="setup-row">
                    <div class="setup-col">
                        <h4 style="color:var(--accent);">MY LINEUP (Select Players)</h4>
                        <div id="roster-slots"></div>
                    </div>
                    <div class="setup-col" style="border:1px solid #444;">
                        <h4 style="color:var(--ban-red);">OPPONENT LINEUP</h4>
                        <div id="roster-opp-display" style="padding:20px; text-align:center; color:#ccc;">
                            (Waiting for your confirmation...)
                        </div>
                    </div>
                </div>
                <button class="action-btn" onclick="confirmRoster()">CONFIRM ROSTER</button>
            </div>

            <div id="ui-ban" class="ui-phase">
                <h2 style="color:var(--ban-red);">ğŸš« HERO BAN PHASE</h2>
                <p style="color:#aaa; font-size:0.9em; margin-bottom:15px;">* ì´ë²ˆ ë§¤ì¹˜(Bo5)ì—ì„œ í•œë²ˆ ë°´í•œ ì˜ì›…ì€ ë‹¤ì‹œ ë°´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="color:#aaa; font-size:0.8em;">* ê°™ì€ ì„¸íŠ¸ì— ì–‘ íŒ€ì€ ë™ì¼í•œ ì—­í• êµ°ì„ ë°´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <div class="setup-row">
                    <div class="setup-col" style="border:1px solid var(--ban-red);">
                        <h4>ìš°ë¦¬ íŒ€ ë°´</h4>
                        <select id="ban-select"></select>
                    </div>
                    <div class="setup-col">
                        <h4>ìƒëŒ€ íŒ€ ë°´</h4>
                        <div id="opp-ban-display" style="font-size:1.5em; font-weight:bold; margin-top:10px;">-</div>
                    </div>
                    <div class="setup-col" style="opacity:0.7;">
                        <h4>ìƒëŒ€ ë¼ì¸ì—…</h4>
                        <div id="ban-phase-opp-list" style="font-size:0.9em;"></div>
                    </div>
                </div>
                <button class="action-btn" onclick="confirmBan()">BAN HERO</button>
            </div>
           <div id="ui-result" class="ui-phase" style="text-align:center; height:100%; flex-direction:column; overflow:hidden;">
                <h2 id="result-title" style="margin-bottom:10px; color:var(--accent); flex-shrink:0;">SET RESULT</h2>
                
                <div style="background:#1e2329; border:1px solid #333; border-radius:8px; padding:10px; margin-bottom:10px; flex-grow:1; overflow-y:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.95em;">
                        <thead>
                            <tr style="background:#222; color:#aaa; position:sticky; top:0; z-index:5;">
                                <th style="padding:10px;">HERO</th>
                                <th>NAME</th>
                                <th style="color:white;">K / D / A</th>
                                <th style="color:#e74c3c;">DMG</th>
                                <th style="color:#f1c40f;">HEAL</th>
                                <th style="color:#3498db;">MIT</th>
                            </tr>
                        </thead>
                        <tbody id="result-stats-body"></tbody>
                    </table>
                </div>
                <button id="btn-next-set" class="action-btn" style="flex-shrink:0;" onclick="proceedNextStep()">ë‹¤ìŒ ì„¸íŠ¸ ì§„í–‰</button>
            </div>

            <div id="ui-pick" class="ui-phase">
                <h2>âš”ï¸ HERO PICK</h2>
                <p style="text-align:center; color:#e74c3c; margin-bottom:10px; font-weight:bold;">â€» ë°´ ëœ ì˜ì›…ì€ ì–‘ íŒ€ ëª¨ë‘ í”½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <div class="setup-row" style="align-items: flex-start;">
                    <div class="setup-col">
                        <h4 style="color:var(--ow-orange);">ğŸ›¡ï¸ MY HERO PICK</h4>
                        <div id="pick-slots"></div>
                    </div>
                    <div class="setup-col" style="border:1px solid #444;">
                        <h4 style="color:var(--ban-red);">ğŸ‘¿ OPPONENT</h4>
                        <div id="opp-entry-display"></div>
                    </div>
                </div>
                <button class="action-btn" onclick="runSimulation()">FIGHT!</button>
            </div>
        </div> 

        <div id="ui-scout" class="ui-phase">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <div>
            <h2 style="color:var(--accent); margin:0;">ğŸ•µï¸ PRE-SEASON SCOUTING</h2>
            <p style="color:#aaa; font-size:0.9em;">í”„ë¦¬ì‹œì¦Œ ìŠ¤ì¹´ìš°íŠ¸: ë¡œìŠ¤í„°ê°€ ê½‰ ì°¬ ê²½ìš° ê¸°ì¡´ ì„ ìˆ˜ë¥¼ ë°©ì¶œí•´ì•¼ ì˜ì… ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </div>
        <button class="action-btn" style="padding:10px 20px; font-size:1em;" onclick="finishScouting()">ì‹œì¦Œ ì‹œì‘ (GO SEASON)</button>
    </div>
    <div style="display:flex; gap:20px; height:80%;">
        <div style="flex:1; background:#222; padding:15px; border-radius:10px; border:1px solid #444; display:flex; flex-direction:column;">
            <h3 style="margin-top:0; border-bottom:1px solid #555; padding-bottom:10px; color:var(--ow-orange);">FA MARKET (ë¬´ì†Œì†)</h3>
            <div style="margin-bottom:10px;">
                <button class="pool-filter-btn active" onclick="renderFAList('ALL')">ALL</button>
                <button class="pool-filter-btn" onclick="renderFAList('TANK')">TANK</button>
                <button class="pool-filter-btn" onclick="renderFAList('DPS')">DPS</button>
                <button class="pool-filter-btn" onclick="renderFAList('SUP')">SUP</button>
            </div>
            <div id="fa-list" style="overflow-y:auto; flex-grow:1; padding-right:5px;"></div>
        </div>
        <div style="width:320px; background:#1e2329; padding:15px; border-radius:10px; border:1px solid #333;">
            <h3 style="margin-top:0; border-bottom:1px solid #555; padding-bottom:10px;">MY ROSTER</h3>
            <div id="scout-my-roster"></div>
        </div>
    </div>
</div>

   <div id="ui-rolestar" class="ui-phase" style="background: radial-gradient(circle at center, #2a2a2a 0%, #000 100%);">
    <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
        <h1 style="font-size:4em; color:var(--gold); text-shadow:0 0 30px var(--gold); margin-bottom:10px; font-style:italic;">â˜… ROLE STARS â˜…</h1>
        <p style="color:#aaa; margin-bottom:40px; font-size:1.2em;">ì •ê·œ ì‹œì¦Œ ìµœê³ ì˜ í™œì•½ì„ í¼ì¹œ ì„ ìˆ˜ë“¤ì…ë‹ˆë‹¤.</p>
        
        <div id="rolestar-container" style="display:flex; justify-content:center; flex-wrap:wrap; max-width:1200px;">
            </div>

        <button class="action-btn" style="margin-top:50px; background:var(--gold); color:black; border:none; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);" onclick="finishRoleStar()">
            í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì§„ì… (GO PLAYOFFS)
        </button>
    </div>
</div>


        <div id="log-window">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ. íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
    </div>
</div>

<script>
// â–¼â–¼â–¼ [7,8ë‹¨ê³„] ì„ ìˆ˜ ì˜êµ¬ ê¸°ë¡ ì €ì¥ì†Œ (ì´ì /ë³µê·€ ëŒ€ì‘) â–¼â–¼â–¼
    let PLAYER_HISTORY = {}; // { "PlayerName": { k:0, d:0, a:0, dmg:0, heal:0, mit:0, potm:0, roleStar:0, sets:0 } }

    // ê¸°ë¡ ì—…ë°ì´íŠ¸ ë„ìš°ë¯¸ í•¨ìˆ˜
    function updateHistoryData(name, stats) {
        if (!PLAYER_HISTORY[name]) {
            PLAYER_HISTORY[name] = { k:0, d:0, a:0, dmg:0, heal:0, mit:0, potm:0, roleStar:0, sets:0 };
        }
        let h = PLAYER_HISTORY[name];
        if (stats) { // ì„¸íŠ¸ ìŠ¤íƒ¯ì´ ë„˜ì–´ì˜¨ ê²½ìš° (KDA ë“±)
            h.k += stats.k; h.d += stats.d; h.a += stats.a;
            h.dmg += stats.dmg; h.heal += stats.heal; h.mit += stats.mit;
            h.sets++;
        }
    }

    // POTM, RoleStar ë“± ë‹¨ì¼ ìŠ¤íƒ¯ ì¦ê°€ í•¨ìˆ˜
    function updateHistorySingle(name, type) {
        if (!PLAYER_HISTORY[name]) updateHistoryData(name, null); // ë°ì´í„° ì—†ìœ¼ë©´ ìƒì„±
        if (type === 'POTM') PLAYER_HISTORY[name].potm++;
        if (type === 'ROLE_STAR') PLAYER_HISTORY[name].roleStar++;
    }
    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
    // --- DATA ---
    const HEROES = {
        TANK: [{n:"ë””ë°”",t:"Poke"},{n:"ë‘ í”¼ìŠ¤íŠ¸",t:"Dive"},{n:"ìœˆìŠ¤í„´",t:"Dive"},{n:"ì‹œê·¸ë§ˆ",t:"Poke"},{n:"ë¼ì¸í•˜ë¥´íŠ¸",t:"Rush"},{n:"ë¼ë§ˆíŠ¸ë¼",t:"Rush"},{n:"ì˜¤ë¦¬ì‚¬",t:"Poke"},{n:"ìë¦¬ì•¼",t:"Rush"},{n:"ë§ˆìš°ê°€",t:"Rush"},{n:"ì •ì»¤í€¸",t:"Rush"},{n:"ë ˆí‚¹ë³¼",t:"Dive"},{n:"ë¡œë“œí˜¸ê·¸",t:"Poke"},{n:"í•´ì €ë“œ",t:"Dive"}],
        DPS: [{n:"íŠ¸ë ˆì´ì„œ",t:"Dive"},{n:"ê²ì§€",t:"Dive"},{n:"ì†Œì „",t:"Poke"},{n:"ìºì„œë””",t:"Poke"},{n:"ì—ì½”",t:"Dive"},{n:"ìœ„ë„ìš°ë©”ì´ì»¤",t:"Poke"},{n:"ë©”ì´",t:"Rush"},{n:"ë¦¬í¼",t:"Rush"},{n:"ì• ì‰¬",t:"Poke"},{n:"ì†œë¸Œë¼",t:"Dive"},{n:"ì†”ì €: 76",t:"Poke"},{n:"íŒŒë¼",t:"Poke"},{n:"ë°”ìŠ¤í‹°ì˜¨",t:"Poke"},{n:"ë²¤ë°íƒ€",t:"Dive"},{n:"ë²¤ì²˜",t:"Dive"},{n:"ì‹œë©”íŠ¸ë¼",t:"Rush"},{n:"ì •í¬ë«",t:"Poke"},{n:"í† ë¥´ë¹„ìš˜",t:"Poke"},{n:"í”„ë ˆì•¼",t:"Poke"},{n:"í•œì¡°",t:"Poke"}],
        SUP: [{n:"ì•„ë‚˜",t:"Poke"},{n:"í‚¤ë¦¬ì½”",t:"Dive"},{n:"ë£¨ì‹œìš°",t:"Rush"},{n:"ë¸Œë¦¬ê¸°í…Œ",t:"Poke"},{n:"ë°”í‹°ìŠ¤íŠ¸",t:"Poke"},{n:"ì£¼ë…¸",t:"Rush"},{n:"ì  ì•¼íƒ€",t:"Poke"},{n:"ì¼ë¦¬ì•„ë¦¬",t:"Poke"},{n:"ë¼ì´í”„ìœ„ë²„",t:"Poke"},{n:"ëª¨ì´ë¼",t:"Rush"},{n:"ë©”ë¥´ì‹œ",t:"Poke"},{n:"ìš°ì–‘",t:"Poke"}]
    };
    const HERO_SKILLS = {
        "ë””ë°”": "ìí­", "ë‘ í”¼ìŠ¤íŠ¸": "íŒŒë©¸ì˜ ì¼ê²©", "ìœˆìŠ¤í„´": "ì›ì‹œì˜ ë¶„ë…¸", "ì‹œê·¸ë§ˆ": "ì¤‘ë ¥ ë¶•ê´´", "ë¼ì¸í•˜ë¥´íŠ¸": "ëŒ€ì§€ë¶„ì‡„", "ë¼ë§ˆíŠ¸ë¼": "ì ˆë©¸", "ì˜¤ë¦¬ì‚¬": "ëŒ€ì§€ì˜ ì°½", "ìë¦¬ì•¼": "ì¤‘ë ¥ìíƒ„", "ë§ˆìš°ê°€": "ì¼€ì´ì§€", "ì •ì»¤í€¸": "ì‚´ìœ¡", "ë ˆí‚¹ë³¼": "ì§€ë¢°ë°­", "ë¡œë“œí˜¸ê·¸": "ë¼ì¬ì•™", "í•´ì €ë“œ": "ê°€ì‹œì†Œë‚˜ê¸°",
        "íŠ¸ë ˆì´ì„œ": "í„ìŠ¤ í­íƒ„", "ê²ì§€": "ìš©ê²€", "ì†Œì „": "ì˜¤ë²„í´ëŸ­", "ìºì„œë””": "í™©ì•¼ì˜ ë¬´ë²•ì", "ì—ì½”": "ë³µì œ", "ìœ„ë„ìš°ë©”ì´ì»¤": "í—¤ë“œìƒ·", "ë©”ì´": "ëˆˆë³´ë¼", "ë¦¬í¼": "ì£½ìŒì˜ ê½ƒ", "ì• ì‰¬": "ë°¥(B.O.B)", "ì†œë¸Œë¼": "EMP", "ì†”ì €: 76": "ì „ìˆ  ì¡°ì¤€ê²½", "íŒŒë¼": "í¬í™”", "ë°”ìŠ¤í‹°ì˜¨": "í¬ê²©", "ë²¤ë°íƒ€": "ê°ˆë¼ë‚´ëŠ” ì¹¼ë‚ ", "ë²¤ì²˜": "ì§€ê° ì¶©ê²©", "ì‹œë©”íŠ¸ë¼": "ê´‘ì ë°©ë²½", "ì •í¬ë«": "ì£½ì´ëŠ” íƒ€ì´ì–´", "í† ë¥´ë¹„ìš˜": "ì´ˆê³ ì—´ ìš©ê´‘ë¡œ", "í”„ë ˆì•¼": "ì˜¬ê°€ë¯¸ ì‚¬ê²©", "í•œì¡°": "ìš©ì˜ ì¼ê²©",
        "ì•„ë‚˜": "ë‚˜ë…¸ ê°•í™”ì œ", "í‚¤ë¦¬ì½”": "ì—¬ìš°ê¸¸", "ë£¨ì‹œìš°": "ì†Œë¦¬ ë°©ë²½", "ë¸Œë¦¬ê¸°í…Œ": "ì§‘ê²°", "ë°”í‹°ìŠ¤íŠ¸": "ì¦í­ ë§¤íŠ¸ë¦­ìŠ¤", "ì£¼ë…¸": "ê¶¤ë„ ê´‘ì„ ", "ì  ì•¼íƒ€": "ì´ˆì›”", "ì¼ë¦¬ì•„ë¦¬": "íƒœì–‘ ì‘ë ¬", "ë¼ì´í”„ìœ„ë²„": "ìƒëª…ì˜ ë‚˜ë¬´", "ëª¨ì´ë¼": "ìœµí™”", "ë©”ë¥´ì‹œ": "ë°œí‚¤ë¦¬", "ìš°ì–‘": "í•´ì¼ í­ë°œ"
    };

    const COMMENTARY_DB = {
        OPENING: [
            "ê±°ì ì´ ì—´ë¦½ë‹ˆë‹¤! ì–‘ íŒ€ ëª¨ë‘ ì¹˜ì—´í•˜ê²Œ ìë¦¬ë¥¼ ì¡ìŠµë‹ˆë‹¤.",
            "ì´ˆë°˜ êµì „, ì„œë¡œ ì‹ ì¤‘í•˜ê²Œ ìŠ¤í‚¬ì„ êµí™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
            "ë¹ ë¥´ê²Œ ì¹˜ê³  ë“¤ì–´ê°€ëŠ” ì„ ê³µ! ë°˜ì‘ ì†ë„ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "íƒ±ì»¤ì§„ì˜ í˜ì‹¸ì›€ì´ ì‹œì‘ë©ë‹ˆë‹¤. ìì¡´ì‹¬ ëŒ€ê²°ì´ë„¤ìš”.",
            // [ì¶”ê°€ë¨]
            "ì „ì¥ì— ê¸´ì¥ê°ì´ ê°ë•ë‹ˆë‹¤. ì²« í‚¬ì´ ìŠ¹ë¶€ì˜ í–¥ë°©ì„ ê°€ë¥¼ ê²ƒì…ë‹ˆë‹¤.",
            "ì–‘ íŒ€ì˜ ì¡°í•© ìƒ‰ê¹”ì´ ëª…í™•í•©ë‹ˆë‹¤! ì°½ê³¼ ë°©íŒ¨ì˜ ëŒ€ê²°ì…ë‹ˆë‹¤.",
            "ê´€ì¤‘ë“¤ì˜ í•¨ì„± ì†Œë¦¬ì™€ í•¨ê»˜ ê²½ê¸°ê°€ ì‹œì‘ë©ë‹ˆë‹¤!",
            "ì¢‹ì€ ìœ„ì¹˜ë¥¼ ì„ ì í•˜ê¸° ìœ„í•œ ëˆˆì¹˜ ì‹¸ì›€ì´ ì¹˜ì—´í•©ë‹ˆë‹¤.",
            "ê³¼ì—° ì¤€ë¹„í•´ì˜¨ ì „ëµì´ í†µí• ê¹Œìš”? íƒìƒ‰ì „ì´ ì´ì–´ì§‘ë‹ˆë‹¤."
        ],
        MISTAKE: [
            "ì•„, **{player}**ì˜ **{hero}**! **{skill}**ì´ í—ˆê³µì„ ê°€ë¦…ë‹ˆë‹¤! ë¼ˆì•„í”ˆ ì‹¤ìˆ˜ë„¤ìš”.",
            "**{player}** ì„ ìˆ˜, ë„ˆë¬´ ê¹Šê²Œ ë“¤ì–´ê°”ì–´ìš”! ì•„êµ° ì¼€ì–´ë¥¼ ë°›ì§€ ëª»í•˜ê³  ì˜ë¦½ë‹ˆë‹¤.",
            "**{hero}**(**{player}**)ì˜ í¬ì§€ì…˜ì´ ê¼¬ì˜€ìŠµë‹ˆë‹¤. í—ˆë¬´í•˜ê²Œ ì£½ê³  ë§ˆë„¤ìš”.",
            "ë‚™ì‚¬! **{player}** ì„ ìˆ˜ê°€ ë§µì„ ì œëŒ€ë¡œ í™•ì¸í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¶„ìœ„ê¸° ì‹¸í•´ì§€ëŠ”ë°ìš”.",
            "ìŠ¤í‚¬ ì¿¨íƒ€ì„ ê³„ì‚° ë¯¸ìŠ¤ì¸ê°€ìš”? **{player}** ì„ ìˆ˜, ì¤‘ìš”í•  ë•Œ **{skill}**ì´ ì—†ì–´ìš”!",
            // [ì¶”ê°€ë¨]
            "**{player}**, ë¬´ë¦¬í•˜ê²Œ ë”œì„ ë„£ìœ¼ë ¤ë‹¤ ì—­ìœ¼ë¡œ ë‹¹í•©ë‹ˆë‹¤! ìš•ì‹¬ì´ì—ˆì–´ìš”.",
            "íëŸ¬ ë¼ì¸ê³¼ ê±°ë¦¬ê°€ ë„ˆë¬´ ë©‰ë‹ˆë‹¤! **{player}** ì„ ìˆ˜ ê³ ë¦½ë©ë‹ˆë‹¤.",
            "ì•„... **{hero}**(**{player}**), ê¶ê·¹ê¸°ë¥¼ ìº”ìŠ¬ë‹¹í•©ë‹ˆë‹¤! ìµœì•…ì˜ ìƒí™©!",
            "**{player}** ì„ ìˆ˜ì˜ íŒë‹¨ ë¯¸ìŠ¤! ë“¤ì–´ê°ˆ íƒ€ì´ë°ì´ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.",
            "ì¹˜ëª…ì ì¸ ì‹¤ì±…ì…ë‹ˆë‹¤. **{player}** ì„ ìˆ˜ê°€ ì•„ë¬´ê²ƒë„ ëª» í•˜ê³  ì§¤ë¦½ë‹ˆë‹¤."
        ],
        CRACK: [
            "**{player}**ì˜ **{hero}**! ë§ë„ ì•ˆ ë˜ëŠ” í”¼ì§€ì»¬ë¡œ ì „ì¥ì„ íœ©ì“¸ì–´ë²„ë¦½ë‹ˆë‹¤!",
            "ì €ê±¸ ì‚´ì•„ê°€ë‚˜ìš”? ì•„ë‹ˆ, ì˜¤íˆë ¤ **{player}** ì„ ìˆ˜ê°€ ìƒëŒ€ë¥¼ ì¡ì•„ëƒ…ë‹ˆë‹¤! ìŠˆí¼í”Œë ˆì´!",
            "**{hero}**(**{player}**)ì˜ ì™„ë²½í•œ ì—ì„ íŠ¸ë˜í‚¹! ìƒëŒ€ê°€ ìˆ¨ë„ ëª» ì‰¬ê³  ì‚­ì œë©ë‹ˆë‹¤.",
            "ì…ì´ ë‹¤ë¬¼ì–´ì§€ì§€ ì•ŠëŠ” ë³€ìˆ˜ ì°½ì¶œ! **{player}** ì„ ìˆ˜ê°€ ë°”ë¡œ 'í¬ë™'ì…ë‹ˆë‹¤!",
            "**{player}**ì˜ **{hero}**! ë°˜ì‘ì†ë„ë¡œ ìƒëŒ€ ê¶ê·¹ê¸°ë¥¼ **{skill}**ë¡œ ì”¹ì–´ë²„ë¦½ë‹ˆë‹¤! ë¯¸ì³¤ìŠµë‹ˆë‹¤!",
            // [ì¶”ê°€ë¨]
            "í˜¼ìì„œ ì „í™©ì„ ë’¤ì§‘ìŠµë‹ˆë‹¤! **{player}**, ì´ê²ƒì´ 'ìŠˆí¼ìŠ¤íƒ€'ì˜ í’ˆê²©ì…ë‹ˆë‹¤!",
            "**{hero}**(**{player}**), ë³´ì´ì§€ ì•ŠëŠ” ê°ì—ì„œ í‚¬ì„ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤! ìœ ë ¹ì¸ê°€ìš”?",
            "ì™„ë²½í•œ ìŠ¤í‚¬ í™œìš©! **{player}** ì„ ìˆ˜ê°€ í•œíƒ€ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤!",
            "**{player}**ì˜ í”¼ì§€ì»¬ì´ í­ë°œí•©ë‹ˆë‹¤! ì•„ë¬´ë„ ê·¸ë¥¼ ë§‰ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
            "ì´ê±´ ë§¤ë“œë¬´ë¹„ ê°ì…ë‹ˆë‹¤! **{player}**, ê¸°ì  ê°™ì€ ìƒì¡´ ëŠ¥ë ¥ê³¼ í‚¬ ê²°ì •ë ¥!"
        ],
        TEAMWORK_COMEBACK: [
            "ë¶ˆë¦¬í•œ ìƒí™©, í•˜ì§€ë§Œ ì—„ì²­ë‚œ í•œíƒ€ ì§‘ì¤‘ë ¥ìœ¼ë¡œ ë²„í…¨ëƒ…ë‹ˆë‹¤!",
            "ìƒëŒ€ì˜ ì‹¤ìˆ˜ë¥¼ ë†“ì¹˜ì§€ ì•Šê³  ì™„ë²½í•œ í¬ì»¤ì‹±ìœ¼ë¡œ ì—­ì „ê°ì„ ë´…ë‹ˆë‹¤.",
            "ê¶ê·¹ê¸° ì—°ê³„ê°€ ì˜ˆìˆ ì…ë‹ˆë‹¤! í•œíƒ€ ëŒ€ìŠ¹!",
            "íŒ€í•©ì´ ë¬´ë„ˆì§„ ìƒëŒ€ë¥¼ ê°ê°œê²©íŒŒí•©ë‹ˆë‹¤. ë¶„ìœ„ê¸° ë„˜ì–´ì™”ì–´ìš”!",
            // [ì¶”ê°€ë¨]
            "ê¸°ì ì ì¸ ë¹„ë¹„ê¸°! ì¶”ê°€ ì‹œê°„ì„ ë²Œë©´ì„œ ì•„êµ°ì´ í•©ë¥˜í•©ë‹ˆë‹¤!",
            "í™˜ìƒì ì¸ ì–´ê·¸ë¡œ í•‘í! ì„œë¡œ ë¹¨í”¼ë¡œ ì‚´ì•„ê°€ë©° ìƒëŒ€ë¥¼ ì „ë©¸ì‹œí‚µë‹ˆë‹¤.",
            "ì´ê±¸ ë§‰ì•„ë‚´ë‚˜ìš”? ì² ë²½ê°™ì€ ìˆ˜ë¹„ë¡œ ìœ„ê¸°ë¥¼ ê¸°íšŒë¡œ ë§Œë“­ë‹ˆë‹¤.",
            "ì™„ë²½í•œ ë¸Œë¦¬í•‘, ì™„ë²½í•œ í˜¸í¡! ë¶ˆë¦¬í•œ í•œíƒ€ë¥¼ ë’¤ì§‘ìŠµë‹ˆë‹¤.",
            "ì„œí¬í„°ë“¤ì˜ ì¼€ì–´ê°€ ëˆˆë¶€ì‹­ë‹ˆë‹¤! ì¢€ë¹„ì²˜ëŸ¼ ë˜ì‚´ì•„ë‚˜ì„œ ì—­ê³µí•©ë‹ˆë‹¤."
        ],
        TEAMWORK_FAIL: [
            "íŒ€ì› ê°„ì˜ ì‚¬ì¸ì´ ì „í˜€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¡œ ë†€ê³  ìˆì–´ìš”.",
            "ê¶ê·¹ê¸°ë¥¼ ì•„ë¼ë‹¤ê°€ í•œíƒ€ê°€ í„°ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤. ì†Œí†µ ë¶€ì¬ë„¤ìš”.",
            "ë°±ì—…ì´ ë„ˆë¬´ ëŠ¦ìŠµë‹ˆë‹¤! ê°ê°œê²©íŒŒ ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
            // [ì¶”ê°€ë¨]
            "ì§„ì˜ì´ ì™„ì „íˆ ë¶•ê´´ë˜ì—ˆìŠµë‹ˆë‹¤. ì†ìˆ˜ë¬´ì±…ìœ¼ë¡œ ë°€ë¦½ë‹ˆë‹¤.",
            "ì˜¤ë”ê°€ ê°ˆë¦° ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìš°ì™•ì¢Œì™•í•˜ë‹¤ê°€ ì „ë©¸í•©ë‹ˆë‹¤.",
            "ìƒëŒ€ ê¶ê·¹ê¸° ì²´í¬ê°€ ì•ˆ ëë‚˜ìš”? ëŒ€ì²˜ë¥¼ ì „í˜€ ëª» í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
            "ë¬´ë¦¬í•˜ê²Œ ì§„ì…í•˜ë‹¤ê°€ ì§¤ë¦¬ê³ , ë¦¬ìŠ¤í°ì´ ê³„ì† ê¼¬ì…ë‹ˆë‹¤.",
            "ì´ì²´ì  ë‚œêµ­ì…ë‹ˆë‹¤. íŒ€ì ì¸ ì›€ì§ì„ì´ ì „í˜€ ë³´ì´ì§€ ì•Šì•„ìš”."
        ]
    };

    function getHeroRole(name) {
        if(HEROES.TANK.find(h=>h.n===name)) return "TANK";
        if(HEROES.DPS.find(h=>h.n===name)) return "DPS";
        if(HEROES.SUP.find(h=>h.n===name)) return "SUP";
        return "UNKNOWN";
    }

    const ORIGINAL_TEAM_DB = {
        "Crazy Raccoon": [
            {n:"Junbin",r:"TANK",a:90,s:98,m:96,t:99,ms:["ìœˆìŠ¤í„´","ë ˆí‚¹ë³¼"]},
            {n:"Max",r:"TANK",a:93,s:95,m:92,t:95,ms:["ì‹œê·¸ë§ˆ","ìë¦¬ì•¼"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Lip",r:"DPS",a:99,s:96,m:98,t:95,ms:["ì†Œì „","ì†œë¸Œë¼"], trait:"ë² í…Œë‘"},
            {n:"HeeSang",r:"DPS",a:96,s:95,m:93,t:96,ms:["íŠ¸ë ˆì´ì„œ","íŒŒë¼"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Sp1nt",r:"DPS",a:94,s:88,m:89,t:87,ms:["ê²ì§€"], trait:"ìœ ë§ì£¼"},
            {n:"Shu",r:"SUP",a:97,s:99,m:98,t:98,ms:["ì•„ë‚˜","ë°”í‹°ìŠ¤íŠ¸"], trait:"ë² í…Œë‘"},
            {n:"Chorong",r:"SUP",a:88,s:99,m:97,t:99,ms:["ë£¨ì‹œìš°","ìš°ì–‘"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"}
        ],
        "Team Falcons": [
            {n:"Someone",r:"TANK",a:92,s:99,m:97,t:98,ms:["ë¼ë§ˆíŠ¸ë¼"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Hanbin",r:"TANK",a:93,s:97,m:98,t:98,ms:["ì •ì»¤í€¸","ë””ë°”"], trait:"ë² í…Œë‘"},
            {n:"Proper",r:"DPS",a:99,s:98,m:96,t:95,ms:["íŠ¸ë ˆì´ì„œ","ê²ì§€"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Mer1t",r:"DPS",a:97,s:94,m:94,t:95,ms:["ì†Œì „","ìºì„œë””"]},
            {n:"Fielder",r:"SUP",a:90,s:99,m:98,t:99,ms:["ì•„ë‚˜","í‚¤ë¦¬ì½”"], trait:"ë² í…Œë‘"},
            {n:"Chiyo",r:"SUP",a:85,s:98,m:98,t:99,ms:["ë£¨ì‹œìš°","ë¸Œë¦¬ê¸°í…Œ"], trait:"ë² í…Œë‘"}
        ],
        "ZETA DIVISION": [
            {n:"Mag",r:"TANK",a:88,s:89,m:88,t:88,ms:["ìœˆìŠ¤í„´","ë¼ì¸í•˜ë¥´íŠ¸"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Bernar",r:"TANK",a:92,s:94,m:94,t:94,ms:["ì˜¤ë¦¬ì‚¬"], trait:"ë² í…Œë‘"},
            {n:"AlphaYi",r:"DPS",a:96,s:94,m:92,t:93,ms:["ê²ì§€","íŠ¸ë ˆì´ì„œ"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Pelican",r:"DPS",a:95,s:95,m:93,t:94,ms:["ì—ì½”","ë©”ì´"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Probe",r:"DPS",a:96,s:85,m:84,t:90,ms:["í”„ë ˆì•¼","ì• ì‰¬"]},
            {n:"Bliss",r:"SUP",a:87,s:95,m:94,t:97,ms:["ë£¨ì‹œìš°"]},
            {n:"Finn",r:"SUP",a:92,s:92,m:90,t:92,ms:["í‚¤ë¦¬ì½”"]}
        ],
        "T1": [
            {n:"Donghak",r:"TANK",a:87,s:91,m:88,t:91,ms: ["ë‘ í”¼ìŠ¤íŠ¸","ë ˆí‚¹ë³¼"]},
            {n:"Jasm1ne",r:"TANK",a:88,s:91,m:89,t:91,ms:["ìë¦¬ì•¼","ì‹œê·¸ë§ˆ"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Proud",r:"DPS",a:97,s:90,m:90,t:89,ms:["í”„ë ˆì•¼","ìœ„ë„ìš°ë©”ì´ì»¤"], trait:"ìœ ë§ì£¼"},
            {n:"Zest",r:"DPS",a:94,s:94,m:92,t:93,ms:["íŠ¸ë ˆì´ì„œ","ë²¤ì²˜"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Viper",r:"DPS",a:94,s:89,m:92,t:93,ms:["ê²ì§€"]},
            {n:"Skewed",r:"SUP",a:86,s:95,m:94,t:96,ms:["ì  ì•¼íƒ€","ë¸Œë¦¬ê¸°í…Œ"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Vigilante",r:"SUP",a:93,s:91,m:90,t:91,ms:["ì•„ë‚˜","ì  ì•¼íƒ€"]}
        ],
        "WAE": [
            {n:"Mealgaru",r:"TANK",a:86,s:89,m:88,t:89,ms:["ë ˆí‚¹ë³¼"]},
            {n:"Ade",r:"DPS",a:94,s:88,m:87,t:88,ms:["ì†Œì „","í”„ë ˆì•¼"], trait:"ìœ ë§ì£¼"},
            {n:"SeonJun",r:"DPS",a:89,s:88,m:87,t:88,ms:["íŠ¸ë ˆì´ì„œ","ë²¤ì²˜"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"},
            {n:"Taejong",r:"DPS",a:92,s:80,m:82,t:85,ms:["íŠ¸ë ˆì´ì„œ"]},
            {n:"Maka",r:"SUP",a:88,s:99,m:88,t:89,ms:["ì•„ë‚˜"]},
            {n:"Leesoomin",r:"SUP",a:88,s:89,m:88,t:89,ms:["í‚¤ë¦¬ì½”"], trait:"ë‹¤ì¬ë‹¤ëŠ¥"}
        ],
        "Onside Gaming": [
            {n:"Attack",r:"TANK",a:87,s:88,m:88,t:89,ms:["ë””ë°”"]},
            {n:"Kellan",r:"TANK",a:89,s:88,m:87,t:89,ms:["ìœˆìŠ¤í„´"]},
            {n:"Knife",r:"DPS",a:93,s:89,m:88,t:89,ms:["íŠ¸ë ˆì´ì„œ", "ì†Œì „"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Ado",r:"DPS",a:85,s:88,m:88,t:89,ms:["ê²ì§€"]},
            {n:"Kilo",r:"DPS",a:90,s:80,m:85,t:87,ms:["í”„ë ˆì•¼","ìºì„œë””"], trait:"ë¶„ìœ„ê¸°ë©”ì´ì»¤"},
            {n:"Opener",r:"SUP",a:80,s:87,m:85,t:88,ms:["ë£¨ì‹œìš°"]},
            {n:"Irony",r:"SUP",a:88,s:87,m:86,t:88,ms:["ì•„ë‚˜"]}
        ],
        "Mir Gaming": [
            {n:"Ruler",r:"TANK",a:88,s:87,m:86,t:87,ms:["ìë¦¬ì•¼"], trait:"ìœ ë§ì£¼"},
            {n:"Azent",r:"DPS",a:90,s:87,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ"]},
            {n:"K4ne",r:"DPS",a:86,s:87,m:88,t:86,ms:["ë¦¬í¼"]},
            {n:"Flos",r:"DPS",a:88,s:87,m:88,t:86,ms:["ì†Œì „"]},
            {n:"Mcd",r:"SUP",a:82,s:88,m:85,t:88,ms:["ì  ì•¼íƒ€"], trait:"ë² í…Œë‘"},
            {n:"Univ2r",r:"SUP",a:87,s:88,m:85,t:88,ms:["í‚¤ë¦¬ì½”"]}
        ],
        "Old Ocean": [
            {n:"Gur3um",r:"TANK",a:86,s:89,m:88,t:89,ms:["í•´ì €ë“œ","ë””ë°”"]},
            {n:"Heiser",r:"TANK",a:86,s:89,m:88,t:89,ms:["ìœˆìŠ¤í„´","ë ˆí‚¹ë³¼"], trait:"ìœ ë§ì£¼"},
            {n:"A1ien",r:"DPS",a:90,s:88,m:88,t:86,ms:["ìœ„ë„ìš°ë©”ì´ì»¤"]},
            {n:"D4rt",r:"DPS",a:86,s:87,m:88,t:86,ms:["ë¦¬í¼"]},
            {n:"Becky",r:"DPS",a:91,s:87,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ","ì—ì½”"], trait:"ì†Œë…„ê°€ì¥"},
            {n:"Ryujehong",r:"SUP",a:85,s:92,m:90,t:90,ms:["ì•„ë‚˜","ë¼ì´í”„ìœ„ë²„"], trait:"ë² í…Œë‘"},
            {n:"Kivis",r:"SUP",a:91,s:86,m:85,t:88,ms:["í‚¤ë¦¬ì½”"], trait:"ìœ ë§ì£¼"}
        ],
        "Cheeseburger": [
            {n:"Farmer",r:"TANK",a:87,s:87,m:86,t:87,ms:["ë¡œë“œí˜¸ê·¸"]},
            {n:"SeungAn",r:"TANK",a:87,s:87,m:86,t:87,ms:["ì‹œê·¸ë§ˆ"]},
            {n:"Argon",r:"DPS",a:88,s:86,m:86,t:87,ms:["íŠ¸ë ˆì´ì„œ"]},
            {n:"D0d0",r:"DPS",a:88,s:86,m:86,t:87,ms:["ê²ì§€"], trait:"ìœ ë§ì£¼"},
            {n:"Zesin",r:"DPS",a:88,s:86,m:86,t:87,ms:["í”„ë ˆì•¼"]},
            {n:"Woochan",r:"SUP",a:86,s:86,m:85,t:88,ms:["ì•„ë‚˜"]},
            {n:"Faith",r:"SUP",a:86,s:86,m:85,t:88,ms:["ë¸Œë¦¬ê¸°í…Œ"]}
        ]
    };

    let TEAM_DB = JSON.parse(JSON.stringify(ORIGINAL_TEAM_DB)); 

    const MAP_META = {
        "ì‚¬ëª¨ì•„": { type: "Control", good: ["ë§ˆìš°ê°€", "ë©”ì´", "ë£¨ì‹œìš°", "ë¦¬í¼", "ëª¨ì´ë¼"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤", "ì‹œê·¸ë§ˆ", "ì• ì‰¬", "ì•„ë‚˜", "ì  ì•¼íƒ€"] },
        "ì˜¤ì•„ì‹œìŠ¤": { type: "Control", good: ["íŒŒë¼", "íŠ¸ë ˆì´ì„œ", "ìœˆìŠ¤í„´", "ë©”ë¥´ì‹œ", "í‚¤ë¦¬ì½”"], bad: ["ì •í¬ë«", "í† ë¥´ë¹„ìš˜", "ë¼ì¸í•˜ë¥´íŠ¸", "ë¸Œë¦¬ê¸°í…Œ", "ì  ì•¼íƒ€"] },
        "ì¼ë¦¬ì˜¤ìŠ¤": { type: "Control", good: ["íŒŒë¼", "ì—ì½”", "ë¡œë“œí˜¸ê·¸", "ë£¨ì‹œìš°", "ë©”ë¥´ì‹œ"], bad: ["ë¦¬í¼", "ì‹œë©”íŠ¸ë¼", "ìë¦¬ì•¼", "ë°”í‹°ìŠ¤íŠ¸", "ì¼ë¦¬ì•„ë¦¬"] },
        "ë¶€ì‚°": { type: "Control", good: ["ì†Œì „", "ì†œë¸Œë¼", "ë””ë°”", "í‚¤ë¦¬ì½”", "ì•„ë‚˜"], bad: ["ì •í¬ë«", "ë°”ìŠ¤í‹°ì˜¨", "ë¡œë“œí˜¸ê·¸", "ë¼ì´í”„ìœ„ë²„", "ì  ì•¼íƒ€"] },
        "ì™•ì˜ ê¸¸": { type: "Hybrid", good: ["ìºì„œë””", "ë©”ì´", "ë£¨ì‹œìš°", "ì•„ë‚˜", "ë¼ì¸í•˜ë¥´íŠ¸"], bad: ["íŒŒë¼", "ì†œë¸Œë¼", "ë ˆí‚¹ë³¼", "ë©”ë¥´ì‹œ", "ë¼ì´í”„ìœ„ë²„"] },
        "í• ë¦¬ìš°ë“œ": { type: "Hybrid", good: ["ì‹œê·¸ë§ˆ", "ì• ì‰¬", "ì†Œì „", "ë©”ë¥´ì‹œ", "ë°”í‹°ìŠ¤íŠ¸"], bad: ["ì •í¬ë«", "ë¦¬í¼", "ë¼ì¸í•˜ë¥´íŠ¸", "ëª¨ì´ë¼", "ë¸Œë¦¬ê¸°í…Œ"] },
        "ì•„ì´í—¨ë°œë°": { type: "Hybrid", good: ["íŒŒë¼", "ì •í¬ë«", "ë‘ í”¼ìŠ¤íŠ¸", "ì•„ë‚˜", "ë¸Œë¦¬ê¸°í…Œ"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤", "íŠ¸ë ˆì´ì„œ", "ë¡œë“œí˜¸ê·¸", "ëª¨ì´ë¼", "ì  ì•¼íƒ€"] },
        "ìˆ˜ë¼ë°”ì‚¬": { type: "Flashpoint", good: ["ê²ì§€", "ì‹œë©”íŠ¸ë¼", "ë¼ë§ˆíŠ¸ë¼", "ë£¨ì‹œìš°", "í‚¤ë¦¬ì½”"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤", "ì‹œê·¸ë§ˆ", "ì• ì‰¬", "ì•„ë‚˜", "ì  ì•¼íƒ€"] },
        "ì•„í‹€ë¦¬ìŠ¤": { type: "Flashpoint", good: ["ì •ì»¤í€¸", "íŠ¸ë ˆì´ì„œ", "ì†”ì €: 76", "ë£¨ì‹œìš°", "ëª¨ì´ë¼"], bad: ["ìœ„ë„ìš°ë©”ì´ì»¤", "í•œì¡°", "ë¼ì¸í•˜ë¥´íŠ¸", "ë°”í‹°ìŠ¤íŠ¸", "ì¼ë¦¬ì•„ë¦¬"] },
        "ë‰´ í€¸ ìŠ¤íŠ¸ë¦¬íŠ¸": { type: "Push", good: ["ì†Œì „", "ë²¤ì²˜", "ë£¨ì‹œìš°", "ë¼ë§ˆíŠ¸ë¼", "í‚¤ë¦¬ì½”"], bad: ["íŒŒë¼", "ì •í¬ë«", "ë¡œë“œí˜¸ê·¸", "ë©”ë¥´ì‹œ", "ë¼ì´í”„ìœ„ë²„"] },
        "ì—ìŠ¤í˜ë€ì‚¬": { type: "Push", good: ["ìœˆìŠ¤í„´", "ìœ„ë„ìš°ë©”ì´ì»¤", "íŠ¸ë ˆì´ì„œ", "ì•„ë‚˜", "ë¸Œë¦¬ê¸°í…Œ"], bad: ["ë©”ì´", "ë¦¬í¼", "ì˜¤ë¦¬ì‚¬", "ëª¨ì´ë¼", "ì¼ë¦¬ì•„ë¦¬"] },
        "ì“°ë ˆê¸°ì´Œ": { type: "Escort", good: ["ìœ„ë„ìš°ë©”ì´ì»¤", "í•œì¡°", "ì‹œê·¸ë§ˆ", "ë°”í‹°ìŠ¤íŠ¸", "ì  ì•¼íƒ€"], bad: ["ì •í¬ë«", "ì‹œë©”íŠ¸ë¼", "ìë¦¬ì•¼", "ëª¨ì´ë¼", "ë£¨ì‹œìš°"] },
        "ê°ì‹œ ê¸°ì§€: ì§€ë¸Œë¡¤í„°": { type: "Escort", good: ["ê²ì§€", "íŠ¸ë ˆì´ì„œ", "ìœˆìŠ¤í„´", "ì•„ë‚˜", "ë¸Œë¦¬ê¸°í…Œ"], bad: ["ë°”ìŠ¤í‹°ì˜¨", "í† ë¥´ë¹„ìš˜", "ë¼ì¸í•˜ë¥´íŠ¸", "ëª¨ì´ë¼", "ì¼ë¦¬ì•„ë¦¬"] },
        "ë¦¬ì•Œí† ": { type: "Escort", good: ["ì• ì‰¬", "ì†Œì „", "ì‹œê·¸ë§ˆ", "ë°”í‹°ìŠ¤íŠ¸", "ì¼ë¦¬ì•„ë¦¬"], bad: ["ë¦¬í¼", "ë‘ í”¼ìŠ¤íŠ¸", "ë£¨ì‹œìš°", "ëª¨ì´ë¼", "ì†œë¸Œë¼"] }
    };
    let MAP_POOLS = {
        "ìŸíƒˆ": ["ì‚¬ëª¨ì•„","ì˜¤ì•„ì‹œìŠ¤","ì¼ë¦¬ì˜¤ìŠ¤","ë¶€ì‚°"],
        "í˜¼í•©": ["ì™•ì˜ ê¸¸","í• ë¦¬ìš°ë“œ","ì•„ì´í—¨ë°œë°"],
        "í”Œë˜ì‹œ": ["ìˆ˜ë¼ë°”ì‚¬","ì•„í‹€ë¦¬ìŠ¤"],
        "ë°€ê¸°": ["ë‰´ í€¸ ìŠ¤íŠ¸ë¦¬íŠ¸","ì—ìŠ¤í˜ë€ì‚¬"],
        "í˜¸ìœ„": ["ì“°ë ˆê¸°ì´Œ","ê°ì‹œ ê¸°ì§€: ì§€ë¸Œë¡¤í„°","ë¦¬ì•Œí† "]
    };
// â–¼â–¼â–¼ [1ë‹¨ê³„] ì¶”ê°€í•  ì½”ë“œ: ëŒ€ê¸° ë§µ ë°ì´í„° ë° ë¡œí…Œì´ì…˜ ë³€ìˆ˜ â–¼â–¼â–¼

    // 1. ëŒ€ê¸° ì¤‘ì¸ ë§µ(Reserve)ì˜ ë©”íƒ€ ë°ì´í„° ì •ì˜ (ì˜¤ë²„ì›Œì¹˜2 ì‹ ê·œ/ê¸°ì¡´ ë§µ í¬í•¨)
    const RESERVE_MAP_META = {
        // [ìŸíƒˆ]
        "ë„¤íŒ”": { type: "Control", good: ["ë¼ë§ˆíŠ¸ë¼", "ë¦¬í¼", "ë©”ì´", "ë£¨ì‹œìš°", "ëª¨ì´ë¼"], bad: ["ì‹œê·¸ë§ˆ", "ìœ„ë„ìš°ë©”ì´ì»¤", "ì• ì‰¬", "ì  ì•¼íƒ€", "ì•„ë‚˜"] },
        "ë¦¬ì¥ íƒ€ì›Œ": { type: "Control", good: ["ë¼ì¸í•˜ë¥´íŠ¸", "íŒŒë¼", "ì •í¬ë«", "ë£¨ì‹œìš°", "ë°”í‹°ìŠ¤íŠ¸"], bad: ["ì‹œê·¸ë§ˆ", "í•œì¡°", "ì• ì‰¬", "ì•„ë‚˜", "ì  ì•¼íƒ€"] },
        "ë‚¨ê·¹ ë°˜ë„": { type: "Control", good: ["ì •ì»¤í€¸", "ë©”ì´", "ì‹œë©”íŠ¸ë¼", "í‚¤ë¦¬ì½”", "ë£¨ì‹œìš°"], bad: ["ìœˆìŠ¤í„´", "ìœ„ë„ìš°ë©”ì´ì»¤", "ê²ì§€", "ë©”ë¥´ì‹œ", "ì  ì•¼íƒ€"] },
        
        // [í˜¼í•©]
        "ë¸”ë¦¬ìë“œ ì›”ë“œ": { type: "Hybrid", good: ["ì‹œê·¸ë§ˆ", "ì†”ì €: 76", "ì†Œì „", "ë°”í‹°ìŠ¤íŠ¸", "ì  ì•¼íƒ€"], bad: ["ìë¦¬ì•¼", "ë¦¬í¼", "ì†œë¸Œë¼", "ëª¨ì´ë¼", "ë£¨ì‹œìš°"] },
        "ëˆ”ë°”ë‹ˆ": { type: "Hybrid", good: ["ìœˆìŠ¤í„´", "ê²ì§€", "ì—ì½”", "ì•„ë‚˜", "ë¸Œë¦¬ê¸°í…Œ"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë¦¬í¼", "ë©”ì´", "ëª¨ì´ë¼", "ë£¨ì‹œìš°"] },
        "ë¯¸ë“œíƒ€ìš´": { type: "Hybrid", good: ["ë””ë°”", "ì†Œì „", "íŠ¸ë ˆì´ì„œ", "ì•„ë‚˜", "ë£¨ì‹œìš°"], bad: ["ì˜¤ë¦¬ì‚¬", "ì •í¬ë«", "í† ë¥´ë¹„ìš˜", "ëª¨ì´ë¼", "ë¼ì´í”„ìœ„ë²„"] },
        "íŒŒë¼ì´ì†Œ": { type: "Hybrid", good: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë©”ì´", "ì‹œë©”íŠ¸ë¼", "ë£¨ì‹œìš°", "ë°”í‹°ìŠ¤íŠ¸"], bad: ["ì‹œê·¸ë§ˆ", "ì• ì‰¬", "í•œì¡°", "ì  ì•¼íƒ€", "ë©”ë¥´ì‹œ"] },

        // [í˜¸ìœ„]
        "ì„œí‚· ë¡œì–„": { type: "Escort", good: ["ì‹œê·¸ë§ˆ", "ìœ„ë„ìš°ë©”ì´ì»¤", "í•œì¡°", "ë°”í‹°ìŠ¤íŠ¸", "ì  ì•¼íƒ€"], bad: ["ìë¦¬ì•¼", "ë¦¬í¼", "ë©”ì´", "ë£¨ì‹œìš°", "ëª¨ì´ë¼"] },
        "ë„ë¼ë„": { type: "Escort", good: ["ìœˆìŠ¤í„´", "ì—ì½”", "ì†œë¸Œë¼", "ì•„ë‚˜", "ë©”ë¥´ì‹œ"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë©”ì´", "ë¦¬í¼", "ë£¨ì‹œìš°", "ëª¨ì´ë¼"] },
        "66ë²ˆ êµ­ë„": { type: "Escort", good: ["ì‹œê·¸ë§ˆ", "ì• ì‰¬", "ìºì„œë””", "ë©”ë¥´ì‹œ", "ì•„ë‚˜"], bad: ["ìë¦¬ì•¼", "ì‹œë©”íŠ¸ë¼", "ë©”ì´", "ëª¨ì´ë¼", "ë¸Œë¦¬ê¸°í…Œ"] },
        "í•˜ë°”ë‚˜": { type: "Escort", good: ["ì˜¤ë¦¬ì‚¬", "ìœ„ë„ìš°ë©”ì´ì»¤", "ì†Œì „", "ë°”í‹°ìŠ¤íŠ¸", "ì  ì•¼íƒ€"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ë¦¬í¼", "ì •í¬ë«", "ë£¨ì‹œìš°", "ëª¨ì´ë¼"] },
        "ìƒ´ë°œë¦¬ ìˆ˜ë„ì›": { type: "Escort", good: ["ë¼ë§ˆíŠ¸ë¼", "ì†Œì „", "ê²ì§€", "ì•„ë‚˜", "í‚¤ë¦¬ì½”"], bad: ["ë¡œë“œí˜¸ê·¸", "íŒŒë¼", "í•œì¡°", "ë©”ë¥´ì‹œ", "ë¼ì´í”„ìœ„ë²„"] },

        // [ë°€ê¸°]
        "ì½œë¡œì„¸ì˜¤": { type: "Push", good: ["ì‹œê·¸ë§ˆ", "íŠ¸ë ˆì´ì„œ", "ì†”ì €: 76", "í‚¤ë¦¬ì½”", "ë£¨ì‹œìš°"], bad: ["ë¼ì¸í•˜ë¥´íŠ¸", "ì •í¬ë«", "íŒŒë¼", "ë©”ë¥´ì‹œ", "ë¼ì´í”„ìœ„ë²„"] },
        "ë£¨ë‚˜ì‚¬í”¼": { type: "Push", good: ["ì˜¤ë¦¬ì‚¬", "í† ë¥´ë¹„ìš˜", "ë°”ìŠ¤í‹°ì˜¨", "ì¼ë¦¬ì•„ë¦¬", "ë°”í‹°ìŠ¤íŠ¸"], bad: ["ë‘ í”¼ìŠ¤íŠ¸", "ê²ì§€", "íŠ¸ë ˆì´ì„œ", "ì  ì•¼íƒ€", "ë©”ë¥´ì‹œ"] },

        // [í”Œë˜ì‹œí¬ì¸íŠ¸]
        "ë‰´ ì •í¬ ì‹œí‹°": { type: "Flashpoint", good: ["ì •ì»¤í€¸", "íŠ¸ë ˆì´ì„œ", "ê²ì§€", "ë£¨ì‹œìš°", "í‚¤ë¦¬ì½”"], bad: ["ì‹œê·¸ë§ˆ", "ìœ„ë„ìš°ë©”ì´ì»¤", "í•œì¡°", "ì•„ë‚˜", "ì  ì•¼íƒ€"] }
    };

    // 2. ëŒ€ê¸° ì¤‘ì¸ ë§µ í’€ (ì´ˆê¸°ê°’)
    let RESERVE_POOLS = {
        "ìŸíƒˆ": ["ë„¤íŒ”", "ë¦¬ì¥ íƒ€ì›Œ", "ë‚¨ê·¹ ë°˜ë„"],
        "í˜¼í•©": ["ë¸”ë¦¬ìë“œ ì›”ë“œ", "ëˆ”ë°”ë‹ˆ", "ë¯¸ë“œíƒ€ìš´", "íŒŒë¼ì´ì†Œ"],
        "í˜¸ìœ„": ["ì„œí‚· ë¡œì–„", "ë„ë¼ë„", "66ë²ˆ êµ­ë„", "í•˜ë°”ë‚˜", "ìƒ´ë°œë¦¬ ìˆ˜ë„ì›"],
        "ë°€ê¸°": ["ì½œë¡œì„¸ì˜¤", "ë£¨ë‚˜ì‚¬í”¼"],
        "í”Œë˜ì‹œ": ["ë‰´ ì •í¬ ì‹œí‹°"]
    };

    // 3. ì‹¤í–‰ ì‹œ ê¸°ì¡´ MAP_METAì— ì‹ ê·œ ë§µ ë°ì´í„° ë³‘í•© (ì—ëŸ¬ ë°©ì§€)
    Object.assign(MAP_META, RESERVE_MAP_META);

    // 4. ë§µ ë¡œí…Œì´ì…˜ í•¨ìˆ˜ (ì‹œì¦Œ ì¢…ë£Œ ì‹œ í˜¸ì¶œ)
// â–¼â–¼â–¼ [3ë‹¨ê³„] ë§µ ë¡œí…Œì´ì…˜ ë¡œì§ (ìµœë‹¤ í”½ êµì²´) â–¼â–¼â–¼
function rotateSeasonMaps() {
    const modes = ["ìŸíƒˆ", "í˜¼í•©", "í˜¸ìœ„", "ë°€ê¸°", "í”Œë˜ì‹œ"];
    let logMsg = [];

    modes.forEach(mode => {
        let currentPool = MAP_POOLS[mode];
        let reservePool = RESERVE_POOLS[mode];

        if (currentPool.length > 0 && reservePool.length > 0) {
            // 1. í˜„ì¬ í’€ì˜ ë§µë“¤ì„ 'í”Œë ˆì´ íšŸìˆ˜' ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ë§ì´ í•œ ìˆœì„œ)
            // ì¹´ìš´íŠ¸ê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì·¨ê¸‰
            currentPool.sort((a, b) => {
                let countA = MAP_PICK_COUNTS[a] || 0;
                let countB = MAP_PICK_COUNTS[b] || 0;
                return countB - countA; // ë§ì´ í•œ ê²Œ ì•ìœ¼ë¡œ
            });

            // 2. ê°€ì¥ ë§ì´ í•œ ë§µ ì„ íƒ (ë°°ì—´ì˜ 0ë²ˆì§¸)
            let outMap = currentPool[0];
            let outCount = MAP_PICK_COUNTS[outMap] || 0;

            // 3. ëŒ€ê¸° í’€ì—ì„œ ë“¤ì–´ì˜¬ ë§µì€ ì—¬ì „íˆ ëœë¤ (ì‹ ì„ í•¨ ìœ ì§€)
            let inIdx = Math.floor(Math.random() * reservePool.length);
            let inMap = reservePool[inIdx];

            // 4. êµì²´ ì‹¤í–‰ (Swap)
            // ì •ë ¬ëœ ìƒíƒœì´ë¯€ë¡œ outMapì€ 0ë²ˆ ì¸ë±ìŠ¤ì— ìˆìŒ
            currentPool.shift();       // 0ë²ˆì§¸(ìµœë‹¤ í”½) ì œê±°
            reservePool.splice(inIdx, 1); // ëŒ€ê¸°ì—´ì—ì„œ ìƒˆ ë§µ ì œê±°
            
            currentPool.push(inMap);   // í™œì„± í’€ì— ìƒˆ ë§µ ì¶”ê°€
            reservePool.push(outMap);  // ëŒ€ê¸°ì—´ì— í—Œ ë§µ ë°˜ë‚©

            logMsg.push(`[${mode}] ${outMap}(${outCount}íšŒ) OUT â†” ${inMap} IN`);
        }
    });

    // ë‹¤ìŒ ì‹œì¦Œì„ ìœ„í•´ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
    MAP_PICK_COUNTS = {};

    alert(`[ì‹œì¦Œ ${seasonCount+1} ë§µ ë¡œí…Œì´ì…˜]\n\nê° ëª¨ë“œì—ì„œ ê°€ì¥ ë§ì´ ì“°ì¸ ë§µì´ êµì²´ë©ë‹ˆë‹¤.\n\n` + logMsg.join("\n"));
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    // --- STATE ---
    let myTeam = ""; 
    let gameMode = "NORMAL"; 
    let leagueStats = {};
    let schedule = [];
    let currentWeek = 1; 
    let currentDayStep = 0; 
    let seasonState = "REGULAR";
    let seasonCount = 1; 
// â–¼â–¼â–¼ [2ë‹¨ê³„] ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ ë³€ìˆ˜ ë° í•¨ìˆ˜ ì¶”ê°€ â–¼â–¼â–¼
    let HERO_BALANCE = {};       // ì˜ì›…ë³„ ëŠ¥ë ¥ì¹˜ ë°°ìœ¨ (ì˜ˆ: 1.0 = 100%, 0.9 = 90%)
    let SEASON_PICK_COUNTS = {}; // ì‹œì¦Œ í”½ íšŸìˆ˜ ì§‘ê³„

    // ë°ì´í„° ì´ˆê¸°í™” (ê²Œì„ ì‹œì‘ ì‹œ í˜¸ì¶œ)
    function initHeroBalanceData() {
        ["TANK", "DPS", "SUP"].forEach(role => {
            HEROES[role].forEach(h => {
                if (!HERO_BALANCE[h.n]) HERO_BALANCE[h.n] = 1.0;
                if (!SEASON_PICK_COUNTS[h.n]) SEASON_PICK_COUNTS[h.n] = 0;
            });
        });
    }

    // ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ ì‹¤í–‰ í•¨ìˆ˜ (ì‹œì¦Œ ì¢…ë£Œ ì‹œ í˜¸ì¶œ)
    function runBalancePatch() {
        let allHeroes = Object.keys(SEASON_PICK_COUNTS);
        // í”½ íšŸìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ë§ì´ í”½ëœ ìˆœì„œ)
        allHeroes.sort((a, b) => SEASON_PICK_COUNTS[b] - SEASON_PICK_COUNTS[a]);

        let total = allHeroes.length;
        let topCut = Math.floor(total * 0.3);     // ìƒìœ„ 30% (ë„ˆí”„ ëŒ€ìƒ)
        let bottomCut = Math.floor(total * 0.7);  // í•˜ìœ„ 30% (ë²„í”„ ëŒ€ìƒ)

        let logs = [];
        let nerfCount = 0; let buffCount = 0;

        allHeroes.forEach((hName, index) => {
            let oldRate = HERO_BALANCE[hName] || 1.0;
            let newRate = oldRate;
            let type = "KEEP";

            if (index < topCut) {
                // [ë„ˆí”„] ìƒìœ„ê¶Œ: 0.90 ~ 0.99 ì‚¬ì´ë¡œ ì„±ëŠ¥ ê°ì†Œ (ê¸°ì¡´ ëŒ€ë¹„)
                let factor = 0.90 + (Math.random() * 0.09); 
                newRate = oldRate * factor;
                type = "NERF";
                nerfCount++;
            } else if (index >= bottomCut) {
                // [ë²„í”„] í•˜ìœ„ê¶Œ: 1.01 ~ 1.10 ì‚¬ì´ë¡œ ì„±ëŠ¥ ì¦ê°€ (ê¸°ì¡´ ëŒ€ë¹„)
                let factor = 1.01 + (Math.random() * 0.09);
                newRate = oldRate * factor;
                type = "BUFF";
                buffCount++;
            }
            
            // ì†Œìˆ˜ì  2ìë¦¬ê¹Œì§€ë§Œ ì €ì¥
            HERO_BALANCE[hName] = parseFloat(newRate.toFixed(2));

            if (type !== "KEEP") {
                let changeIcon = type === "BUFF" ? "â–²" : "â–¼";
                let percent = Math.round(newRate * 100);
                logs.push(`${hName}: ${changeIcon} ${percent}% (Pick: ${SEASON_PICK_COUNTS[hName]})`);
            }
        });

        // í”½ ì¹´ìš´íŠ¸ ì´ˆê¸°í™” (ë‹¤ìŒ ì‹œì¦Œì„ ìœ„í•´)
        Object.keys(SEASON_PICK_COUNTS).forEach(k => SEASON_PICK_COUNTS[k] = 0);

        alert(`[ì‹œì¦Œ ${seasonCount+1} ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜]\n\nì´ ${nerfCount}ëª… ë„ˆí”„ / ${buffCount}ëª… ë²„í”„\n\n` + logs.slice(0, 15).join("\n") + "\n...");
    }
    // â–²â–²â–² [2ë‹¨ê³„] ì¶”ê°€ ë â–²â–²â–²
// â–¼â–¼â–¼â–¼â–¼ ì¶”ê°€í•  ì½”ë“œ â–¼â–¼â–¼â–¼â–¼
let FA_POOL = []; 
let pendingRecruitIdx = -1;
// â–²â–²â–²â–²â–² ì¶”ê°€ ë â–²â–²â–²â–²â–²


    // DRAFT STATE & RULES
    let draftPool = [];
    let draftOrder = []; 
    let globalPickCount = 0; 
    let isUserTurn = false;
    
    // NEW DRAFT CONSTRAINTS
    const MIN_ROLES = { TANK: 1, DPS: 2, SUP: 2 };
    const MAX_ROLES = { TANK: 2, DPS: 3, SUP: 3 };
    const MAX_TOTAL = 8;

    let currentMatch = null; 
    let setScores = [0, 0];
    let currentSet = 1;
    let currentMap = "";
    
    let bans = {my:[], opp:[]}; 
    let matchBanHistory = {my:[], opp:[]}; 
    let lastBanRole = { my: null, opp: null };
    
    let myLockedPlayers = []; 
    let oppLockedPlayers = []; 
    let myHeroPicks = [];
    let oppHeroPicks = [];
    let playedMaps = [];
    let playerSetCounts = {}; 
    let setWinner = -1; 
    let playoffMatches = {};

  window.onload = function() {
    if(localStorage.getItem("owcs_save_v18_1")) {
        document.getElementById('load-btn-start').style.display = 'block';
    } else {
            document.getElementById('start-screen').style.display = 'flex';
    }
    
    // Init Button Click Handlers
    const btnBox = document.getElementById('team-buttons');
    const PARTNER_TEAMS = ["T1", "Crazy Raccoon", "Team Falcons", "ZETA DIVISION"]; // íŒŒíŠ¸ë„ˆ íŒ€ ëª…ë‹¨

    Object.keys(TEAM_DB).forEach(t => {
        let btn = document.createElement('button');
        btn.className = 'team-btn';
        
        // [ë³€ê²½ì ] íŒŒíŠ¸ë„ˆ íŒ€ì´ë©´ ì´ë¦„ ì˜†ì— PT í‘œì‹œ ì¶”ê°€
        if (PARTNER_TEAMS.includes(t)) {
            btn.innerHTML = `${t} <span style="font-size:0.6em; color:var(--accent); border:1px solid var(--accent); border-radius:3px; padding:0 3px; vertical-align:middle;">PT</span>`;
        } else {
            btn.innerText = t;
        }

        btn.onclick = () => selectTeam(t);
        btnBox.appendChild(btn);
    });
};


// â–¼â–¼â–¼ [ìˆ˜ì •ë¨] ëª¨ë“  ë°ì´í„°(ë§µ, ë°¸ëŸ°ìŠ¤, ê¸°ë¡ì‹¤ í¬í•¨)ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ â–¼â–¼â–¼
function saveGame() {
    if(!myTeam) return;
    const saveData = {
        // 1. ê¸°ì¡´ ë°ì´í„°
        myTeam, gameMode, seasonCount, currentWeek, currentDayStep, seasonState,
        leagueStats, schedule, TEAM_DB, playoffMatches, currentMatch,
        
        // 2. [ì¶”ê°€ë¨] ë§µ ë¡œí…Œì´ì…˜ ê´€ë ¨
        MAP_POOLS, 
        RESERVE_POOLS, 
        MAP_PICK_COUNTS,

        // 3. [ì¶”ê°€ë¨] ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ ê´€ë ¨
        HERO_BALANCE, 
        SEASON_PICK_COUNTS,

        // 4. [ì¶”ê°€ë¨] ê¸°ë¡ì‹¤(ëª…ì˜ˆì˜ ì „ë‹¹) ê´€ë ¨
        PLAYER_HISTORY
    };
    localStorage.setItem("owcs_save_v18_1", JSON.stringify(saveData));
    alert("ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
// â–¼â–¼â–¼ [ìˆ˜ì •ë¨] ëª¨ë“  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ â–¼â–¼â–¼
function loadGame() {
    const dataStr = localStorage.getItem("owcs_save_v18_1");
    if(!dataStr) { alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
    
    const data = JSON.parse(dataStr);

    // 1. ê¸°ì¡´ ë°ì´í„° ë³µêµ¬
    myTeam = data.myTeam;
    gameMode = data.gameMode || "NORMAL";
    seasonCount = data.seasonCount;
    currentWeek = data.currentWeek;
    currentDayStep = data.currentDayStep;
    seasonState = data.seasonState;
    leagueStats = data.leagueStats;
    schedule = data.schedule;
    TEAM_DB = data.TEAM_DB;
    playoffMatches = data.playoffMatches;
    currentMatch = data.currentMatch;

    // 2. [ì¶”ê°€ë¨] ë§µ ë°ì´í„° ë³µêµ¬
    if(data.MAP_POOLS) MAP_POOLS = data.MAP_POOLS;
    if(data.RESERVE_POOLS) RESERVE_POOLS = data.RESERVE_POOLS;
    if(data.MAP_PICK_COUNTS) MAP_PICK_COUNTS = data.MAP_PICK_COUNTS;

    // 3. [ì¶”ê°€ë¨] ë°¸ëŸ°ìŠ¤ ë°ì´í„° ë³µêµ¬
    if(data.HERO_BALANCE) HERO_BALANCE = data.HERO_BALANCE;
    else initHeroBalanceData(); // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
    
    if(data.SEASON_PICK_COUNTS) SEASON_PICK_COUNTS = data.SEASON_PICK_COUNTS;
    else SEASON_PICK_COUNTS = {};

    // 4. [ì¶”ê°€ë¨] ê¸°ë¡ì‹¤ ë°ì´í„° ë³µêµ¬
    if(data.PLAYER_HISTORY) PLAYER_HISTORY = data.PLAYER_HISTORY;
    else PLAYER_HISTORY = {};

    // UI ê°±ì‹ 
    document.getElementById('start-screen').style.display = 'none';
    updateTrainHeroList();
    updateRoundUI();
    updateStandings();
    log(`[SYSTEM] ê²Œì„ ë¡œë“œ ì™„ë£Œ. (Season ${seasonCount} / Mode: ${gameMode})`);
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
    function resetGame() {
        if(confirm("ì €ì¥ëœ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem("owcs_save_v18_1");
            location.reload();
        }
    }

    function selectTeam(t) {
        myTeam = t;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('mode-select-screen').style.display = 'flex';
    }

    function selectMode(mode) {
        gameMode = mode;
        document.getElementById('mode-select-screen').style.display = 'none';
        
        if (mode === "NORMAL") {
            TEAM_DB = JSON.parse(JSON.stringify(ORIGINAL_TEAM_DB)); 
            Object.values(TEAM_DB).forEach(roster => {
                roster.forEach(p => { p.hp = 100; p.practiceProgress = {}; p.potm = 0; });
            });
            initLeague();
        } else {
            startDraftSetup();
        }
    }

    // --- UPDATED DRAFT LOGIC ---
    function startDraftSetup() {
        document.getElementById('draft-screen').style.display = 'flex';
        
        // 1. Flatten Pool
        draftPool = [];
        Object.values(ORIGINAL_TEAM_DB).forEach(roster => {
            roster.forEach(p => {
                let newP = {...p}; 
                newP.hp = 100; 
                newP.practiceProgress = {}; 
                newP.potm = 0;
                newP.picked = false;
                draftPool.push(newP);
            });
        });
        
        // 2. Clear Team Rosters
        Object.keys(TEAM_DB).forEach(t => { TEAM_DB[t] = []; });
        
        // 3. Set Random Order for AI, Fixed for User
        let otherTeams = Object.keys(TEAM_DB).filter(t => t !== myTeam);
        otherTeams.sort(() => Math.random() - 0.5);
        draftOrder = [myTeam, ...otherTeams];
        
        globalPickCount = 0;
        
        // Clear History UI
        document.getElementById('draft-history-list').innerHTML = "";

        renderDraftPool('ALL');
        updateDraftUI();
        log("ë“œë˜í”„íŠ¸ ì‹œì‘! (ì¡°ê±´: íƒ±1/ë”œ2/í2 í•„ìˆ˜, ìµœëŒ€ 8ëª…, í’€ ì†Œì§„ ì‹œ ì¢…ë£Œ)");
        
        processDraftTurn();
    }

    function checkRosterConstraints(teamName, roleToCheck) {
        const roster = TEAM_DB[teamName];
        let counts = { TANK: 0, DPS: 0, SUP: 0 };
        roster.forEach(p => counts[p.r]++);
        
        if (counts[roleToCheck] >= MAX_ROLES[roleToCheck]) return { valid: false, reason: "ROLE_FULL" };
        if (roster.length >= MAX_TOTAL) return { valid: false, reason: "ROSTER_FULL" };
        
        return { valid: true };
    }
    
    function checkGlobalRoleSafety(roleToCheck, pickerTeamName) {
        let poolCount = draftPool.filter(p => !p.picked && p.r === roleToCheck).length;
        let othersNeed = 0;
        Object.keys(TEAM_DB).forEach(tName => {
            if (tName === pickerTeamName) return; 
            let r = TEAM_DB[tName];
            let currentCount = r.filter(p => p.r === roleToCheck).length;
            let minReq = MIN_ROLES[roleToCheck];
            othersNeed += Math.max(0, minReq - currentCount);
        });
        if (poolCount - 1 < othersNeed) {
            return false; 
        }
        return true;
    }

    function processDraftTurn() {
        let unpickedCount = draftPool.filter(p => !p.picked).length;
        if (unpickedCount === 0) { finishDraft(); return; }
        
        // Check if everyone is full or cannot pick
        let allFull = Object.keys(TEAM_DB).every(t => TEAM_DB[t].length >= MAX_TOTAL);
        if (allFull) { finishDraft(); return; }

        let round = Math.floor(globalPickCount / 9) + 1;
        let slotIndex = globalPickCount % 9;
        let currentPickerIndex = (round % 2 !== 0) ? slotIndex : (8 - slotIndex);
        let pickingTeam = draftOrder[currentPickerIndex];
        let teamRoster = TEAM_DB[pickingTeam];
        
        // 1. Check Full Roster
        if (teamRoster.length >= MAX_TOTAL) {
            globalPickCount++;
            processDraftTurn(); 
            return;
        }

        // 2. CHECK IF TEAM *CAN* PICK ANYTHING (Auto-Skip Logic)
        let counts = { TANK: 0, DPS: 0, SUP: 0 };
        teamRoster.forEach(p => counts[p.r]++);

        // Is there space in roster for this role?
        let canPickTank = counts.TANK < MAX_ROLES.TANK;
        let canPickDps = counts.DPS < MAX_ROLES.DPS;
        let canPickSup = counts.SUP < MAX_ROLES.SUP;

        // Is there a player in pool for this role?
        let poolHasTank = draftPool.some(p => !p.picked && p.r === 'TANK');
        let poolHasDps = draftPool.some(p => !p.picked && p.r === 'DPS');
        let poolHasSup = draftPool.some(p => !p.picked && p.r === 'SUP');

        // Can we make a move? (Must be able to pick AND exist in pool)
        let hasValidMove = (canPickTank && poolHasTank) ||
                           (canPickDps && poolHasDps) ||
                           (canPickSup && poolHasSup);

        if (!hasValidMove) {
            log(`[Draft] ${pickingTeam} íŒ€ì€ í˜„ì¬ í”½ ê°€ëŠ¥í•œ ì—­í• êµ° ì„ ìˆ˜ê°€ ì—†ì–´ ìˆœì„œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.`);
            globalPickCount++;
            processDraftTurn(); // Recursive Skip
            return;
        }

        const indicator = document.getElementById('turn-indicator');
        indicator.innerText = `${pickingTeam} íŒ€ í”½ ì§„í–‰ ì¤‘... (R${round})`;
        if(pickingTeam === myTeam) indicator.classList.add('turn-active');
        else indicator.classList.remove('turn-active');

        document.getElementById('draft-status').innerText = `Round ${round} (Pick ${globalPickCount+1})`;

        if (pickingTeam === myTeam) {
            isUserTurn = true;
            renderDraftPool(document.querySelector('.pool-filter-btn.active').innerText); 
        } else {
            isUserTurn = false;
            renderDraftPool(document.querySelector('.pool-filter-btn.active').innerText);
            setTimeout(() => {
                aiPickLogic(pickingTeam);
                globalPickCount++;
                processDraftTurn();
            }, 100);
        }
    }

    function renderDraftPool(filterRole) {
        const list = document.getElementById('draft-pool-list');
        list.innerHTML = "";
        
        document.querySelectorAll('.pool-filter-btn').forEach(b => {
            if(b.innerText === filterRole) b.classList.add('active');
            else b.classList.remove('active');
        });

        draftPool.sort((a,b) => a.n.localeCompare(b.n));

        let myCounts = { TANK: 0, DPS: 0, SUP: 0 };
        TEAM_DB[myTeam].forEach(p => myCounts[p.r]++);

        draftPool.forEach((p, idx) => {
            if (filterRole !== 'ALL' && p.r !== filterRole) return;
            
            let roleClass = p.r === 'TANK' ? 'rb-tank' : (p.r === 'DPS' ? 'rb-dps' : 'rb-sup');
            let isPicked = p.picked ? 'picked' : '';
            
            let disabledClass = '';
            let blockReason = '';

            if (!isPicked) {
                if (!isUserTurn) {
                    disabledClass = 'disabled';
                } else {
                    if (myCounts[p.r] >= MAX_ROLES[p.r]) {
                        disabledClass = 'disabled';
                        blockReason = '(ìµœëŒ€ì¸ì›)';
                    }
                    else if (TEAM_DB[myTeam].length >= MAX_TOTAL) {
                        disabledClass = 'disabled';
                        blockReason = '(íŒ€ë§Œì›)';
                    }
                    else if (!checkGlobalRoleSafety(p.r, myTeam)) {
                        disabledClass = 'disabled';
                        blockReason = '(íƒ€íŒ€ë³´í˜¸)';
                    }
                }
            }

            let card = document.createElement('div');
            card.className = `draft-card ${isPicked} ${disabledClass}`;
            card.innerHTML = `
                <div class="role-badge ${roleClass}">${p.r}</div>
                <div style="font-weight:bold; color:white;">${p.n}</div>
                <div style="font-size:0.8em; color:#aaa;">MS: ${p.ms.join(", ")} | Stats: ??? <span style="color:var(--ban-red);">${blockReason}</span></div>
                <button style="background:var(--accent); border:none; border-radius:3px; cursor:pointer; font-weight:bold;" onclick="handleUserPick(${idx})">PICK</button>
            `;
            list.appendChild(card);
        });
        updateDraftUI();
    }

    function addToDraftHistory(teamName, player) {
        const list = document.getElementById('draft-history-list');
        const item = document.createElement('div');
        let myPickClass = (teamName === myTeam) ? 'my-pick' : '';
        let roleColor = player.r === 'TANK' ? '#3498db' : (player.r === 'DPS' ? '#e74c3c' : '#2ecc71');
        
        item.className = `hist-item ${myPickClass}`;
        item.innerHTML = `
            <div style="display:flex; align-items:center;">
                <div class="hist-team">${teamName}</div>
                <span style="color:${roleColor}; font-size:0.8em; margin-right:5px; border:1px solid ${roleColor}; padding:0 3px; border-radius:3px;">${player.r}</span>
                <div class="hist-player">${player.n}</div>
            </div>
        `;
        list.prepend(item); 
    }

    function handleUserPick(poolIdx) {
        if (!isUserTurn) return;
        let p = draftPool[poolIdx];
        if (p.picked) return;
        
        let constraint = checkRosterConstraints(myTeam, p.r);
        if (!constraint.valid) { alert("í•´ë‹¹ ì„ ìˆ˜ë¥¼ í”½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì œí•œ ì´ˆê³¼)"); return; }
        if (!checkGlobalRoleSafety(p.r, myTeam)) { alert("ë‹¤ë¥¸ íŒ€ì˜ ìµœì†Œ ì¸ì›ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì´ ì—­í• êµ°ì„ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }

        p.picked = true;
        TEAM_DB[myTeam].push(p);
        addToDraftHistory(myTeam, p); 
        
        isUserTurn = false;
        globalPickCount++;
        processDraftTurn();
    }

    // --- AI PICK LOGIC (UPDATED: Diversity & Smart & Safety) ---
    function getAiCandidate(role, roster, teamName) {
        // Safety Check First
        if (!checkGlobalRoleSafety(role, teamName)) return null;

        let existingMS = new Set();
        roster.forEach(p => {
            p.ms.forEach(h => existingMS.add(h));
        });

        let candidates = draftPool.filter(p => !p.picked && p.r === role);
        if(candidates.length === 0) return null;

        candidates.forEach(p => {
            let statTotal = p.a + p.s + p.m + p.t;
            let noise = Math.random() * 20; 
            
            let overlapCount = 0;
            p.ms.forEach(h => {
                if(existingMS.has(h)) overlapCount++;
            });
            let overlapPenalty = overlapCount * 50; 

            p.aiScore = statTotal + noise - overlapPenalty;
        });

        candidates.sort((a,b) => b.aiScore - a.aiScore);
        
        return candidates[0]; 
    }

    function aiPickLogic(tName) {
        const roster = TEAM_DB[tName];
        let counts = { TANK: 0, DPS: 0, SUP: 0 };
        roster.forEach(p => counts[p.r]++);
        
        let needsMin = [];
        if (counts.TANK < MIN_ROLES.TANK) needsMin.push("TANK");
        if (counts.DPS < MIN_ROLES.DPS) needsMin.push("DPS");
        if (counts.SUP < MIN_ROLES.SUP) needsMin.push("SUP");

        let allowedMax = [];
        if (counts.TANK < MAX_ROLES.TANK) allowedMax.push("TANK");
        if (counts.DPS < MAX_ROLES.DPS) allowedMax.push("DPS");
        if (counts.SUP < MAX_ROLES.SUP) allowedMax.push("SUP");

        let bestP = null;

        // Priority 1: Fill Minimum Needs
        if (needsMin.length > 0) {
            needsMin.sort(() => Math.random() - 0.5);
            for (let r of needsMin) {
                let candidate = getAiCandidate(r, roster, tName);
                if (candidate) { bestP = candidate; break; }
            }
        }
        
        // Priority 2: Fill if allowed (Smart Fill)
        if (!bestP && allowedMax.length > 0) {
            allowedMax.sort(() => Math.random() - 0.5);
            for (let r of allowedMax) {
                let candidate = getAiCandidate(r, roster, tName);
                if (candidate) { bestP = candidate; break; }
            }
        }
        
        // Fallback with Limit Check
        if (!bestP) {
             for (let p of draftPool) { 
                 // Ensure this random pick doesn't violate max constraints
                 if (!p.picked && counts[p.r] < MAX_ROLES[p.r] && checkGlobalRoleSafety(p.r, tName)) { 
                    bestP = p; break; 
                 } 
             }
        }

        if (bestP) {
            bestP.picked = true;
            roster.push(bestP);
            addToDraftHistory(tName, bestP); 
        }
    }

    function updateDraftUI() {
        const myDiv = document.getElementById('my-draft-roster');
        const reqDiv = document.getElementById('roster-req-status');
        
        let counts = { TANK: 0, DPS: 0, SUP: 0 };
        TEAM_DB[myTeam].forEach(p => counts[p.r]++);
        
        let tColor = counts.TANK >= MIN_ROLES.TANK ? 'var(--good-green)' : 'var(--ban-red)';
        let dColor = counts.DPS >= MIN_ROLES.DPS ? 'var(--good-green)' : 'var(--ban-red)';
        let sColor = counts.SUP >= MIN_ROLES.SUP ? 'var(--good-green)' : 'var(--ban-red)';
        
        reqDiv.innerHTML = `
            T: <span style="color:${tColor}">${counts.TANK}/${MAX_ROLES.TANK}</span> (Min ${MIN_ROLES.TANK}) | 
            D: <span style="color:${dColor}">${counts.DPS}/${MAX_ROLES.DPS}</span> (Min ${MIN_ROLES.DPS}) | 
            S: <span style="color:${sColor}">${counts.SUP}/${MAX_ROLES.SUP}</span> (Min ${MIN_ROLES.SUP}) | 
            Total: ${TEAM_DB[myTeam].length}/${MAX_TOTAL}
        `;

        myDiv.innerHTML = "";
        TEAM_DB[myTeam].forEach(p => {
            let roleClass = p.r === 'TANK' ? 'rb-tank' : (p.r === 'DPS' ? 'rb-dps' : 'rb-sup');
            let statTotal = p.a + p.s + p.m + p.t;
            myDiv.innerHTML += `<div style="background:#333; margin:5px 0; padding:5px; display:flex; justify-content:space-between; align-items:center;">
                <span class="role-badge ${roleClass}" style="margin-right:5px;">${p.r}</span>
                <span>${p.n}</span>
                <span style="color:var(--accent); font-weight:bold;">${statTotal}</span>
            </div>`;
        });
    }

    function finishDraft() {
        let counts = { TANK: 0, DPS: 0, SUP: 0 };
        TEAM_DB[myTeam].forEach(p => counts[p.r]++);
        
        if (counts.TANK < MIN_ROLES.TANK || counts.DPS < MIN_ROLES.DPS || counts.SUP < MIN_ROLES.SUP) {
            alert("ì£¼ì˜: íŒ€ ìµœì†Œ ì¸ì›ì„ ì±„ìš°ì§€ ëª»í•œ ìƒíƒœë¡œ ë“œë˜í”„íŠ¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        document.getElementById('draft-screen').style.display = 'none';
        initLeague();
    }

    // --- LEAGUE LOGIC ---
  function initLeague() {
    Object.keys(TEAM_DB).forEach(t => leagueStats[t] = {w:0, l:0, d:0, name:t});
    schedule = [];
    generateSchedule();
    
    // FA í’€ì´ ì—†ìœ¼ë©´ ìƒì„± (ê²Œì„ ì‹œì‘ ì‹œ 1íšŒ)
    if(FA_POOL.length === 0) initFAPool();

// â–¼â–¼â–¼ [ì¶”ê°€ë¨] ë°¸ëŸ°ìŠ¤ ë°ì´í„° ì´ˆê¸°í™” â–¼â–¼â–¼
        initHeroBalanceData(); 
        // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
    
    // [ë³€ê²½ì ] ì‹œì¦Œ 1ì´ë©´ ìŠ¤ì¹´ìš°íŠ¸ ì—†ì´ ë°”ë¡œ ì •ê·œ ì‹œì¦Œ ì‹œì‘
    if (seasonCount === 1) {
        seasonState = "REGULAR";
        currentWeek = 1;
        currentDayStep = 0;
        updateRoundUI();
        log(`== SEASON ${seasonCount} START (ì²« ì‹œì¦Œì€ ìŠ¤ì¹´ìš°íŠ¸ ì—†ì´ ì§„í–‰ë©ë‹ˆë‹¤) ==`);
    } else {
        // ì‹œì¦Œ 2ë¶€í„°ëŠ” í”„ë¦¬ì‹œì¦Œ(ìŠ¤ì¹´ìš°íŠ¸) ì§„í–‰
        seasonState = "PRE_SEASON"; 
        currentWeek = 1;
        currentDayStep = 0;
        updateRoundUI();
        log(`== SEASON ${seasonCount} PRE-SEASON OPEN ==`);
        log(`ìƒˆ ì‹œì¦Œì„ ì•ë‘ê³  ìŠ¤ì¹´ìš°íŠ¸ ì‹œì¥ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.`);
    }

    updateTrainHeroList();
    updateStandings();
}


    function updateTrainHeroList() {
        const pSel = document.getElementById('train-p-select');
        const roster = TEAM_DB[myTeam];
        let currentVal = pSel.value;
        pSel.innerHTML = "";
        if (roster.length === 0) return; 
        roster.forEach(p => {
             let op = document.createElement('option');
             op.value = p.n; op.innerText = p.n;
             pSel.appendChild(op);
        });
        if (currentVal && roster.find(p=>p.n===currentVal)) pSel.value = currentVal;
        updateTrainHeroList2(); 
    }

    function updateTrainHeroList2() {
        const pName = document.getElementById('train-p-select').value;
        if(!pName) return;
        const roster = TEAM_DB[myTeam];
        const player = roster.find(p => p.n === pName);
        if (!player) return;
        const role = player.r; 
        const hSel = document.getElementById('train-h-select');
        hSel.innerHTML = "";
        HEROES[role].forEach(h => {
            let op = document.createElement('option');
            op.value = h.n;
            op.innerText = h.n;
            hSel.appendChild(op);
        });
    }

    // --- CORE GAME LOOP UTILS ---
    function getCurrentOpponentName() {
        if (seasonState === "REGULAR") {
            if(!currentMatch) return null;
            return (currentMatch.h === myTeam) ? currentMatch.a : currentMatch.h;
        } else if (seasonState === "POST_SEMI") {
            if (!playoffMatches.semiA) return null;
            if (playoffMatches.semiA.h === myTeam) return playoffMatches.semiA.a;
            if (playoffMatches.semiA.a === myTeam) return playoffMatches.semiA.h;
            if (playoffMatches.semiB.h === myTeam) return playoffMatches.semiB.a;
            return playoffMatches.semiB.h;
        } else if (seasonState === "POST_FINAL") {
            if (!playoffMatches.final) return null;
            return (playoffMatches.final.h === myTeam) ? playoffMatches.final.a : playoffMatches.final.h;
        }
        return null;
    }

    function toggleModal(id) {
        if(!myTeam) return;
        const m = document.getElementById(id);
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
    }
    
    // --- TOGGLE ALL TEAMS ---
    function toggleAllTeams() {
        if(!myTeam) return;
        toggleModal('all-teams-modal');
        const content = document.getElementById('all-teams-content');
        content.innerHTML = "";
        
        Object.keys(TEAM_DB).forEach(tName => {
            if(tName === myTeam) return; 
            
            let html = `<div style="background:#222; padding:10px; border-radius:5px; border:1px solid #444;">`;
            html += `<h3 style="color:var(--ow-orange); margin:0 0 10px 0; border-bottom:1px solid #555; padding-bottom:5px;">${tName}</h3>`;
            html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">`;
            
            TEAM_DB[tName].forEach(p => {
                let roleColor = p.r === 'TANK' ? '#3498db' : (p.r === 'DPS' ? '#e74c3c' : '#2ecc71');
                html += `<div style="display:flex; justify-content:space-between; font-size:0.9em; background:#111; padding:4px; border-radius:3px;">
                            <span style="color:#ddd;">${p.n}</span>
                            <span style="color:${roleColor}; font-weight:bold; font-size:0.85em;">${p.r}</span>
                         </div>`;
            });
            
            html += `</div></div>`;
            content.innerHTML += html;
        });
    }

    function toggleRoster() {
        if(!myTeam) return;
        toggleModal('roster-modal');
        const content = document.getElementById('roster-content');
        const players = TEAM_DB[myTeam];
        let html = "";
        players.forEach(p => {
            let msStr = p.ms.join(", ");
            let hpColor = p.hp > 80 ? '#2ecc71' : (p.hp > 50 ? '#f1c40f' : '#e74c3c');
            html += `<div class="player-card">
                    <div style="font-weight:bold; color:var(--ow-orange); font-size:1.2em;">${p.n}</div>
                    <div class="stat-bars">
                        <div>AIM: <span class="stat-val">${p.a}</span></div>
                        <div>SEN: <span class="stat-val">${p.s}</span></div>
                        <div>MEN: <span class="stat-val">${p.m}</span></div>
                        <div>TEAM: <span class="stat-val">${p.t}</span></div>
                        <div>HP: <span class="hp-val" style="color:${hpColor}">${p.hp}%</span></div>
                    </div>
                    <div style="text-align:right; font-size:0.85em; color:#ccc;">
                        <div>${p.r}</div>
                        <div style="color:var(--accent);">â˜… ${msStr}</div>
                    </div>
                </div>`;
        });
        content.innerHTML = html;
    }
    function togglePOTM() {
        if(!myTeam) return;
        toggleModal('potm-modal');
        const content = document.getElementById('potm-content');
        let allPlayers = [];
        Object.keys(TEAM_DB).forEach(tName => {
            TEAM_DB[tName].forEach(p => allPlayers.push({ ...p, team: tName }));
        });
        allPlayers.sort((a,b) => b.potm - a.potm || b.a - a.a);
        let html = "";
        allPlayers.forEach((p, i) => {
            if(p.potm > 0 || i < 10) { 
                let rankClass = (i===0) ? 'potm-rank-1' : '';
                html += `<div class="potm-row"><div class="${rankClass}">${i+1}</div><div class="${rankClass}">${p.n}</div><div style="font-size:0.8em; color:#888;">${p.team}</div><div><span class="potm-count">${p.potm}</span></div></div>`;
            }
        });
        content.innerHTML = html;
    }

    function generateSchedule() {
        let teams = Object.keys(TEAM_DB);
        let n = teams.length; 
        for(let r=0; r<n; r++) schedule.push(makeRoundPairing(teams, r));
    }
    function makeRoundPairing(teams, roundNum) {
        let shifted = [...teams];
        for(let k=0; k<roundNum; k++) shifted.unshift(shifted.pop());
        let matches = [];
        for(let i=1; i<5; i++) matches.push({h: shifted[i], a: shifted[9-i]});
        return matches;
    }

function updateRoundUI() {
    // 1. í”„ë¦¬ì‹œì¦Œ(ìŠ¤ì¹´ìš°íŠ¸) í™”ë©´ ì²˜ë¦¬
    if (seasonState === "PRE_SEASON") {
        document.getElementById('round-display').innerText = `SEASON ${seasonCount} - PRE SEASON`;
        document.getElementById('match-subtitle').innerText = "ROSTER UPDATE";
        document.getElementById('match-title').innerText = "SCOUTING MARKET";
        
        renderFAList('ALL');
        renderMyScoutRoster();
        switchPhase('ui-scout');
        return;
    }

   if (seasonState === "ROLE_STAR") {
        document.getElementById('round-display').innerText = "SEASON AWARDS";
        document.getElementById('match-title').innerText = "ROLE STAR SELECTION";
        
        calculateAndShowRoleStars(); // ê³„ì‚° ë° ë Œë”ë§
        switchPhase('ui-rolestar');  // í™”ë©´ ì „í™˜
        return;
    }

    // 2. í¬ìŠ¤íŠ¸ ì‹œì¦Œ í™”ë©´ ì²˜ë¦¬
    if (seasonState !== "REGULAR") { 
        handlePostSeasonUI(); 
        return; 
    }

    // 3. ì •ê·œ ì‹œì¦Œ - í›ˆë ¨(Training) í™”ë©´ ì²˜ë¦¬
    if (currentDayStep === 0) {
        document.getElementById('round-display').innerText = `SEASON ${seasonCount} / WEEK ${currentWeek} - TRAINING`;
        document.getElementById('match-subtitle').innerText = "í›ˆë ¨ ë° ì •ë¹„ ì‹œê°„";
        document.getElementById('match-title').innerText = "TEAM MANAGEMENT";
        document.getElementById('train-desc-txt').innerText = "ì´ë²ˆ ì£¼ ê²½ê¸°ë¥¼ ìœ„í•´ í›ˆë ¨ ì¼ì •ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤.";
        
        switchPhase('ui-training');
        return;
    }

    // [í•µì‹¬ ìˆ˜ì •] ë¡œë¹„ ì§„ì… ì‹œ ì ìˆ˜íŒê³¼ ê´€ë ¨ ë³€ìˆ˜ë¥¼ ë¯¸ë¦¬ 0ìœ¼ë¡œ ì´ˆê¸°í™”
    setScores = [0, 0];
    updateScoreBoard();

    // 4. ì •ê·œ ì‹œì¦Œ - ê²½ê¸°(Match) í™”ë©´ ì²˜ë¦¬
    const daysText = ["", "Friday", "Saturday", "Sunday"];
    const dayTxt = daysText[currentDayStep];
    const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
    
    document.getElementById('round-display').innerText = `SEASON ${seasonCount} / WEEK ${currentWeek} - ${dayTxt}`;
    document.getElementById('match-subtitle').innerText = `Round ${roundIdx + 1} / 9`;
    
    const myM = schedule[roundIdx] ? schedule[roundIdx].find(m => m.h === myTeam || m.a === myTeam) : null;
    
    if (myM) {
        currentMatch = myM;
        const opp = (myM.h === myTeam) ? myM.a : myM.h;
        document.getElementById('match-title').innerText = `VS ${opp}`;
        document.getElementById('next-match-info').innerText = "ë§¤ì¹˜ ì¤€ë¹„ ì™„ë£Œ";
        document.getElementById('lobby-desc').innerText = "Bo5 ì •ê·œ ë¦¬ê·¸ ê²½ê¸°ì…ë‹ˆë‹¤.";
        document.getElementById('btn-start-match').innerText = "ê²½ê¸° ì‹œì‘";
        document.getElementById('btn-start-match').onclick = startMatchSequence;
        document.getElementById('btn-start-match').disabled = false;
    } else {
        currentMatch = null;
        document.getElementById('match-title').innerText = "BYE DAY (íœ´ì‹)";
        document.getElementById('next-match-info').innerText = "ê²½ê¸° ì¼ì • ì—†ìŒ";
        document.getElementById('lobby-desc').innerText = "ì˜¤ëŠ˜ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ìë™ ì§„í–‰ë©ë‹ˆë‹¤ (ì²´ë ¥ ì†Œí­ íšŒë³µ).";
        document.getElementById('btn-start-match').innerText = "íœ´ì‹ ì§„í–‰";
        document.getElementById('btn-start-match').onclick = simByeRound; 
        document.getElementById('btn-start-match').disabled = false;
    }
    switchPhase('ui-lobby');
}

   function updateStandings() {
    const tbody = document.getElementById('standings-body');
    if(!tbody || Object.keys(leagueStats).length === 0) return;
    tbody.innerHTML = "";
    
    const PARTNER_TEAMS = ["T1", "Crazy Raccoon", "Team Falcons", "ZETA DIVISION"];
    const sorted = Object.values(leagueStats).sort((a,b) => b.w - a.w || b.d - a.d);
    
    let html = "";
    sorted.forEach((s, i) => {
        // [ë³€ê²½ì ] íŒŒíŠ¸ë„ˆ íŒ€ í‘œì‹œ ë¡œì§
        let dispName = s.name;
        if (PARTNER_TEAMS.includes(s.name)) {
            dispName += ` <span style="font-size:0.7em; color:#aaa;">PT</span>`;
        }

        html += `<tr class="${s.name === myTeam ? 'my-team-row' : ''}">
            <td>${i+1}</td>
            <td style="text-align:left; padding-left:10px;">${dispName}</td>
            <td>${s.w}</td>
            <td>${s.l}</td>
            <td>${s.d}</td>
        </tr>`;
    });
    tbody.innerHTML = html;
}

    function handlePostSeasonUI() {
        if (seasonState === "POST_BUFFER") {
            document.getElementById('round-display').innerText = "POST SEASON PREP";
            document.getElementById('match-subtitle').innerText = "ì‹œë“œ ê²°ì •ì „ ì „ë‚ ";
            document.getElementById('match-title').innerText = "EXTRA TRAINING";
            switchPhase('ui-training');
        } else if (seasonState === "POST_SEED") {
            setupPlayoffs();
        } else if (seasonState === "POST_SEMI") {
            document.getElementById('round-display').innerText = "PLAYOFFS - SATURDAY";
            document.getElementById('match-subtitle').innerText = "SEMIFINALS";
            if (playoffMatches.semiA.h === myTeam || playoffMatches.semiA.a === myTeam || 
                playoffMatches.semiB.h === myTeam || playoffMatches.semiB.a === myTeam) {
                let opp = (playoffMatches.semiA.h === myTeam) ? playoffMatches.semiA.a : 
                          (playoffMatches.semiA.a === myTeam) ? playoffMatches.semiA.h : 
                          (playoffMatches.semiB.h === myTeam) ? playoffMatches.semiB.a : playoffMatches.semiB.h;
                document.getElementById('match-title').innerText = `VS ${opp}`;
                document.getElementById('btn-start-match').innerText = "4ê°•ì „ ì‹œì‘";
                document.getElementById('btn-start-match').onclick = startMatchSequence;
            } else {
                document.getElementById('match-title').innerText = "ELIMINATED";
                document.getElementById('lobby-desc').innerText = "4ê°• ì§„ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                document.getElementById('btn-start-match').onclick = prepareNextSeason; 
            }
            switchPhase('ui-lobby');
        } else if (seasonState === "POST_FINAL") {
            document.getElementById('round-display').innerText = "PLAYOFFS - SUNDAY";
            document.getElementById('match-subtitle').innerText = "GRAND FINALS";
            if (playoffMatches.final.h === myTeam || playoffMatches.final.a === myTeam) {
                 let opp = (playoffMatches.final.h === myTeam) ? playoffMatches.final.a : playoffMatches.final.h;
                 document.getElementById('match-title').innerText = `FINAL VS ${opp}`;
                 document.getElementById('lobby-desc').innerText = "ê²°ìŠ¹ì „ (Bo7)"; 
                 document.getElementById('btn-start-match').innerText = "ê²°ìŠ¹ì „ ì‹œì‘";
                 document.getElementById('btn-start-match').onclick = startMatchSequence;
            } else {
                 document.getElementById('match-title').innerText = "SEASON FINALE";
                 document.getElementById('lobby-desc').innerText = "ì´ë²ˆ ì‹œì¦Œì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                 document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                 document.getElementById('btn-start-match').onclick = prepareNextSeason;
            }
            switchPhase('ui-lobby');
        }
    }

function prepareNextSeason() {
        if(confirm("ì´ë²ˆ ì‹œì¦Œì„ ì¢…ë£Œí•˜ê³  ë‹¤ìŒ ì‹œì¦Œì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            // [ì¶”ê°€ë¨] ë§µ ë¡œí…Œì´ì…˜ ì‹¤í–‰
            rotateSeasonMaps(); 
            
// â–¼â–¼â–¼ [ì¶”ê°€ë¨] ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ ì‹¤í–‰ â–¼â–¼â–¼
            runBalancePatch(); 
            // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

            seasonCount++;
            currentWeek = 1;
            currentDayStep = 0;
            seasonState = "REGULAR";
            initLeague();
            saveGame(); // ë°ì´í„° ì €ì¥
        }
    }

    // --- AI AUTOMATION ---
// --- AI AUTOMATION ---
function simulateAIWeeklyRoutine() {
    log(`<div class="log-system">AI íŒ€ë“¤ì´ ì´ë²ˆ ì£¼ í›ˆë ¨/íœ´ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤...</div>`);
    Object.keys(TEAM_DB).forEach(tName => {
        if(tName === myTeam) return; 
        const roster = TEAM_DB[tName];
        let totalHp = roster.reduce((acc, p) => acc + p.hp, 0);
        let avgHp = totalHp / roster.length;

        if (avgHp < 70) {
            // [íœ´ì‹] ì²´ë ¥ +30 íšŒë³µ (ìµœëŒ€ 100 ì œí•œ)
            roster.forEach(p => p.hp = Math.min(100, p.hp + 30));
        } else {
            // [í›ˆë ¨] ìŠ¤íƒ¯ ìƒìŠ¹
            // â˜…ìˆ˜ì •ë¨: í›ˆë ¨ ì‹œ ì²´ë ¥ +10 íšŒë³µ (ìœ ì €ì™€ ë™ì¼, ìµœëŒ€ 100 ì œí•œ)
            roster.forEach(p => p.hp = Math.min(100, p.hp + 10));
            
            let roll = Math.random();
            if (roll < 0.25) roster.forEach(p => { if(p.a < 99) p.a++; });
            else if (roll < 0.50) roster.forEach(p => { if(p.s < 99) p.s++; });
            else if (roll < 0.75) roster.forEach(p => { if(p.t < 99) p.t++; });
            else {
                let p = roster[Math.floor(Math.random()*roster.length)];
                if (p) {
                     let pool = HEROES[p.r];
                     let h = pool[Math.floor(Math.random()*pool.length)].n;
                     if(!p.ms.includes(h)) if(Math.random() < 0.3) p.ms.push(h);
                }
            }
        }
    });
}
    function runTraining(type) {
        const roster = TEAM_DB[myTeam];
        const chance = () => Math.random() < 0.1;

        if(type === 'REST') { 
            roster.forEach(p => p.hp = Math.min(100, p.hp + 30));
            log("ì „ì› íœ´ì‹ ì™„ë£Œ. ì²´ë ¥ +30"); 
        } 
        else if(type === 'HERO') {
            const pName = document.getElementById('train-p-select').value;
            const hName = document.getElementById('train-h-select').value;
            const player = roster.find(p=>p.n === pName);
            if(!player.practiceProgress[hName]) player.practiceProgress[hName] = 0;
            player.practiceProgress[hName]++;
            let count = player.practiceProgress[hName];
            let req = (player.trait === "ë‹¤ì¬ë‹¤ëŠ¥") ? 2 : 3;

            if(count >= req) {
                if(!player.ms.includes(hName)) { player.ms.push(hName); log(`[ê²½ì¶•] ${pName} ì„ ìˆ˜ ${hName} ëª¨ìŠ¤íŠ¸ ë“±ë¡!`); }
                else log(`${pName} ì„ ìˆ˜ëŠ” ì´ë¯¸ ${hName} ì¥ì¸ì…ë‹ˆë‹¤.`);
            } else log(`${pName}: ${hName} ì—°ìŠµ ì™„ë£Œ (${count}/${req})`);
            
            roster.forEach(p => p.hp = Math.min(100, p.hp + 10));
        } else {
            let statMap = {'AIM':'a', 'SENSE':'s', 'MENTAL':'m', 'TEAM':'t'};
            let traitMap = {'AIM':'ìœ ë§ì£¼', 'SENSE':'ë² í…Œë‘', 'MENTAL':'ì†Œë…„ê°€ì¥', 'TEAM':'ë¶„ìœ„ê¸°ë©”ì´ì»¤'};
            let key = statMap[type];
            let targetTrait = traitMap[type];
            let bonusMsg = "";

            roster.forEach(p => {
                let gain = 1;
                if(p.trait === targetTrait && chance()) { gain = 2; bonusMsg = ` (${p.n} íŠ¹ì„± ë°œë™!)`; }
                if(p[key] < 99) p[key] = Math.min(99, p[key] + gain);
                p.hp = Math.min(100, p.hp + 10);
            });
            log(`[í›ˆë ¨] íŒ€ ì „ì²´ ${type} í›ˆë ¨ ì™„ë£Œ.${bonusMsg} ì²´ë ¥ +10`);
        }
        simulateAIWeeklyRoutine();
        if (seasonState === "REGULAR") currentDayStep = 1; 
        else if (seasonState === "POST_BUFFER") seasonState = "POST_SEED"; 
        else if (seasonState === "POST_SEED_TRAIN") { runSeedMatchesSimOnly(); seasonState = "POST_SEMI"; }
        updateRoundUI();
    }

    function simByeRound() {
        const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
        schedule[roundIdx].forEach(m => {
            if (m.h !== myTeam && m.a !== myTeam) {
                let s1 = Math.floor(Math.random()*4);
                let s2 = s1===3 ? Math.floor(Math.random()*3) : 3;
                let winner = s1 > s2 ? m.h : m.a;
                calcMatchPOTM(winner);
                recordStats(m.h, m.a, s1, s2);
                [m.h, m.a].forEach(tName => {
                    let r = TEAM_DB[tName];
                    let shuffled = [...r].sort(() => 0.5 - Math.random());
                    let played = shuffled.slice(0, 5);
                    played.forEach(p => p.hp = Math.max(0, p.hp - 15));
                });
            }
        });
        const roster = TEAM_DB[myTeam];
        roster.forEach(p => p.hp = Math.min(100, p.hp + 6));
        log(`[íœ´ì‹ì¼] ìë™ ì§„í–‰ ì™„ë£Œ. ì²´ë ¥ +6 íšŒë³µ.`);
        advanceDay();
    }

   function advanceDay() {
        if (seasonState === "REGULAR") {
            currentDayStep++;
            if (currentDayStep > 3) {
                currentWeek++;
                currentDayStep = 0; 
                if (currentWeek > 3) {
                    // â–¼â–¼â–¼ [ìˆ˜ì •ë¨] ë°”ë¡œ POST_BUFFERë¡œ ê°€ì§€ ì•Šê³  ë¡¤ìŠ¤íƒ€ ì„ ì • ë‹¨ê³„ë¡œ ì´ë™ â–¼â–¼â–¼
                    seasonState = "ROLE_STAR";
                    currentDayStep = 0; 
                    log("===== ì •ê·œ ì‹œì¦Œ ì¢…ë£Œ! ROLE STAR ì„ ì • ì¤‘... =====");
                    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
                }
            }
        }
        updateRoundUI();
        updateStandings();
    }

// â–¼â–¼â–¼ [ìˆ˜ì •ë¨] AI ì‹œë®¬ë ˆì´ì…˜ ì²´ë ¥ ë¡œì§ì´ ë°˜ì˜ëœ ê²½ê¸° ì‹œì‘ í•¨ìˆ˜ â–¼â–¼â–¼
function startMatchSequence() {
    setScores = [0, 0];
    currentSet = 1;
    setWinner = -1;
    matchBanHistory = { my: [], opp: [] };
    bans = {my:[], opp:[]};
    lastBanRole = { my: null, opp: null };
    playedMaps = [];
    playerSetCounts = {};
    
    // íƒ€ íŒ€ ê²½ê¸° ì‹œë®¬ë ˆì´ì…˜ (ì •ê·œ ì‹œì¦Œì¸ ê²½ìš°)
    if(seasonState === "REGULAR") {
        const roundIdx = (currentWeek - 1) * 3 + (currentDayStep - 1);
        if (schedule[roundIdx]) {
            schedule[roundIdx].forEach(m => {
                if (m.h !== myTeam && m.a !== myTeam) {
                    // 1. ìŠ¤ì½”ì–´ ëœë¤ ìƒì„±
                    let s1 = Math.floor(Math.random()*4);
                    let s2 = s1===3 ? Math.floor(Math.random()*3) : 3;
                    let winner = s1 > s2 ? m.h : m.a;
                    
                    // 2. ê¸°ë¡ ì²˜ë¦¬
                    calcMatchPOTM(winner);
                    recordStats(m.h, m.a, s1, s2);
                    
                    // 3. [ìˆ˜ì •ë¨] ì²´ë ¥ ê°ì†Œ ë¡œì§ (ì„¸íŠ¸ ìˆ˜ ë°˜ì˜)
                    let totalSets = s1 + s2; // ì´ ì§„í–‰ ì„¸íŠ¸ ìˆ˜
                    
                    [m.h, m.a].forEach(tName => {
                        let r = TEAM_DB[tName];
                        // AIëŠ” ì£¼ì „ 5ëª…ì„ ëœë¤ìœ¼ë¡œ ë½‘ì•„ì„œ í’€íƒ€ì„ ë›°ì—ˆë‹¤ê³  ê°€ì •
                        let shuffled = [...r].sort(() => 0.5 - Math.random());
                        let starters = shuffled.slice(0, 5); 
                        
                        starters.forEach(p => {
                            let lossPerSet = (p.trait === "ìœ ë§ì£¼") ? 2 : 3;
                            let totalLoss = totalSets * lossPerSet;
                            p.hp = Math.max(0, p.hp - totalLoss);
                        });
                    });
                }
            });
        }
    }

    updateScoreBoard();
    startSet();
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ êµì²´ â–²â–²â–²
    function calcMatchPOTM(winnerTeam) {
        if(!TEAM_DB[winnerTeam]) return "Unknown";
        const roster = TEAM_DB[winnerTeam];
        let bestScore = -1;
        let bestPlayer = null;
        let candidates = roster;
        if (winnerTeam === myTeam && Object.keys(playerSetCounts).length > 0) {
             candidates = roster.filter(p => playerSetCounts[p.n] > 0);
        }
        candidates.forEach(p => {
            let setBonus = (playerSetCounts[p.n] || 0) * 5; 
            let score = (p.a + p.s + p.m + p.t) + (Math.random() * 50) + setBonus; 
            if(score > bestScore) { bestScore = score; bestPlayer = p; }
        });
        if(bestPlayer) { bestPlayer.potm++; return bestPlayer.n; }
        return "Unknown";
    }

    // --- AI SMART MAP SELECTION ---
// â–¼â–¼â–¼ [2ë‹¨ê³„] AI ë§µ ì„ íƒ ë¡œì§ (ëœë¤ì„± ì¶”ê°€) â–¼â–¼â–¼
function getBestAiMap(pool) {
    let oppName = getCurrentOpponentName();
    if(!oppName || !TEAM_DB[oppName]) return pool[Math.floor(Math.random()*pool.length)];
    
    let aiRoster = TEAM_DB[oppName];
    let candidates = [];

    // ëª¨ë“  í›„ë³´ ë§µì— ëŒ€í•´ ì ìˆ˜ ê³„ì‚°
    pool.forEach(map => {
        let score = 0;
        let meta = MAP_META[map];
        
        // ì „ëµ ì ìˆ˜ ê³„ì‚° (ê¸°ì¡´ ë¡œì§)
        aiRoster.forEach(p => {
            p.ms.forEach(hero => {
                if(meta.good.includes(hero)) score += 10;
                if(meta.bad.includes(hero)) score -= 10;
            });
        });

        // [í•µì‹¬] ëœë¤ì„± ë¶€ì—¬ (0 ~ 25ì  ì‚¬ì´ì˜ ëœë¤ ì ìˆ˜ ì¶”ê°€)
        // ì „ëµ ì ìˆ˜ ì°¨ì´ê°€ 20ì  ë‚´ì™¸ë¼ë©´ ëœë¤ ìš´ì— ë”°ë¼ ë’¤ì§‘í ìˆ˜ ìˆìŒ
        let noise = Math.random() * 25; 
        
        candidates.push({ map: map, totalScore: score + noise });
    });

    // ì´ì (ì „ëµ+ìš´)ì´ ê°€ì¥ ë†’ì€ ë§µ ì„ íƒ
    candidates.sort((a,b) => b.totalScore - a.totalScore);
    
    // ë””ë²„ê¹…ìš© ë¡œê·¸ (í•„ìš” ì‹œ ì£¼ì„ í•´ì œ)
    // console.log("AI Map Candidates:", candidates);

    return candidates[0].map;
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    function startSet() {
        let maxSets = (seasonState === 'POST_FINAL') ? 7 : 5;
        document.getElementById('set-score-txt').innerText = `SET ${currentSet} (Bo${maxSets})`;
        bans = {my:[], opp:[]}; 
        switchPhase('ui-map');
        const modes = ["ìŸíƒˆ","í˜¼í•©","í”Œë˜ì‹œ","ë°€ê¸°","í˜¸ìœ„"];
        let modeIndex = (currentSet - 1) % 5;
        const mode = modes[modeIndex];
        const selector = document.getElementById('map-select');
        selector.innerHTML = "";
        
        let userPicks = (currentSet === 1 || setWinner === 1);
        let pool = MAP_POOLS[mode].filter(m => !playedMaps.includes(m));
        if(pool.length === 0) pool = MAP_POOLS[mode]; 

        if(userPicks) {
            document.getElementById('map-msg').innerText = `[íŒ¨ì ì„ íƒê¶Œ] ${mode} ë§µì„ ì„ íƒí•˜ì‹­ì‹œì˜¤.`;
            pool.forEach(m => selector.innerHTML += `<option>${m}</option>`);
            document.querySelector('#ui-map button').disabled = false;
        } else {
            let aiMap = getBestAiMap(pool);
            currentMap = aiMap;
            document.getElementById('map-msg').innerText = `ìƒëŒ€íŒ€ì´ ${aiMap}ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤. (ì „ëµì  ì„ íƒ)`;
            selector.innerHTML = `<option>${aiMap}</option>`;
            document.querySelector('#ui-map button').disabled = true;
            setTimeout(confirmMap, 1500);
        }
    }

// â–¼â–¼â–¼ [1ë‹¨ê³„] ë§µ ì¹´ìš´íŒ… ë³€ìˆ˜ ë° í™•ì • í•¨ìˆ˜ ìˆ˜ì • â–¼â–¼â–¼
let MAP_PICK_COUNTS = {}; // ë§µë³„ í”Œë ˆì´ íšŸìˆ˜ ì €ì¥ { "ì™•ì˜ ê¸¸": 5, ... }

function confirmMap() {
    if(!document.querySelector('#ui-map button').disabled) {
        currentMap = document.getElementById('map-select').value;
    }
    
    playedMaps.push(currentMap);
    
    // [ì¶”ê°€ë¨] ë§µ í”Œë ˆì´ íšŸìˆ˜ ì¹´ìš´íŠ¸ (ì‹œì¦Œ ì¢…ë£Œ í›„ ë¡œí…Œì´ì…˜ìš©)
    if (!MAP_PICK_COUNTS[currentMap]) MAP_PICK_COUNTS[currentMap] = 0;
    MAP_PICK_COUNTS[currentMap]++;
    
    log(`[MAP] ${currentSet}ì„¸íŠ¸ ì „ì¥: ${currentMap}`);
    setupRosterCheck();
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
    function setupRosterCheck() {
        switchPhase('ui-roster');
        let meta = MAP_META[currentMap] || {type:"General", good:[], bad:[]};
        document.getElementById('map-meta-roster').innerHTML = `Map Type: <strong>${meta.type}</strong>`;
        const el = document.getElementById('roster-slots');
        el.innerHTML = "";
        const roles = ["TANK","DPS","DPS","SUP","SUP"];
        const myRoster = TEAM_DB[myTeam];
        roles.forEach((r, i) => {
            let pSel = `<select id="rp${i}">`;
            myRoster.filter(p=>p.r===r).forEach(p => pSel += `<option value="${p.n}">${p.n} (${p.hp}%)</option>`);
            pSel += `</select>`;
            el.innerHTML += pSel;
        });
        document.getElementById('roster-opp-display').innerText = "(Waiting for your confirmation...)";
    }

    function confirmRoster() {
        myLockedPlayers = [];
        for(let i=0; i<5; i++) {
            let val = document.getElementById(`rp${i}`).value;
            if(myLockedPlayers.includes(val)) { alert("ì¤‘ë³µ ì„ ìˆ˜!"); return; }
            myLockedPlayers.push(val);
        }
        generateOpponentPlayers();
        let oppHtml = "";
        oppLockedPlayers.forEach(p => {
            let hpColor = p.hp > 80 ? '#2ecc71' : (p.hp > 50 ? '#f1c40f' : '#e74c3c');
            oppHtml += `<div style="background:#333; margin:5px; padding:5px; border-radius:4px;">
                ${p.n} <span style="font-size:0.8em; color:${hpColor};">(${p.hp}%)</span>
                <span style="font-size:0.8em; color:#888;">${p.r}</span>
                </div>`;
        });
        document.getElementById('roster-opp-display').innerHTML = oppHtml;
        log("[LINEUP] ì–‘ íŒ€ ë¡œìŠ¤í„° í™•ì •.");
        setTimeout(setupHeroBan, 1500);
    }

    function generateOpponentPlayers() {
        let oppTeamName = getCurrentOpponentName();
        if(!oppTeamName || !TEAM_DB[oppTeamName]) {
            let allTeams = Object.keys(TEAM_DB).filter(t => t !== myTeam);
            oppTeamName = allTeams[0];
        }
        const oppRoster = TEAM_DB[oppTeamName];
        const roles = ["TANK","DPS","DPS","SUP","SUP"];
        oppLockedPlayers = []; 
        let usedPlayers = [];
        roles.forEach(r => {
            let availablePlayers = oppRoster.filter(p => p.r === r && !usedPlayers.includes(p.n));
            if(availablePlayers.length === 0) availablePlayers = oppRoster.filter(p => p.r === r);
            availablePlayers.sort((a,b) => b.hp - a.hp);
            let pickIndex = Math.random() < 0.7 ? 0 : Math.floor(Math.random()*availablePlayers.length);
            let pickP = availablePlayers[pickIndex];
            if(pickP) {
                usedPlayers.push(pickP.n);
                oppLockedPlayers.push(pickP);
            }
        });
    }

    function setupHeroBan() {
        switchPhase('ui-ban');
        let oppListHtml = "";
        oppLockedPlayers.forEach(p => oppListHtml += `<div>${p.n}</div>`);
        document.getElementById('ban-phase-opp-list').innerHTML = oppListHtml;
        const s = document.getElementById('ban-select');
        s.innerHTML = "";
        if(lastBanRole.my) log(`[BAN RULE] ì´ë²ˆ ì„¸íŠ¸ ìš°ë¦¬ íŒ€ì€ '${lastBanRole.my}' ë°´ ë¶ˆê°€.`);
        ["TANK","DPS","SUP"].forEach(r => {
            if (lastBanRole.my === r) return; 
            HEROES[r].forEach(h => {
                if(!bans.my.includes(h.n) && !matchBanHistory.my.includes(h.n)) {
                    s.innerHTML += `<option value="${h.n}">[${r}] ${h.n}</option>`;
                }
            });
        });
        document.getElementById('opp-ban-display').innerText = "-";
    }

    function confirmBan() {
        let mb = document.getElementById('ban-select').value;
        bans.my.push(mb);
        matchBanHistory.my.push(mb); 
        let myRole = getHeroRole(mb);
        lastBanRole.my = myRole; 
        
        let userThreats = [];
        myLockedPlayers.forEach(pName => {
            let pObj = TEAM_DB[myTeam].find(p=>p.n===pName);
            if(pObj) userThreats.push(...pObj.ms);
        });

        let pool = [];
        let smartBanCandidates = [];

        ["TANK","DPS","SUP"].forEach(r => {
            if(r === myRole) return; 
            if(r === lastBanRole.opp) return; 
            HEROES[r].forEach(h => { 
                if(!bans.opp.includes(h.n) && !matchBanHistory.opp.includes(h.n)) {
                    pool.push(h.n);
                    if(userThreats.includes(h.n)) smartBanCandidates.push(h.n);
                }
            });
        });
        
        if(pool.length === 0 && smartBanCandidates.length === 0) {
             ["TANK","DPS","SUP"].forEach(r => {
                if(r === myRole) return;
                HEROES[r].forEach(h => { 
                    if(!bans.opp.includes(h.n) && !matchBanHistory.opp.includes(h.n)) {
                        pool.push(h.n);
                    }
                });
            });
        }
        let ab;
        if(smartBanCandidates.length > 0 && Math.random() < 0.8) ab = smartBanCandidates[Math.floor(Math.random()*smartBanCandidates.length)];
        else ab = pool[Math.floor(Math.random()*pool.length)];
        bans.opp.push(ab);
        matchBanHistory.opp.push(ab); 
        lastBanRole.opp = getHeroRole(ab);
        
        document.getElementById('opp-ban-display').innerText = `ğŸš« ${ab}`;
        log(`[BAN] My: ${mb} | Opp: ${ab}`);
        setTimeout(setupHeroPick, 1000);
    }

function setupHeroPick() {
        switchPhase('ui-pick');
        const el = document.getElementById('pick-slots');
        el.innerHTML = "";
        myLockedPlayers.forEach((pName, i) => {
            let pObj = TEAM_DB[myTeam].find(p=>p.n===pName);
            let role = pObj.r;
            let html = `<div style="margin-bottom:10px;">
                <div style="font-weight:bold; color:var(--ow-orange);">${pName} (${role})</div>
                <select id="hpick${i}">`;
            
            // [ìˆ˜ì •ë¨] matchBanHistory ì¡°ê±´ ì œê±° -> í˜„ì¬ ì„¸íŠ¸ ë°´(bans)ë§Œ í™•ì¸
            HEROES[role].filter(h => !bans.my.includes(h.n) && !bans.opp.includes(h.n)).forEach(h => {
                html += `<option value="${h.n}">${h.n}</option>`;
            });

            html += `</select></div>`;
            el.innerHTML += html;
        });
        generateOpponentHeroes();
    }

function generateOpponentHeroes() {
        oppHeroPicks = [];
        let usedHeroes = [];
        let meta = MAP_META[currentMap] || {good:[], bad:[]};

        oppLockedPlayers.forEach(p => {
            let role = p.r;
            // [ìˆ˜ì •ë¨] matchBanHistory ì¡°ê±´ ì œê±° -> í˜„ì¬ ì„¸íŠ¸ ë°´(bans)ë§Œ í™•ì¸
            let availableHeroes = HEROES[role].filter(h => 
                !bans.opp.includes(h.n) && !bans.my.includes(h.n) && 
                !usedHeroes.includes(h.n)
            );
            if(availableHeroes.length === 0) availableHeroes = HEROES[role].filter(h => !bans.opp.includes(h.n)); 

            let bestHero = availableHeroes[0];
            let maxScore = -999;
            availableHeroes.forEach(h => {
                let score = 0;
                if(p.ms.includes(h.n)) score += 50;
                if(meta.good.includes(h.n)) score += 20;
                if(meta.bad.includes(h.n)) score -= 20;
                score += Math.random() * 5;
                if(score > maxScore) { maxScore = score; bestHero = h; }
            });

            let pickH = bestHero || availableHeroes[0];
            usedHeroes.push(pickH.n);
            oppHeroPicks.push({ player: p, hero: pickH.n });
        });
        const disp = document.getElementById('opp-entry-display');
        disp.innerHTML = "";
        oppLockedPlayers.forEach(p => {
            disp.innerHTML += `<div class="opp-card"><div>${p.n}</div><div class="opp-hero hidden">?????</div></div>`;
        });
    }

// â–¼â–¼â–¼ [5ë‹¨ê³„] ìƒì„¸ ìŠ¤íƒ¯ ìƒì„± ë° ë Œë”ë§ì´ í¬í•¨ëœ ì „íˆ¬ í•¨ìˆ˜ â–¼â–¼â–¼
let CURRENT_SET_STATS = []; 

function runSimulation() {
    const COLOR_MY = "#3498db"; const COLOR_OPP = "#ff5e57";

    // 1. í”½ í™•ì¸
    let myHs = [];
    for(let i=0; i<5; i++) {
        let h = document.getElementById(`hpick${i}`).value;
        if(myHs.includes(h)) { alert("ì¤‘ë³µ ì˜ì›… ë¶ˆê°€!"); return; }
        myHs.push(h);
    }

    // 2. í”½ ì¹´ìš´íŠ¸ ì§‘ê³„
    let allCurrentPicks = [...myHs, ...oppHeroPicks.map(o => o.hero)];
    allCurrentPicks.forEach(h => {
        if(SEASON_PICK_COUNTS[h] !== undefined) SEASON_PICK_COUNTS[h]++;
        else SEASON_PICK_COUNTS[h] = 1;
    });

    const disp = document.getElementById('opp-entry-display');
    disp.innerHTML = "";
    oppHeroPicks.forEach(o => {
        disp.innerHTML += `<div class="opp-card"><div>${o.player.n}</div><div class="opp-hero" style="color:var(--ban-red);">${o.hero}</div></div>`;
    });
    
    CURRENT_SET_STATS = []; 
    let meta = MAP_META[currentMap] || {type:"General", good:[], bad:[]};
    let logEvents = []; 
    
    // --- ì „íˆ¬ë ¥ ë° ìƒì„¸ ìŠ¤íƒ¯ ê³„ì‚° ---
    function calcTeamData(playerNames, heroes, isMyTeam) {
        let totalPower = 0;
        let teamAvgTeamwork = 0;
        let teamCompCount = 0;
        let players = isMyTeam ? playerNames.map(n => TEAM_DB[myTeam].find(p=>p.n===n)) : playerNames.map(o => o.player);
        let heroList = isMyTeam ? heroes : heroes.map(o => o.hero);
        
        let myScore = isMyTeam ? setScores[0] : setScores[1];
        let oppScore = isMyTeam ? setScores[1] : setScores[0];
        let isBehind = myScore < oppScore;

        players.forEach((p, idx) => {
            let hName = heroList[idx];
            
            // ê¸°ë³¸ ì „íˆ¬ë ¥ ê³„ì‚°
            let hpRatio = p.hp / 100;
            let condition = 0.90 + (Math.random() * 0.20 * hpRatio);
            let bonus = (p.trait === "ì†Œë…„ê°€ì¥" && isBehind) ? 5 : 0;
            
            let val = (p.a*0.35 + p.s*0.35 + p.m*0.15 + p.t*0.15 + bonus) * condition;
            val *= (0.6 + (p.hp/250)); 

            // ë°¸ëŸ°ìŠ¤/ë©”íƒ€/ëª¨ìŠ¤íŠ¸ ë°˜ì˜
            if(HERO_BALANCE[hName]) val *= HERO_BALANCE[hName];
            if(p.ms.includes(hName)) val += 8;
            if(meta.good.includes(hName)) val += 6;
            if(meta.bad.includes(hName)) val -= 6;
            
            let hData = HEROES[p.r].find(h=>h.n===hName);
            if(hData && hData.t === meta.type) { val += 4; teamCompCount++; }

            // ì´ë²¤íŠ¸ ë°œìƒ ì—¬ë¶€
            let mistakeChance = ((100 - p.m) / 2.5);
            if(Math.random()*100 < mistakeChance) {
                val *= 0.6;
                logEvents.push({type:'mistake', team: isMyTeam?'MY':'OPP', player:p.n, hero:hName});
            } else if(p.a > 90 && Math.random() < 0.15) {
                val *= 1.3;
                logEvents.push({type:'crack', team: isMyTeam?'MY':'OPP', player:p.n, hero:hName});
            }

            totalPower += val;
            teamAvgTeamwork += p.t;

            // [ìƒì„¸ ìŠ¤íƒ¯ ìƒì„± ë¡œì§ ê°•í™”]
            // ì—­í• êµ°ë³„ ê°€ì¤‘ì¹˜: [í‚¬, ë°ìŠ¤, ì–´ì‹œ, ë”œ, í, ê²½ê°]
            let k=0, d=0, a=0, dmg=0, heal=0, mit=0;
            let base = val; // ì „íˆ¬ë ¥ ê¸°ë°˜

            if (p.r === 'TANK') {
                k = base/12; d = 4; a = base/8;
                dmg = base * 90; heal = base * 10; mit = base * 180; 
            } else if (p.r === 'DPS') {
                k = base/7; d = 5; a = base/10;
                dmg = base * 130; heal = base * 5; mit = base * 5;
            } else { // SUP
                k = base/20; d = 4; a = base/5;
                dmg = base * 40; heal = base * 110; mit = base * 10;
            }

            // ëœë¤ ë³€ë™í­ ì¶”ê°€
            k = Math.floor(k * (0.8 + Math.random()*0.4));
            d = Math.floor(d * (0.5 + Math.random()*1.0));
            a = Math.floor(a * (0.8 + Math.random()*0.4));
            dmg = Math.floor(dmg * (0.85 + Math.random()*0.3));
            heal = Math.floor(heal * (0.85 + Math.random()*0.3));
            mit = Math.floor(mit * (0.8 + Math.random()*0.4));

            CURRENT_SET_STATS.push({
                team: isMyTeam ? 'MY' : 'OPP',
                role: p.r,
                name: p.n,
                hero: hName,
                k: k, d: d, a: a, dmg: dmg, heal: heal, mit: mit
            });
        });
        
        if(teamCompCount >= 3) totalPower += 15;
        return { power: totalPower, avgTeamwork: teamAvgTeamwork/5 };
    }

    let d1 = calcTeamData(myLockedPlayers, myHs, true);
    let d2 = calcTeamData(oppHeroPicks, oppHeroPicks, false);
    
    // ìŠ¹íŒ¨ ê²°ì •
    let myFinal = d1.power * (0.95 + Math.random()*0.1);
    let oppFinal = d2.power * (0.95 + Math.random()*0.1);
    let diff = myFinal - oppFinal;
    let winningTeam = diff > 0 ? 'MY' : 'OPP';

    // íŒ€ì›Œí¬ ë³€ìˆ˜ (ì—­ì „)
    if (Math.abs(diff) < 40) {
        if (winningTeam === 'OPP' && d1.avgTeamwork > d2.avgTeamwork) {
            myFinal += (d1.avgTeamwork - d2.avgTeamwork) * 3;
            logEvents.push({ type: 'comeback', team: 'MY' });
        } else if (winningTeam === 'MY' && d2.avgTeamwork > d1.avgTeamwork) {
            oppFinal += (d2.avgTeamwork - d1.avgTeamwork) * 3;
            logEvents.push({ type: 'comeback', team: 'OPP' });
        }
    }

    let isWin = myFinal > oppFinal;

// â–¼â–¼â–¼ [ëˆ„ë½ëœ ì½”ë“œ ë³µêµ¬] ì„¸íŠ¸ ì¶œì „ íšŸìˆ˜ ì¹´ìš´íŠ¸ (ì´ê²Œ ìˆì–´ì•¼ ì²´ë ¥ì´ ì¤„ì–´ë“¦) â–¼â–¼â–¼
    myLockedPlayers.forEach(n => {
        playerSetCounts[n] = (playerSetCounts[n] || 0) + 1;
    });
    oppLockedPlayers.forEach(p => {
        playerSetCounts[p.n] = (playerSetCounts[p.n] || 0) + 1;
    });
    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ ì¶”ê°€ â–²â–²â–²

    // ìŠ¹íŒ¨ì— ë”°ë¥¸ ìŠ¤íƒ¯ ìµœì¢… ë³´ì • (ìŠ¹ë¦¬íŒ€ K/D ì´ë“, íŒ¨ë°°íŒ€ ë°ìŠ¤ ì¦ê°€)
    CURRENT_SET_STATS.forEach(s => {
        if((s.team === 'MY' && isWin) || (s.team === 'OPP' && !isWin)) {
            s.k += Math.floor(Math.random()*5 + 2); 
            s.a += Math.floor(Math.random()*5);
            s.d = Math.max(0, s.d - 2); 
        } else {
            s.d += Math.floor(Math.random()*4 + 2); 
            s.k = Math.max(0, s.k - 3);
        }
    });

    // ê¸°ë¡ ì €ì¥
    if(typeof MATCH_STATS_HISTORY !== 'undefined') MATCH_STATS_HISTORY[currentSet] = CURRENT_SET_STATS;

    // ì ìˆ˜ ì—…ë°ì´íŠ¸
    if(isWin) { setScores[0]++; setWinner=0; } 
    else { setScores[1]++; setWinner=1; }
    
    updateScoreBoard();

    // ë¡œê·¸ ë° í•´ì„¤ ìƒì„±
    generateCommentary(isWin, myFinal, oppFinal, logEvents);

    // â˜…â˜…â˜… ê¸°ë¡ì§€ ë Œë”ë§ â˜…â˜…â˜…
    const tbody = document.getElementById('result-stats-body');
    tbody.innerHTML = "";
    
    // ì•„êµ° ë¨¼ì €, ê·¸ ë‹¤ìŒ ì êµ°
    let list = [...CURRENT_SET_STATS.filter(s=>s.team==='MY'), ...CURRENT_SET_STATS.filter(s=>s.team==='OPP')];
    
    list.forEach(s => {
        let rowClass = s.team === 'MY' ? 'stat-my' : 'stat-opp'; 
        let roleIcon = s.role === 'TANK' ? 'ğŸ›¡ï¸' : (s.role === 'DPS' ? 'âš”ï¸' : 'â¤ï¸');
        
        tbody.innerHTML += `
            <tr class="stat-row ${rowClass}">
                <td style="font-weight:bold; color:#ddd; font-size:0.9em;">
                    <span style="margin-right:5px;">${roleIcon}</span>${s.hero}
                </td>
                <td style="font-weight:bold;">${s.name}</td>
                <td style="color:white; letter-spacing:1px;">${s.k} / ${s.d} / ${s.a}</td>
                <td style="color:#e74c3c;">${s.dmg.toLocaleString()}</td>
                <td style="color:#f1c40f;">${s.heal.toLocaleString()}</td>
                <td style="color:#3498db;">${s.mit.toLocaleString()}</td>
            </tr>`;
    });

    // ë²„íŠ¼ ì„¤ì •
    const btn = document.getElementById('btn-next-set');
    let winTarget = (seasonState === 'POST_FINAL') ? 4 : 3;
    if(setScores[0]===winTarget || setScores[1]===winTarget) {
        btn.innerText = "ë§¤ì¹˜ ì¢…ë£Œ (FINISH MATCH)";
        btn.onclick = () => endMatch();
    } else {
        btn.innerText = `ë‹¤ìŒ ì„¸íŠ¸ ì§„í–‰ (GO SET ${currentSet+1})`;
        btn.onclick = () => proceedNextStep();
    }

    // ê²°ê³¼ í™”ë©´ ë³´ì´ê¸°
    const resTitle = document.getElementById('result-title');
    if(isWin) resTitle.innerHTML = `<span style="color:${COLOR_MY}">WIN</span> <span style="font-size:0.6em; color:#aaa;">(Set Score: ${setScores[0]} : ${setScores[1]})</span>`;
    else resTitle.innerHTML = `<span style="color:${COLOR_OPP}">LOSE</span> <span style="font-size:0.6em; color:#aaa;">(Set Score: ${setScores[0]} : ${setScores[1]})</span>`;

// â–¼â–¼â–¼ [7,8ë‹¨ê³„ ì¶”ê°€] ì•„êµ° ì„ ìˆ˜ë“¤ì˜ ì„¸íŠ¸ ê¸°ë¡ì„ ì˜êµ¬ ì €ì¥ì†Œì— ë°˜ì˜ â–¼â–¼â–¼
    CURRENT_SET_STATS.forEach(s => {
        if (s.team === 'MY') { // ìš°ë¦¬ íŒ€ ì„ ìˆ˜ë§Œ ê¸°ë¡
            updateHistoryData(s.name, s);
        }
    });
    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    switchPhase('ui-result');
}

// í•´ì„¤ ìƒì„± í•¨ìˆ˜ ë¶„ë¦¬ (ê°€ë…ì„± ìœ„í•´)
// â–¼â–¼â–¼ [ìˆ˜ì •ë¨] í•´ì„¤ ìƒì„± í•¨ìˆ˜ (ì „íˆ¬ ë¬˜ì‚¬ + ì´ë²¤íŠ¸ ëª¨ë‘ í¬í•¨) â–¼â–¼â–¼
function generateCommentary(isWin, p1, p2, events) {
    const logWin = document.getElementById('log-window');
    const C_MY = "#3498db"; const C_OPP = "#ff5e57"; // íŒŒë‘, ë¹¨ê°•
    
    let html = `<div style="margin-top:20px; border-top:2px dashed #444; padding-top:10px; color:#aaa; font-size:0.9em; font-weight:bold;">[ SET ${currentSet} - COMMENTARY ]</div>`;
    
    // 1. ì˜¤í”„ë‹ ë©˜íŠ¸
    let openingTxt = COMMENTARY_DB.OPENING[Math.floor(Math.random()*COMMENTARY_DB.OPENING.length)];
    html += `<div style="color:#ccc; margin-bottom:8px;">"${openingTxt}"</div>`;

    // 2. [ë³µêµ¬ë¨] ì¤‘ê°„ ì „íˆ¬ ìƒí™© ë¬˜ì‚¬ (ìƒë™ê° ì¶”ê°€)
    const BATTLE_MID = [
            "{atk}ì˜ {h1}ê°€ ì „ì„ ì„ ë°€ì–´ë¶™ì…ë‹ˆë‹¤! {def}ì˜ {h2}ê°€ ìœ„íƒœë¡­ìŠµë‹ˆë‹¤.",
            "{def}ì˜ {h2}, ëˆì§ˆê¸°ê²Œ ë²„í‹°ë©° {atk}ì˜ ê³µì„¸ë¥¼ ë§‰ì•„ëƒ…ë‹ˆë‹¤.",
            "ì¹˜ì—´í•œ ë‚œì „! {atk}({h1}) ì„ ìˆ˜ê°€ ì¢‹ì€ í¬ì§€ì…˜ì„ ì¡ì•˜ìŠµë‹ˆë‹¤.",
            "{def}, {h2}ì˜ ì¼€ì–´ë¥¼ ë°›ìœ¼ë©° ì¬ì •ë¹„í•©ë‹ˆë‹¤.",
            "ì„œë¡œ í‚¬ êµí™˜ì´ ì¼ì–´ë‚©ë‹ˆë‹¤! {atk}ì™€ {def} ëª¨ë‘ ë¬¼ëŸ¬ì„œì§€ ì•ŠìŠµë‹ˆë‹¤.",
            // [ì¶”ê°€ë¨]
            "{atk}ì˜ {h1}, ì¸¡ë©´ì„ íŒŒê³ ë“­ë‹ˆë‹¤! {def} í”ë“¤ë¦½ë‹ˆë‹¤!",
            "{def}ì˜ {h2}! ìŠˆí¼ ì„¸ì´ë¸Œ! {atk}ì˜ ê²°ì •ì ì¸ ê³µê²©ì„ ë§‰ì•„ëƒ…ë‹ˆë‹¤.",
            "í™”ë¬¼ ê·¼ì²˜ì—ì„œ ë¹„ë¹„ê¸° ì‹¸ì›€! {atk}ì™€ {def}ì˜ ë‚œíƒ€ì „ì…ë‹ˆë‹¤!",
            "{atk}ì˜ {h1}ê°€(ì´) ë‚ ë›°ê³  ìˆìŠµë‹ˆë‹¤! {def} ì„ ìˆ˜ë“¤ ë‹¹í™©í•©ë‹ˆë‹¤.",
            "ì¡°ìš©í–ˆë˜ ì „ì¥, {def}ì˜ {h2}ê°€ ì´ë‹ˆì‹œì—ì´íŒ…ì„ ê²ë‹ˆë‹¤!"
    ];

    // ëœë¤í•˜ê²Œ 2ê°œì˜ ì „íˆ¬ ìƒí™© ìƒì„±
    for(let k=0; k<2; k++) {
        let myIdx = Math.floor(Math.random() * 5);
        let oppIdx = Math.floor(Math.random() * 5);
        
        let myPName = myLockedPlayers[myIdx];
        let myHName = document.getElementById(`hpick${myIdx}`).value; // í˜„ì¬ í”½í•œ ì˜ì›… ê°€ì ¸ì˜¤ê¸°
        
        let oppPName = oppHeroPicks[oppIdx].player.n;
        let oppHName = oppHeroPicks[oppIdx].hero;

        // ìœ ë¦¬í•œ ìª½ì´ ê³µê²©í•˜ëŠ” ë©˜íŠ¸ê°€ ë‚˜ì˜¬ í™•ë¥  ë†’ì„
        let myAdv = (p1 > p2) ? (Math.random() > 0.4) : (Math.random() > 0.6);
        
        let atkName = myAdv ? myPName : oppPName;
        let atkHero = myAdv ? myHName : oppHName;
        let atkColor = myAdv ? C_MY : C_OPP;
        
        let defName = myAdv ? oppPName : myPName;
        let defHero = myAdv ? oppHName : myHName;
        let defColor = myAdv ? C_OPP : C_MY;

        let tpl = BATTLE_MID[Math.floor(Math.random() * BATTLE_MID.length)];
        let msg = tpl.replace(/{atk}/g, `<span style="color:${atkColor}; font-weight:bold;">${atkName}</span>`)
                     .replace(/{h1}/g, atkHero)
                     .replace(/{def}/g, `<span style="color:${defColor}; font-weight:bold;">${defName}</span>`)
                     .replace(/{h2}/g, defHero);
                     
        html += `<div style="font-size:0.9em; margin:4px 0;">âš”ï¸ ${msg}</div>`;
    }

    // 3. ì£¼ìš” ì´ë²¤íŠ¸ (ì‹¤ìˆ˜, ìŠˆí¼í”Œë ˆì´, íŒ€ì›Œí¬)
    events.forEach(e => {
        let c = e.team === 'MY' ? C_MY : C_OPP;
        let skillName = (typeof HERO_SKILLS !== 'undefined') ? (HERO_SKILLS[e.hero] || "ìŠ¤í‚¬") : "ìŠ¤í‚¬";
        
        if(e.type === 'mistake') {
            // ì‹¤ìˆ˜ ë©˜íŠ¸ DB í™œìš©
            let tpl = COMMENTARY_DB.MISTAKE[Math.floor(Math.random()*COMMENTARY_DB.MISTAKE.length)];
            let txt = tpl.replace(/{player}/g, e.player).replace(/{hero}/g, e.hero).replace(/{skill}/g, skillName);
            html += `<div><span style="color:${c}">â–¶ [ì‹¤ìˆ˜] ${txt}</span></div>`;
        } 
        else if(e.type === 'crack') {
            // ìŠˆí¼í”Œë ˆì´ ë©˜íŠ¸ DB í™œìš©
            let tpl = COMMENTARY_DB.CRACK[Math.floor(Math.random()*COMMENTARY_DB.CRACK.length)];
            let txt = tpl.replace(/{player}/g, e.player).replace(/{hero}/g, e.hero).replace(/{skill}/g, skillName);
            html += `<div><span style="color:${c}">â–¶ [ìŠˆí¼í”Œë ˆì´] ${txt}</span></div>`;
        } 
        else if(e.type === 'comeback') {
            html += `<div style="color:${c}; font-weight:bold;">â–¶ íŒ€ì›Œí¬ ë°œë™! ë¶ˆë¦¬í•œ ì „í™©ì„ ë’¤ì§‘ìŠµë‹ˆë‹¤!</div>`;
        }
    });

    // 4. ì„¸íŠ¸ ê²°ê³¼
    let resColor = isWin ? C_MY : C_OPP;
    let resText = isWin ? "ìŠ¹ë¦¬!" : "íŒ¨ë°°...";
    html += `<div style="margin-top:10px; font-weight:bold; font-size:1.1em; color:${resColor}; border-bottom:1px solid ${resColor}; padding-bottom:5px;">>> ${currentSet}ì„¸íŠ¸ ${resText}</div>`;

    logWin.innerHTML += html;
    logWin.scrollTop = logWin.scrollHeight; // ìŠ¤í¬ë¡¤ ìë™ ë‚´ë¦¼
}
// â–²â–²â–² [ìˆ˜ì • ì™„ë£Œ] â–²â–²â–²// â–²â–²â–² [5ë‹¨ê³„] ë â–²â–²â–²

// â–¼â–¼â–¼ [ëˆ„ë½ëœ ì½”ë“œ] ë‹¤ìŒ ì„¸íŠ¸ë¡œ ë„˜ì–´ê°€ëŠ” í•¨ìˆ˜ â–¼â–¼â–¼
function proceedNextStep() {
    currentSet++;    // ì„¸íŠ¸ ìˆ˜ ì¦ê°€
    startSet();      // ë‹¤ìŒ ì„¸íŠ¸ ì‹œì‘ (ë§µ ì„ íƒ í™”ë©´ìœ¼ë¡œ ì´ë™)
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

// â–¼â–¼â–¼ [9ë‹¨ê³„] ì—”ë”© ì—†ì´ ë¬´í•œ ì‹œì¦Œ ì§„í–‰ì„ ìœ„í•œ ë§¤ì¹˜ ì¢…ë£Œ í•¨ìˆ˜ â–¼â–¼â–¼
function endMatch() {
    let winTarget = (seasonState === 'POST_FINAL') ? 4 : 3;
    let won = setScores[0] === winTarget;
    let opp = getCurrentOpponentName();
    let winnerTeam = won ? myTeam : opp;
    
    let potmName = calcMatchPOTM(winnerTeam); // POTM ì„ ì •
    
    // [7,8ë‹¨ê³„ ì—°ë™] ìš°ë¦¬ íŒ€ POTM ê¸°ë¡ ì €ì¥
    if (winnerTeam === myTeam) {
        updateHistorySingle(potmName, 'POTM');
    }

    log(`ë§¤ì¹˜ ì¢…ë£Œ. ${won ? 'ìŠ¹ë¦¬' : 'íŒ¨ë°°'}.`);
    log(`<span class="log-potm">â˜… POTM: ${potmName} (${winnerTeam})</span>`);
    
// â–¼â–¼â–¼ [ìˆ˜ì •ë¨] endMatch í•¨ìˆ˜ ë‚´ë¶€ì˜ ì²´ë ¥ ê°ì†Œ ë¡œì§ â–¼â–¼â–¼
    
    // ì»¨ë””ì…˜(HP) ê°ì†Œ ë¡œì§ (ìš”ì²­ì‚¬í•­ ë°˜ì˜: ì„¸íŠ¸ë‹¹ 3 / ìœ ë§ì£¼ 2)
    Object.keys(playerSetCounts).forEach(pName => {
        let setsPlayed = playerSetCounts[pName]; // ì„ ìˆ˜ê°€ ë›´ ì„¸íŠ¸ ìˆ˜
        let foundP = null;
        
        // ì „ êµ¬ë‹¨ ê²€ìƒ‰í•´ì„œ ì„ ìˆ˜ ê°ì²´ ì°¾ê¸°
        Object.values(TEAM_DB).some(roster => {
            let target = roster.find(x => x.n === pName);
            if (target) { foundP = target; return true; }
        });

        if (foundP) {
            // ê¸°ë³¸ 3, ìœ ë§ì£¼ 2
            let lossPerSet = (foundP.trait === "ìœ ë§ì£¼") ? 2 : 3;
            let totalLoss = setsPlayed * lossPerSet;
            
            foundP.hp = Math.max(0, foundP.hp - totalLoss);
            // ë¡œê·¸ í™•ì¸ìš© (í•„ìš” ì‹œ ì£¼ì„ í•´ì œ)
            // console.log(`${foundP.n}: -${totalLoss} HP (Sets: ${setsPlayed})`);
        }
    });

    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ êµì²´ â–²â–²â–²
    // --- ì‹œì¦Œ ìƒíƒœë³„ ì²˜ë¦¬ ---
    if (seasonState === "REGULAR") {
        recordStats(myTeam, opp, setScores[0], setScores[1]);
        advanceDay(); // ë‹¤ìŒ ë‚ ì§œë¡œ ì´ë™
    } 
    else if (seasonState === "POST_SEMI") {
        // 4ê°•ì „ ê²°ê³¼ ì²˜ë¦¬
        if(won) {
            let otherSemi = (playoffMatches.semiA.h === myTeam || playoffMatches.semiA.a === myTeam) ? playoffMatches.semiB : playoffMatches.semiA;
            let wOther = Math.random() > 0.5 ? otherSemi.h : otherSemi.a;
            calcMatchPOTM(wOther); 
            playoffMatches.final = {h: myTeam, a: wOther};
            log(`[ê²°ìŠ¹ ìƒëŒ€] ${wOther} íŒ€ì´ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤.`);
        } else { 
            // ì¡Œì„ ê²½ìš° ê²°ìŠ¹ ëŒ€ì§„ì€ ê°€ìƒìœ¼ë¡œ ìƒì„±
            playoffMatches.final = {h: "Team A", a: "Team B"}; 
        }
        seasonState = "POST_FINAL";
        setTimeout(updateRoundUI, 2000); // ì ì‹œ í›„ ë¡œë¹„ ê°±ì‹ 
    } 
    else if (seasonState === "POST_FINAL") {
        // [9ë‹¨ê³„ í•µì‹¬] ê²°ìŠ¹ì „ ì¢…ë£Œ ì²˜ë¦¬ (ì—”ë”© í™”ë©´ ì‚­ì œ)
        switchPhase('ui-lobby'); // ê²°ê³¼ì°½ ë‹«ê³  ë¡œë¹„ë¡œ ì´ë™
        document.getElementById('btn-start-match').style.display = 'block';

        if (won) {
            // ìš°ìŠ¹ ì‹œ: ì¶•í•˜ ë©”ì‹œì§€ ë° ë‹¤ìŒ ì‹œì¦Œ ë²„íŠ¼
            log(`ğŸ† [ìš°ìŠ¹] ì¶•í•˜í•©ë‹ˆë‹¤! SEASON ${seasonCount} í†µí•© ìš°ìŠ¹ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!`);
            document.getElementById('match-title').innerText = "ğŸ† CHAMPIONS!";
            document.getElementById('match-subtitle').innerText = `Season ${seasonCount} Winner`;
            document.getElementById('lobby-desc').innerText = "ìš°ìŠ¹ì˜ ì˜ê´‘ì„ ëˆ„ë¦¬ì‹­ì‹œì˜¤! (ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„)";
            
            // ìš°ìŠ¹ ê¸°ë…: ì•„êµ° ì „ì²´ ë©˜íƒˆ ì†Œí­ ìƒìŠ¹ ë³´ë„ˆìŠ¤
            TEAM_DB[myTeam].forEach(p => p.m = Math.min(99, p.m + 2));
            
            document.getElementById('btn-start-match').innerText = "ìš°ìŠ¹ ì¶•í•˜! (GO NEXT SEASON)";
            document.getElementById('btn-start-match').onclick = prepareNextSeason;
        } else {
            // ì¤€ìš°ìŠ¹ ì‹œ
            log(`ê²°ìŠ¹ì „ ì¢…ë£Œ. ì•„ì‰¬ìš´ ì¤€ìš°ìŠ¹ì…ë‹ˆë‹¤.`);
            document.getElementById('match-title').innerText = "SEASON FINALE";
            document.getElementById('lobby-desc').innerText = "ì¹˜ì—´í–ˆë˜ ì‹œì¦Œì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
            
            document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„ (GO NEXT SEASON)";
            document.getElementById('btn-start-match').onclick = prepareNextSeason;
        }
    }

    // SNS ìƒì„± (ë§ˆì§€ë§‰ì— í˜¸ì¶œ)
    generateTweets(won, setScores[0], setScores[1], potmName);
}
// â–²â–²â–² [9ë‹¨ê³„] ë â–²â–²â–²
    function setupPlayoffs() {
        if(seasonState === "POST_SEED") {
            document.getElementById('match-title').innerText = "POST-SEASON";
            document.getElementById('round-display').innerText = "PLAYOFFS - FRIDAY";
            document.getElementById('lobby-desc').innerText = "3~6ìœ„ ì‹œë“œ ê²°ì •ì „ ì§„í–‰ì¼ì…ë‹ˆë‹¤.";
            let sorted = Object.values(leagueStats).sort((a,b) => b.w - a.w || b.d - a.d);
            playoffMatches.seedA = {h: sorted[2].name, a: sorted[5].name};
            playoffMatches.seedB = {h: sorted[3].name, a: sorted[4].name};
            playoffMatches.rank1 = sorted[0].name;
            playoffMatches.rank2 = sorted[1].name;
            
            if (playoffMatches.rank1 === myTeam || playoffMatches.rank2 === myTeam) {
                seasonState = "POST_SEED_TRAIN"; 
                document.getElementById('match-subtitle').innerText = "ìƒìœ„ ì‹œë“œ(1-2ìœ„) íŠ¹ì „";
                document.getElementById('match-title').innerText = "BYE & TRAINING";
                document.getElementById('train-desc-txt').innerText = "ì‹œë“œ ê²°ì •ì „ ë™ì•ˆ íœ´ì‹/í›ˆë ¨ ê°€ëŠ¥.";
                switchPhase('ui-training');
            } else {
                const isInSeedA = (playoffMatches.seedA.h === myTeam || playoffMatches.seedA.a === myTeam);
                const isInSeedB = (playoffMatches.seedB.h === myTeam || playoffMatches.seedB.a === myTeam);
                if (isInSeedA || isInSeedB) {
                    document.getElementById('btn-start-match').innerText = "ì‹œë“œì „ ì‹œì‘";
                    document.getElementById('btn-start-match').onclick = runSeedMatches;
                    switchPhase('ui-lobby');
                } else {
                    document.getElementById('match-title').innerText = "SEASON ENDED";
                    document.getElementById('lobby-desc').innerText = "í”Œë ˆì´ì˜¤í”„ ì§„ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                    document.getElementById('btn-start-match').style.display = 'block';
                    document.getElementById('btn-start-match').innerText = "ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„";
                    document.getElementById('btn-start-match').onclick = prepareNextSeason;
                    switchPhase('ui-lobby');
                }
            }
        }
    }
    function runSeedMatches() {
        let winA = Math.random()>0.5 ? playoffMatches.seedA.h : playoffMatches.seedA.a;
        calcMatchPOTM(winA);
        let winB = Math.random()>0.5 ? playoffMatches.seedB.h : playoffMatches.seedB.a;
        calcMatchPOTM(winB);
        playoffMatches.winnerA = winA;
        playoffMatches.winnerB = winB;
        log(`[ì‹œë“œì „ ê²°ê³¼] ${winA}, ${winB} ìŠ¹ë¦¬.`);
        if (playoffMatches.rank1 === myTeam) {
            document.getElementById('lobby-desc').innerText = "1ìœ„ íŠ¹ì „: 4ê°• ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤.";
            document.getElementById('selection-area').style.display = 'block';
            let box = document.getElementById('pick-opponent-btns');
            box.innerHTML = "";
            [winA, winB].forEach(t => {
                let b = document.createElement('button');
                b.className = 'action-btn'; b.style.fontSize = "0.9em"; b.style.padding = "10px"; b.innerText = t;
                b.onclick = () => confirmPick(t); box.appendChild(b);
            });
            document.getElementById('btn-start-match').style.display = 'none';
        } else {
            let picked = Math.random()>0.5 ? winA : winB;
            let other = (picked === winA) ? winB : winA;
            log(`${playoffMatches.rank1} íŒ€ì´ ${picked}ë¥¼ ì§€ëª…í–ˆìŠµë‹ˆë‹¤.`);
            playoffMatches.semiA = {h: playoffMatches.rank1, a: picked};
            playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
            seasonState = "POST_SEMI";
            updateRoundUI();
        }
    }
    function runSeedMatchesSimOnly() {
        let winA = Math.random()>0.5 ? playoffMatches.seedA.h : playoffMatches.seedA.a;
        calcMatchPOTM(winA);
        let winB = Math.random()>0.5 ? playoffMatches.seedB.h : playoffMatches.seedB.a;
        calcMatchPOTM(winB);
        playoffMatches.winnerA = winA; playoffMatches.winnerB = winB;
        log(`[ì‹œë“œì „ ê²°ê³¼] ${winA}, ${winB} ìŠ¹ë¦¬.`);
        if (playoffMatches.rank1 === myTeam) {
             seasonState = "POST_PICK"; showPickUI([winA, winB]); return;
        } else {
            let picked = Math.random()>0.5 ? winA : winB;
            let other = (picked === winA) ? winB : winA;
            log(`${playoffMatches.rank1} íŒ€ì´ ${picked}ë¥¼ ì§€ëª…í–ˆìŠµë‹ˆë‹¤.`);
            playoffMatches.semiA = {h: playoffMatches.rank1, a: picked};
            playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
        }
    }
    function showPickUI(winners) {
        document.getElementById('round-display').innerText = "PLAYOFFS - FRIDAY NIGHT";
        document.getElementById('match-subtitle').innerText = "OPPONENT SELECTION";
        document.getElementById('match-title').innerText = "PICK PHASE";
        switchPhase('ui-lobby');
        document.getElementById('lobby-desc').innerText = "1ìœ„ íŠ¹ì „: 4ê°• ìƒëŒ€ë¥¼ ì§€ëª…í•˜ì‹­ì‹œì˜¤.";
        document.getElementById('selection-area').style.display = 'block';
        let box = document.getElementById('pick-opponent-btns');
        box.innerHTML = "";
        winners.forEach(t => {
            let b = document.createElement('button');
            b.className = 'action-btn'; b.style.fontSize = "0.9em"; b.style.padding = "10px"; b.innerText = t;
            b.onclick = () => confirmPick(t); box.appendChild(b);
        });
        document.getElementById('btn-start-match').style.display = 'none';
    }
    function confirmPick(opp) {
        document.getElementById('selection-area').style.display = 'none';
        document.getElementById('btn-start-match').style.display = 'block';
        let other = (opp === playoffMatches.winnerA) ? playoffMatches.winnerB : playoffMatches.winnerA;
        playoffMatches.semiA = {h: myTeam, a: opp};
        playoffMatches.semiB = {h: playoffMatches.rank2, a: other};
        seasonState = "POST_SEMI";
        updateRoundUI();
    }
    function recoverAllStamina(amount) { Object.values(TEAM_DB).forEach(roster => roster.forEach(p => p.hp = Math.min(100, p.hp + amount))); }
    function recordStats(h, a, s1, s2) { leagueStats[h].w += (s1>s2?1:0); leagueStats[h].l += (s1>s2?0:1); leagueStats[h].d += (s1-s2); leagueStats[a].w += (s2>s1?1:0); leagueStats[a].l += (s2>s1?0:1); leagueStats[a].d += (s2-s1); }
    function switchPhase(id) { document.querySelectorAll('.ui-phase').forEach(e => e.classList.remove('active-phase')); document.getElementById(id).classList.add('active-phase'); }
    function updateScoreBoard() { document.getElementById('sc-my').innerText = setScores[0]; document.getElementById('sc-opp').innerText = setScores[1]; }
    function log(m) { const l = document.getElementById('log-window'); l.innerHTML += `<div>> ${m}</div>`; l.scrollTop = l.scrollHeight; }    

// --- ì—¬ê¸°ì„œë¶€í„° SNS ê¸°ëŠ¥ ì½”ë“œ ---
    let lastMatchTweets = [];
       const COMMUNITY_DB = {
        WIN_BIG: [
            "ì™€ ìš°ë¦¬íŒ€ í¼ ë¯¸ì³¤ë‹¤ ã…‹ã…‹ã…‹", 
            "ì˜¤ëŠ˜ ê²½ê¸°ë ¥ ì‹¤í™”ëƒ? ìš°ìŠ¹ê°", 
            "ìƒëŒ€íŒ€ ìˆ¨ë„ ëª» ì‰¬ë„¤ ã…‹ã…‹ ì»·!", 
            "í¸-ì•ˆ. ì˜¤ëŠ˜ ê¿€ì  ì”ë‹¤ ã…‹ã…‹", 
            "ê°ë…ë‹˜ ì¢…ì‹  ê³„ì•½ ê°€ì¦ˆì•„~",
            // [ì¶”ê°€ë¨]
            "ì´ê²Œ íŒ€ì´ì§€ ã…‹ã…‹ ì§„ì§œ ì••ë„ì ì´ë‹¤",
            "ìƒëŒ€ ë©˜íƒˆ ë‚˜ê°„ ê±° í‘œì •ì—ì„œ ë‹¤ ë³´ì´ë„¤",
            "ì²´ê¸‰ ì°¨ì´ê°€ ë„ˆë¬´ ì‹¬í•œë°? ì–‘í•™ ìˆ˜ì¤€ ã„·ã„·",
            "ì˜¤ëŠ˜ ê²½ê¸°ëŠ” í•˜ì´ë¼ì´íŠ¸ë§Œ 10ë¶„ ë‚˜ì˜¤ê² ë‹¤",
            "ê²½ê¸°ë ¥ì´ ë¬¼ ì˜¬ëë„¤. ì´ëŒ€ë¡œë©´ ì „ìŠ¹ ìš°ìŠ¹ë„ ê°€ëŠ¥?"
        ],
        WIN_CLOSE: [
            "ì‹¬ì¥ ë–¨ì–´ì§€ëŠ” ì¤„;; ì´ê²¨ì„œ ë‹¤í–‰", 
            "ì§„ì§œ ëª…ê²½ê¸°ì˜€ë‹¤... ã… ã… ", 
            "ë§‰ì„¸íŠ¸ëŠ” ìš´ì´ ì¢€ ì¢‹ì•˜ë‹¤ ã…‹ã…‹", 
            "í˜ˆì•• ì˜¤ë¥´ë‹¤ê°€ ë§‰íŒì— ë½• ì°¨ì˜¤ë¥´ë„¤", 
            "ì´ê±¸ ì—­ì „í•˜ë„¤ ì™€...",
            // [ì¶”ê°€ë¨]
            "ì†ì— ë•€ì„ ì¥ê²Œ í•˜ë„¤.. ê·¸ë˜ë„ ì´ê²¨ì„œ ë‹¤í–‰ì´ë‹¤",
            "ìˆ˜ëª… 10ë…„ ì¤„ì–´ë“  ëŠë‚Œì„ ã…‹ã…‹",
            "ì§„ì§œ í•œ ë— ì°¨ì´ì˜€ë‹¤. ì„ ìˆ˜ë“¤ ê³ ìƒí–ˆë„¤",
            "ë§ˆì§€ë§‰ í•œíƒ€ ë•Œ ì†Œë¦¬ ì§ˆë €ë‹¤ ã…‹ã…‹ã…‹",
            "ì§„ì§œ ê¾¸ì—­ìŠ¹ì´ê¸´ í•œë° ì´ê¸´ ê²Œ ì–´ë””ëƒ"
        ],
        LOSE_BIG: [
            "ëˆˆ ì©ëŠ”ë‹¤ ì§„ì§œ... ì´ê²Œ í”„ë¡œëƒ?", 
            "í•´ì²´í•´ë¼ ê·¸ëƒ¥. ë‹µë„ ì—†ë‹¤.", 
            "ë°´í”½ ëˆ„ê°€ ì§°ëƒ?", 
            "íŒ¬ì§ˆí•˜ê¸° í˜ë“¤ë‹¤ í•˜...", 
            "í™˜ë¶ˆí•´ì¤˜ ë‚´ ì‹œê°„.",
            // [ì¶”ê°€ë¨]
            "ì—°ë´‰ ë±‰ì–´ë¼ ì§„ì§œ ì–‘ì‹¬ ì–´ë””ê°”ëƒ?",
            "ì˜¤ëŠ˜ ê²½ê¸°ëŠ” ì‹¤ë“œ ì¹  ìˆ˜ê°€ ì—†ë‹¤. ìµœì•…ì„.",
            "ì™€ 3:0 ì…§ì•„ì›ƒì€ ì¢€ ì•„ë‹ˆì§€ ì•Šë‚˜?",
            "ì¤€ë¹„ í•˜ë‚˜ë„ ì•ˆ í•´ì˜¨ í‹°ê°€ íŒíŒ ë‚œë‹¤. ê°ë… ê²½ì§ˆì¢€.",
            "ë™ë„¤ ê²½ìŸì „ ë³´ëŠ” ì¤„ ì•Œì•˜ìŒ ã…‹ã…‹ ìˆ˜ì¤€ ë¯¸ë‹¬."
        ],
        LOSE_CLOSE: [
            "ì¡Œì˜ì‹¸... ì•„ì‰½ë„¤", 
            "í•œíƒ€ í•œ ë²ˆë§Œ ì˜í–ˆì–´ë„ ã… ã… ", 
            "ê·¸ë˜ë„ ê°€ëŠ¥ì„±ì„ ë´¤ë‹¤.", 
            "ì  ëª» ì˜ ê±° ê°™ì•„... ì•„ê¹ë‹¤", 
            "ìƒëŒ€ê°€ ë„ˆë¬´ ì˜í•˜ë”ë¼. ì¸ì •.",
            // [ì¶”ê°€ë¨]
            "ì•„ ì§„ì§œ ë„ˆë¬´ ì•„ê¹ë‹¤.. 99%ê¹Œì§€ ê°”ëŠ”ë°..",
            "ë¶„íŒ¨ë‹¤ ë¶„íŒ¨. ë‹¤ìŒì—” ì´ê¸¸ ìˆ˜ ìˆì„ ë“¯.",
            "ì˜¤ëŠ˜ ìš´ì´ ì¢€ ì•ˆ ë”°ë¼ì£¼ë„¤ ã… ã… ",
            "ê·¸ë˜ë„ ëê¹Œì§€ ë¹„ë¹„ëŠ” ëª¨ìŠµì€ ë³´ê¸° ì¢‹ì•˜ë‹¤.",
            "í•œ í‹± ì°¨ì´ë¡œ ì§€ë„¤.. ë©˜íƒˆ ì¶”ìŠ¤ë¥´ì."
        ],
        MVP_PRAISE: [
            "{player} êµ­ëŒ€ ë³´ë‚´ì•¼í• ë“¯?", 
            "{player} ì˜¤ëŠ˜ ì¸ìƒ ê²½ê¸° ê°±ì‹  ã„·ã„·", 
            "ì†”ì§íˆ {player} ì—†ì—ˆìœ¼ë©´ ì¡Œë‹¤.", 
            "ë¹› ë¹› ë¹›... {player} ì°¬ì–‘í•´", 
            "ì—°ë´‰ ë‘ ë°°ë¡œ ì˜¬ë ¤ì¤˜ë¼",
            // [ì¶”ê°€ë¨]
            "{player} í”¼ì§€ì»¬ì€ ì§„ì§œ 'íƒˆì¸ê°„'ê¸‰ì´ë‹¤.",
            "ì˜¤ëŠ˜ {player} ìŠ¤íƒ¯ ë´¤ìŒ? ë”œëŸ‰ ë¯¸ì³¤ë˜ë°",
            "ê·¸ëƒ¥ {player} ì›ë§¨íŒ€ì„ ã…‹ã…‹ ë©±ì‚´ ìºë¦¬",
            "ì•ìœ¼ë¡œ ë‚´ ì£¼ì¸ë‹˜ì€ {player}ë‹¤. íŒ¬ ê°€ì…í•¨.",
            "{player} ì˜ì…í•œ ê²Œ ì‹ ì˜ í•œ ìˆ˜ì˜€ë„¤."
        ],
        BLAME: [
            "{player} ì–˜ëŠ” ì™œ 1êµ°ì„?", 
            "{player} í¬ì§€ì…˜ ì‹¤í™”ëƒ? ë˜ì§€ëŠ” ì¤„", 
            "{player} ì¢€ ë²¤ì¹˜ë¡œ ë³´ë‚´ë¼", 
            "ë²”ì¸ì€ ëª…í™•í•˜ë‹¤. {player}.", 
            "{player} ë©˜íƒˆ ë‚˜ê°„ ë“¯.",
            // [ì¶”ê°€ë¨]
            "{player} ë•Œë¬¸ì— 4:5 ê²Œì„ í•˜ëŠ” ì¤„ ì•Œì•˜ìŒ",
            "{player} ìŸ¤ëŠ” ì—°ìŠµ ì•ˆ í•¨? í¼ ì™œ ì €ë˜?",
            "ì œë°œ {player} ë°©ì¶œ ì¢€ í•´ë¼ ê°ë…ì•„",
            "{player} ê¶ê·¹ê¸° ì“°ëŠ” ê±° ë³´ë‹¤ê°€ ë’·ëª© ì¡ìŒ",
            "{player}ëŠ” ì˜¤ëŠ˜ ê±¸ì–´ë‹¤ë‹ˆëŠ” ê¶ê·¹ê¸° ë°°í„°ë¦¬ë„¤"
        ]
    };

    const FAKE_USERS = [
        // ê¸°ì¡´ ëª©ë¡
        {n:"ì˜µì¹˜ê´‘", h:"@ow_crazy"}, 
        {n:"ê²ì§€ì¥ì¸", h:"@genji_god"}, 
        {n:"ë°©êµ¬ì„ê°ë…", h:"@couch_coach"}, 
        {n:"ìµëª…", h:"@user1234"}, 
        {n:"ëŒì§„ì¡°í•©", h:"@dive_meta"},
        // [ì¶”ê°€ëœ 10ëª…]
        {n:"íëŸ¬ìœ ì €", h:"@heal_me_plz"},       // íëŸ¬ì˜ ì• í™˜
        {n:"í™”ë¬¼ë°€ì–´", h:"@push_payload"},      // í™”ë¬¼ ì§‘ì°©
        {n:"íƒ±ì»¤ì°¨ì´", h:"@tank_diff_gg"},      // ì •ì¹˜ì§ˆ ìœ ì € ì»¨ì…‰
        {n:"ë¸Œë¡ ì¦ˆíƒˆì¶œ", h:"@road_to_gold"},    // ì‹¬í•´ ìœ ì €
        {n:"ë½•ê²€ì£¼ì„¸ìš”", h:"@nano_blade"},      // ê²ì§€/ì•„ë‚˜ ì¡°í•© ì„ í˜¸
        {n:"ì§ê´€ëŸ¬", h:"@stadium_fan"},         // í˜„ì¥ íŒ¬
        {n:"ë©”ë¥´ì‹œì›ì±”", h:"@mercy_1trick"},    // íŠ¹ì • ì˜ì›… ì¥ì¸
        {n:"íŒŸì§€ìˆ˜ì§‘ê°€", h:"@potm_hunter"},     // í•˜ì´ë¼ì´íŠ¸ ë§¤ë‹ˆì•„
        {n:"33ì¡°í•©", h:"@goats_forever"},       // ì˜›ë‚  ë©”íƒ€ ê·¸ë¦¬ì›Œí•¨
        {n:"ì¹˜í‚¨ë¨¹ë°©", h:"@chick_watch"}        // ë¨¹ìœ¼ë©´ì„œ ë³´ëŠ” ì¦ê²œëŸ¬
    ];

    function generateTweets(isWin, scoreMy, scoreOpp, mvpName) {
        lastMatchTweets = [];
        let diff = Math.abs(scoreMy - scoreOpp);
        let theme = isWin ? ((diff >= 2) ? COMMUNITY_DB.WIN_BIG : COMMUNITY_DB.WIN_CLOSE) : ((diff >= 2) ? COMMUNITY_DB.LOSE_BIG : COMMUNITY_DB.LOSE_CLOSE);
        
        let selectedTexts = [...theme].sort(() => 0.5 - Math.random()).slice(0, 3);
        if (isWin) {
            let tpl = COMMUNITY_DB.MVP_PRAISE[Math.floor(Math.random() * COMMUNITY_DB.MVP_PRAISE.length)];
            selectedTexts.push(tpl.replace(/{player}/g, mvpName));
        } else {
            let victim = myLockedPlayers[Math.floor(Math.random() * 5)];
            let tpl = COMMUNITY_DB.BLAME[Math.floor(Math.random() * COMMUNITY_DB.BLAME.length)];
            selectedTexts.push(tpl.replace(/{player}/g, victim));
        }
        
        selectedTexts.sort(() => 0.5 - Math.random()).forEach(txt => {
            let user = FAKE_USERS[Math.floor(Math.random() * FAKE_USERS.length)];
            lastMatchTweets.push({ u: user.n, h: user.h, t: txt, time: Math.floor(Math.random()*10)+1+"m", l: Math.floor(Math.random()*500), r: Math.floor(Math.random()*100), rp: Math.floor(Math.random()*50), a: ["ğŸ¶","ğŸ±","ğŸ¹","ğŸ¦Š","ğŸ¸"][Math.floor(Math.random()*5)] });
        });
    }

    function toggleCommunity() {
        if(!myTeam) return;
        toggleModal('community-modal');
        const content = document.getElementById('community-content');
        content.innerHTML = "";
        if(lastMatchTweets.length === 0) { content.innerHTML = "<div style='padding:20px; text-align:center; color:#777;'>ì•„ì§ ê²½ê¸° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }
        lastMatchTweets.forEach(t => {
            content.innerHTML += `<div class="tweet-card"><div class="tweet-avatar">${t.a}</div><div class="tweet-body"><div class="tweet-header"><span class="tweet-name">${t.u}</span><span class="tweet-handle">${t.h} Â· ${t.time}</span></div><div class="tweet-text">${t.t}</div><div class="tweet-footer"><div class="tweet-action">ğŸ’¬ ${t.rp}</div><div class="tweet-action green">â†» ${t.r}</div><div class="tweet-action red">â¤ï¸ ${t.l}</div><div class="tweet-action">ğŸ“Š</div></div></div></div>`;
        });
    }

// â–¼â–¼â–¼â–¼â–¼ ìŠ¤ì¹´ìš°íŠ¸ ì‹œìŠ¤í…œ ë¡œì§ (ì»¤ìŠ¤í…€ & ìŠ¤íƒ¯ ë¸”ë¼ì¸ë“œ ë²„ì „) â–¼â–¼â–¼â–¼â–¼

// 1. ì»¤ìŠ¤í…€ FA ì„ ìˆ˜ ëª…ë‹¨ (ì—¬ê¸°ì„œ ì„ ìˆ˜ë¥¼ ë§ˆìŒëŒ€ë¡œ ìˆ˜ì •/ì¶”ê°€ í•˜ì„¸ìš”)
const CUSTOM_FA_LIST = [
    // í˜•ì‹: { n: "ë‹‰ë„¤ì„", r: "ì—­í• ", a:ì—ì„, s:ì„¼ìŠ¤, m:ë©˜íƒˆ, t:íŒ€ì›Œí¬, ms:["ëª¨ìŠ¤íŠ¸1"], trait:"íŠ¹ì„±" }
    { n: "Gyulbokbok", r: "DPS", a: 85, s: 75, m: 80, t: 70, ms: ["í”„ë ˆì•¼"], trait: "ìœ ë§ì£¼" },
    { n: "Imalone", r: "SUP", a: 80, s: 85, m: 75, t: 70, ms: ["ë£¨ì‹œìš°"], trait: "ìœ ë§ì£¼" },
    { n: "Gamjung", r: "SUP", a: 80, s: 80, m: 80, t: 70, ms: ["í‚¤ë¦¬ì½”"], trait: "ìœ ë§ì£¼" },
    { n: "Sentier", r: "TANK", a: 80, s: 80, m: 80, t: 70, ms: ["ìœˆìŠ¤í„´"], trait: "ìœ ë§ì£¼" },
      { n: "Checkmate", r: "DPS", a: 94, s: 93, m: 95, t: 94, ms: ["ì‹œë©”íŠ¸ë¼", "ë©”ì´"], trait: "ë‹¤ì¬ë‹¤ëŠ¥" },
      { n: "Belosrea", r: "TANK", a: 89, s: 88, m: 85, t: 90, ms: ["ìœˆìŠ¤í„´", "ë ˆí‚¹ë³¼"], trait: "ë¶„ìœ„ê¸°ë©”ì´ì»¤" }, 
      { n: "Kalios", r: "TANK", a: 91, s: 89, m: 88, t: 89, ms: ["ìë¦¬ì•¼", "ë””ë°”"], trait: "ë² í…Œë‘" }, 
     { n: "Simple", r: "SUP", a: 92, s: 87, m: 86, t: 88, ms: ["í‚¤ë¦¬ì½”", "ë¸Œë¦¬ê¸°í…Œ"]}, 
     { n: "Minut2", r: "DPS", a: 87, s: 90, m: 89, t: 91, ms: ["íŠ¸ë ˆì´ì„œ"]},
     { n: "Choisehwan", r: "DPS", a: 97, s: 94, m: 95, t: 90, ms: ["ê²ì§€", "ì—ì½”"], trait: "ì†Œë…„ê°€ì¥" },
     { n: "Whoru", r: "DPS", a: 98, s: 85, m: 88, t: 84, ms: ["ê²ì§€",], trait: "ë² í…Œë‘" },
     { n: "Flora", r: "DPS", a: 94, s: 89, m: 90, t: 88, ms: ["ì†Œì „", "ì†œë¸Œë¼"]},
     { n: "Edison", r: "DPS", a: 93, s: 91, m: 92, t: 93, ms: ["ì†Œì „", "ë¦¬í¼"], trait: "ë² í…Œë‘" },
     { n: "TOPDRAGON", r: "DPS", a: 93, s: 88, m: 87, t: 88, ms: ["ê²ì§€", "ì—ì½”"], trait: "ë‹¤ì¬ë‹¤ëŠ¥" },
     { n: "Jaewoo", r: "DPS", a: 91, s: 89, m: 88, t: 89, ms: ["íŠ¸ë ˆì´ì„œ"], trait: "ìœ ë§ì£¼" },
     { n: "Peppi", r: "TANK", a: 90, s: 88, m: 87, t: 88, ms: ["ì‹œê·¸ë§ˆ"]},
     { n: "Fixa", r: "SUP", a: 87, s: 91, m: 90, t: 92, ms: ["ë£¨ì‹œìš°", "ë¸Œë¦¬ê¸°í…Œ"]},
     { n: "Sley", r: "SUP", a: 90, s: 89, m: 88, t: 89, ms: ["ì¼ë¦¬ì•„ë¦¬"]},
       { n: "Stalk3r", r: "DPS", a: 98, s: 96, m: 93, t: 95, ms: ["íŠ¸ë ˆì´ì„œ", "ê²ì§€"], trait: "ë‹¤ì¬ë‹¤ëŠ¥" }
];

// ì´ˆê¸°í™” í•¨ìˆ˜ (ì»¤ìŠ¤í…€ ëª…ë‹¨ ë¡œë“œ)
function initFAPool() {
    FA_POOL = [];
    CUSTOM_FA_LIST.forEach(p => {
        let newP = {
            n: p.n, r: p.r,
            a: p.a, s: p.s, m: p.m, t: p.t,
            hp: 100, potm: 0, practiceProgress: {},
            ms: p.ms, trait: p.trait || "ì‹ ì¸"
        };
        FA_POOL.push(newP);
    });
}

// ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ í•¨ìˆ˜ (ìŠ¤íƒ¯ ìˆ¨ê¹€ ì ìš©)

function renderFAList(filter) {
    const list = document.getElementById('fa-list');
    list.innerHTML = "";
    document.querySelectorAll('#ui-scout .pool-filter-btn').forEach(b => {
        if(b.innerText === filter) b.classList.add('active');
        else b.classList.remove('active');
    });
    FA_POOL.forEach((p, idx) => {
        if(filter !== 'ALL' && p.r !== filter) return;
        let roleClass = p.r === 'TANK' ? 'rb-tank' : (p.r === 'DPS' ? 'rb-dps' : 'rb-sup');
        
        // ìŠ¤íƒ¯ ìˆ¨ê¹€ ì²˜ë¦¬
        let statDisplay = `<span style="color:#777; letter-spacing:2px;">STATS: ???</span>`;
        let msDisplay = p.ms.join(", ");

        // [ë³€ê²½ì ] ë°©ì¶œëœ ì‹œì¦Œì´ í˜„ì¬ ì‹œì¦Œê³¼ ê°™ìœ¼ë©´ ì˜ì… ë¶ˆê°€ ì²˜ë¦¬
        let isCooldown = (p.releasedSeason === seasonCount);
        let btnHtml = "";
        
        if (isCooldown) {
            btnHtml = `<button style="background:#444; border:1px solid #666; color:#888; cursor:not-allowed; border-radius:4px; padding:5px;" disabled>ë°©ì¶œë¨(ì‹œì¦Œì¤‘)</button>`;
        } else {
            btnHtml = `<button style="background:var(--accent); border:none; color:black; font-weight:bold; cursor:pointer; border-radius:4px;" onclick="tryRecruit(${idx})">ì˜ì…</button>`;
        }

        let card = document.createElement('div');
        card.className = 'draft-card';
        card.style.gridTemplateColumns = "50px 120px 1fr 100px"; // ë²„íŠ¼ ì˜ì—­ ì¡°ê¸ˆ ë„“í˜
        card.innerHTML = `<div class="role-badge ${roleClass}">${p.r}</div><div style="font-weight:bold; color:white;">${p.n}</div><div style="font-size:0.85em; color:#ccc;">${statDisplay} <br> <span style="color:var(--accent); font-size:0.9em;">â˜… ${msDisplay}</span></div><div style="text-align:right;">${btnHtml}</div>`;
        list.appendChild(card);
    });
}

// ë‚´ ë¡œìŠ¤í„° ê·¸ë¦¬ê¸° (ë³€ë™ ì—†ìŒ)
function renderMyScoutRoster() {
    const box = document.getElementById('scout-my-roster');
    box.innerHTML = "";
    let counts = { TANK:0, DPS:0, SUP:0 };
    TEAM_DB[myTeam].forEach(p => counts[p.r]++);
    box.innerHTML += `<div style="font-size:0.8em; margin-bottom:10px; text-align:center; color:#ccc;">íƒ±ì»¤: <span style="color:${counts.TANK>=2?'#e74c3c':'#2ecc71'}">${counts.TANK}/2</span> | ë”œëŸ¬: <span style="color:${counts.DPS>=3?'#e74c3c':'#2ecc71'}">${counts.DPS}/3</span> | íëŸ¬: <span style="color:${counts.SUP>=3?'#e74c3c':'#2ecc71'}">${counts.SUP}/3</span></div>`;
    TEAM_DB[myTeam].forEach(p => {
        let roleColor = p.r === 'TANK' ? '#3498db' : (p.r === 'DPS' ? '#e74c3c' : '#2ecc71');
        box.innerHTML += `<div style="background:#111; padding:8px; margin-bottom:5px; border-left:3px solid ${roleColor}; display:flex; justify-content:space-between;"><span>${p.n}</span><span style="font-size:0.8em; color:#888;">${p.r}</span></div>`;
    });
}

// ì˜ì… ì‹œë„ (ë³€ë™ ì—†ìŒ)

function tryRecruit(faIdx) {
    const target = FA_POOL[faIdx];

    // [ë³€ê²½ì ] ì¿¨íƒ€ì„ ì²´í¬ (ì•ˆì „ ì¥ì¹˜)
    if (target.releasedSeason === seasonCount) {
        alert("ì´ë²ˆ ì‹œì¦Œì— ë°©ì¶œí•œ ì„ ìˆ˜ëŠ” ë‹¤ì‹œ ì˜ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë‹¤ìŒ ì‹œì¦Œ ê°€ëŠ¥)");
        return;
    }

    const myRoster = TEAM_DB[myTeam];
    const roleCount = myRoster.filter(p => p.r === target.r).length;
    const LIMITS = { TANK: 2, DPS: 3, SUP: 3 };
    if (roleCount < LIMITS[target.r]) {
        myRoster.push(target);
        FA_POOL.splice(faIdx, 1);
        log(`[ì˜ì…] ${target.n} ì„ ìˆ˜ê°€ íŒ€ì— í•©ë¥˜í–ˆìŠµë‹ˆë‹¤.`);
        renderFAList(document.querySelector('#ui-scout .pool-filter-btn.active').innerText);
        renderMyScoutRoster();
    } else {
        pendingRecruitIdx = faIdx;
        openReleaseModal(target.r);
    }
}

// ëª¨ë‹¬ ì—´ê¸° (ë³€ë™ ì—†ìŒ)
function openReleaseModal(role) {
    const modal = document.getElementById('release-modal');
    const list = document.getElementById('release-candidates');
    list.innerHTML = "";
    TEAM_DB[myTeam].forEach(p => {
        if (p.r === role) {
            let btn = document.createElement('div');
            btn.style.cssText = "background:#333; padding:10px; cursor:pointer; border:1px solid #555; transition:0.2s;";
            btn.innerHTML = `<span style="color:var(--ban-red); font-weight:bold;">OUT</span> ${p.n} (AVG: ${Math.floor((p.a+p.s+p.t+p.m)/4)})`;
            btn.onclick = () => confirmSwap(p.n);
            list.appendChild(btn);
        }
    });
    modal.style.display = 'block';
}

// ëª¨ë‹¬ ë‹«ê¸° (ë³€ë™ ì—†ìŒ)
function closeReleaseModal() {
    document.getElementById('release-modal').style.display = 'none';
    pendingRecruitIdx = -1;
}

// êµì²´ í™•ì • (ë³€ë™ ì—†ìŒ)

function confirmSwap(releasePlayerName) {
    if (pendingRecruitIdx === -1) return;
    const newPlayer = FA_POOL[pendingRecruitIdx];
    const roster = TEAM_DB[myTeam];
    const releaseIdx = roster.findIndex(p => p.n === releasePlayerName);
    if (releaseIdx > -1) {
        const releasedPlayer = roster[releaseIdx];
        
        // [ë³€ê²½ì ] ë°©ì¶œë˜ëŠ” ì„ ìˆ˜ì—ê²Œ 'í˜„ì¬ ì‹œì¦Œ' ë„ì¥ì„ ì°ìŒ
        releasedPlayer.releasedSeason = seasonCount;
        
        FA_POOL.push(releasedPlayer);
        roster.splice(releaseIdx, 1);
        roster.push(newPlayer);
        FA_POOL.splice(pendingRecruitIdx, 1);
        log(`[íŠ¸ë ˆì´ë“œ] ${releasedPlayer.n} (ë°©ì¶œ) â†” ${newPlayer.n} (ì˜ì…)`);
        closeReleaseModal();
        renderFAList(document.querySelector('#ui-scout .pool-filter-btn.active').innerText);
        renderMyScoutRoster();
    }
}

// ìŠ¤ì¹´ìš°íŠ¸ ì¢…ë£Œ (ë³€ë™ ì—†ìŒ)

// â–¼â–¼â–¼ [10ë‹¨ê³„] AI íŒ€ ìë™ ìŠ¤ì¹´ìš°íŠ¸ ë¡œì§ â–¼â–¼â–¼
function runAiScouting() {
    log("<div class='log-system'>=== AI íŒ€ ìŠ¤ì¹´ìš°íŠ¸ ì‹œì¥ ê°œì¥ ===</div>");
    
    // 1. AI íŒ€ ìˆœì„œ ì„ê¸° (ëœë¤ ìˆœì„œ)
    let aiTeams = Object.keys(TEAM_DB).filter(t => t !== myTeam);
    aiTeams.sort(() => Math.random() - 0.5);

    let tradeCount = 0;

    // 2. ê° íŒ€ë³„ë¡œ ì˜ì… ì‹œë„
    aiTeams.forEach(tName => {
        let roster = TEAM_DB[tName];
        
        // ì—­í• êµ°ë³„ë¡œ ê²€í†  (TANK -> DPS -> SUP ìˆœ)
        ["TANK", "DPS", "SUP"].forEach(role => {
            // A. í˜„ì¬ íŒ€ì˜ í•´ë‹¹ ì—­í• êµ° ì„ ìˆ˜ ë¶„ì„
            let teamPlayers = roster.filter(p => p.r === role);
            
            // ì„ ìˆ˜ ê°€ì¹˜ í‰ê°€ í•¨ìˆ˜ (ìŠ¤íƒ¯ + ì„±ì  ê°€ì¤‘ì¹˜)
            const calcValue = (p, isMyPlayer) => {
                let statSum = p.a + p.s + p.m + p.t;
                // [í•µì‹¬ ë¡œì§] ê¸°ì¡´ íŒ€ì›ì€ ì„±ì (POTM)ì— í° ê°€ì‚°ì ì„ ì£¼ì–´ ë°©ì¶œ ë³´í˜¸
                // FA ì„ ìˆ˜ëŠ” ìˆœìˆ˜ ìŠ¤íƒ¯ + ì•½ê°„ì˜ ëœë¤ì„±
                let performanceBonus = isMyPlayer ? (p.potm * 20) : 0; 
                let randomNoise = Math.random() * 10; // ì•½ê°„ì˜ ëœë¤ì„±
                return statSum + performanceBonus + randomNoise;
            };

            // íŒ€ ë‚´ì—ì„œ ê°€ì¥ 'ê°€ì¹˜'ê°€ ë‚®ì€ ì„ ìˆ˜ ì°¾ê¸° (ë°©ì¶œ í›„ë³´)
            teamPlayers.sort((a, b) => calcValue(a, true) - calcValue(b, true));
            let worstPlayer = teamPlayers[0]; // ê°€ì¹˜ê°€ ì œì¼ ë‚®ì€ ì„ ìˆ˜

            // B. FA ì‹œì¥ì—ì„œ í•´ë‹¹ ì—­í• êµ° ì¤‘ ì˜ì… ê°€ëŠ¥í•œ ì„ ìˆ˜ íƒìƒ‰
            // ì¡°ê±´: ì´ íŒ€ì—ì„œ ë°©ì¶œëœ ì ì´ ì—†ì–´ì•¼ í•¨ (ì¬ì˜ì… ê¸ˆì§€ ì¿¨íƒ€ì„)
            let candidates = FA_POOL.filter(p => p.r === role && p.releasedBy !== tName);
            
            if (candidates.length === 0) return; // ì˜ì…í•  ì„ ìˆ˜ê°€ ì—†ìŒ

            // FA ì¤‘ ìŠ¤íƒ¯ì´ ê°€ì¥ ì¢‹ì€ ì„ ìˆ˜ ì°¾ê¸°
            candidates.sort((a, b) => calcValue(b, false) - calcValue(a, false));
            let bestFA = candidates[0];

            // C. ì˜ì…/êµì²´ ê²°ì • ë¡œì§
            const MAX_PER_ROLE = (role === 'DPS' || role === 'SUP') ? 3 : 2;
            
            // C-1. ìë¦¬ê°€ ë‚¨ëŠ” ê²½ìš° (ê·¸ëƒ¥ ì˜ì…)
            if (teamPlayers.length < MAX_PER_ROLE) {
                // FA ì„ ìˆ˜ì˜ ìŠ¤íƒ¯ ì´í•©ì´ 340(í‰ê·  85) ì´ìƒì´ë©´ ì˜ì… ì‹œë„
                if ((bestFA.a + bestFA.s + bestFA.m + bestFA.t) > 340) {
                    // FA -> íŒ€ ì´ë™
                    TEAM_DB[tName].push(bestFA);
                    // FA ëª©ë¡ì—ì„œ ì œê±°
                    let faIdx = FA_POOL.indexOf(bestFA);
                    if (faIdx > -1) FA_POOL.splice(faIdx, 1);
                    
                    log(`[ì´ì ] ${tName}, FA ${bestFA.n} ì˜ì… (ì „ë ¥ ë³´ê°•)`);
                    tradeCount++;
                }
            } 
            // C-2. ìë¦¬ê°€ ê½‰ ì°¬ ê²½ìš° (êµì²´/íŠ¸ë ˆì´ë“œ)
            else {
                // [í•µì‹¬ ë¹„êµ] 
                // FAì„ ìˆ˜ ê°€ì¹˜ > (ë°©ì¶œí›„ë³´ ê°€ì¹˜ + êµì²´ë¹„ìš© í˜ë„í‹°) ì¸ ê²½ìš°ì—ë§Œ êµì²´
                // ì„±ì ì´ ì¢‹ì€ ê¸°ì¡´ ì„ ìˆ˜ëŠ” ê°€ì¹˜ ì ìˆ˜ê°€ ë†’ì•„ì„œ ì—¬ê¸°ì„œ ë³´í˜¸ë¨
                let swapThreshold = 15; // êµì²´ ë¹„ìš© (ì´ ì ìˆ˜ ì°¨ì´ ì´ìƒ ë‚˜ì•¼ ë°”ê¿ˆ)
                
                let faVal = calcValue(bestFA, false);
                let myVal = calcValue(worstPlayer, true);

                if (faVal > myVal + swapThreshold) {
                    // íŠ¸ë ˆì´ë“œ ì‹¤í–‰
                    // 1. ê¸°ì¡´ ì„ ìˆ˜ ë°©ì¶œ (FAë¡œ ì´ë™ & ë°©ì¶œíŒ€ íƒœê·¸)
                    worstPlayer.releasedBy = tName; // ì´ íŒ€ì´ ë°©ì¶œí–ˆìŒì„ ê¸°ë¡
                    worstPlayer.releasedSeason = seasonCount;
                    FA_POOL.push(worstPlayer);
                    let removeIdx = TEAM_DB[tName].indexOf(worstPlayer);
                    if (removeIdx > -1) TEAM_DB[tName].splice(removeIdx, 1);

                    // 2. FA ì„ ìˆ˜ ì˜ì…
                    TEAM_DB[tName].push(bestFA);
                    let addIdx = FA_POOL.indexOf(bestFA);
                    if (addIdx > -1) FA_POOL.splice(addIdx, 1);

                    log(`[AI íŠ¸ë ˆì´ë“œ] ${tName}: ${worstPlayer.n}(ë°©ì¶œ) â†” ${bestFA.n}(ì˜ì…)`);
                    tradeCount++;
                }
            }
        });
    });
    
    if(tradeCount === 0) log("AI íŒ€ë“¤ì€ í˜„ì¬ ë¡œìŠ¤í„°ì— ë§Œì¡±í•˜ì—¬ ì˜ì…ì„ ì§„í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    else log(`AI ìŠ¤ì¹´ìš°íŠ¸ ì¢…ë£Œ. ì´ ${tradeCount}ê±´ì˜ ê³„ì•½ ì²´ê²°.`);
}
// â–²â–²â–² [10ë‹¨ê³„] ë â–²â–²â–²

// ê¸°ì¡´ finishScouting í•¨ìˆ˜ë¥¼ ì§€ìš°ê³  ì´ê±¸ë¡œ êµì²´í•˜ì„¸ìš”.
// â–¼â–¼â–¼ [ìˆ˜ì •ëœ] ìŠ¤ì¹´ìš°íŠ¸ ì¢…ë£Œ ë° ì •ê·œì‹œì¦Œ ì‹œì‘ í•¨ìˆ˜ â–¼â–¼â–¼
function finishScouting() {
    if(!confirm("ë‚´ íŒ€ ìŠ¤ì¹´ìš°íŠ¸ë¥¼ ë§ˆì¹˜ê³  ì •ê·œ ì‹œì¦Œì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(í™•ì¸ ì‹œ AI íŒ€ë“¤ë„ ìŠ¤ì¹´ìš°íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.)")) return;
    
    // 1. AI íŒ€ ìŠ¤ì¹´ìš°íŠ¸ ì‹¤í–‰ (ì¶”ê°€ë¨)
    runAiScouting();

    // 2. ì‹œì¦Œ ìƒíƒœ ë³€ê²½
    seasonState = "REGULAR";
    
    // 3. ë‚ ì§œ ì´ˆê¸°í™”
    currentWeek = 1;
    currentDayStep = 0; 
    
    // 4. UI ê°±ì‹ 
    updateRoundUI();
    
    // 5. ì €ì¥ ë° ë¡œê·¸
    log("=== REGULAR SEASON START ===");
    saveGame();
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

// â–¼â–¼â–¼ [3ë‹¨ê³„] ì •ë³´ì°½(ë§µ/ë°¸ëŸ°ìŠ¤) ì‘ë™ í•¨ìˆ˜ (ê¸°ì¡´ í•¨ìˆ˜ êµì²´) â–¼â–¼â–¼
    function toggleInfo() {
        toggleModal('info-modal');
        
        // 1. ë§µ ë¡œí…Œì´ì…˜ ì •ë³´ í‘œì‹œ
        const mapBox = document.getElementById('info-map-list');
        mapBox.innerHTML = "";
        
        const modeNames = {"ìŸíƒˆ":"CONTROL", "í˜¼í•©":"HYBRID", "í˜¸ìœ„":"ESCORT", "ë°€ê¸°":"PUSH", "í”Œë˜ì‹œ":"FLASHPOINT"};
        
        Object.keys(MAP_POOLS).forEach(mode => {
            let modeEn = modeNames[mode] || mode;
            mapBox.innerHTML += `
                <div style="margin-bottom:8px; border-bottom:1px dashed #333; padding-bottom:4px;">
                    <span style="color:var(--ow-orange); font-weight:bold;">[${modeEn}]</span> 
                    <span style="color:#ddd; font-size:0.95em;">${MAP_POOLS[mode].join(", ")}</span>
                </div>`;
        });

        // 2. ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ ì •ë³´ í‘œì‹œ
        const balBox = document.getElementById('info-balance-list');
        balBox.innerHTML = "";
        
        const roles = ["TANK", "DPS", "SUP"];
        let anyChange = false;

        roles.forEach(role => {
            let roleHeroes = HEROES[role];
            let changes = [];

            // ë³€ë™ ë‚´ì—­ í™•ì¸
            roleHeroes.forEach(h => {
                let rate = HERO_BALANCE[h.n] || 1.0;
                if (Math.abs(rate - 1.0) > 0.001) { // 1.0ì´ ì•„ë‹Œ ê²½ìš°ë§Œ í‘œì‹œ
                    changes.push({ name: h.n, rate: rate });
                }
            });

            // ë³€ë™í­ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬
            changes.sort((a,b) => Math.abs(1-b.rate) - Math.abs(1-a.rate));

            if (changes.length > 0) {
                anyChange = true;
                let html = `<div style="margin-top:15px; font-weight:bold; color:var(--accent); border-bottom:1px solid #444; margin-bottom:5px;">${role}</div>`;
                
                changes.forEach(c => {
                    let percent = Math.round((c.rate - 1) * 100);
                    let color = percent > 0 ? "var(--good-green)" : "var(--ban-red)";
                    let sign = percent > 0 ? "+" : "";
                    let icon = percent > 0 ? "â–²" : "â–¼";
                    
                    html += `
                        <div style="display:flex; justify-content:space-between; font-size:0.9em; padding:3px 0; border-bottom:1px solid #333;">
                            <span>${c.name}</span>
                            <span style="color:${color}; font-weight:bold;">${icon} ${sign}${percent}%</span>
                        </div>`;
                });
                balBox.innerHTML += html;
            }
        });

        if (!anyChange) {
            balBox.innerHTML = "<div style='padding:20px; text-align:center; color:#777;'>í˜„ì¬ ì ìš©ëœ ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.<br>(ì‹œì¦Œ 1 ì¢…ë£Œ í›„ ì ìš©ë©ë‹ˆë‹¤)</div>";
        }
    }

// â–¼â–¼â–¼ [6ë‹¨ê³„] ë¡¤ìŠ¤íƒ€ ì„ ì • ë¡œì§ í•¨ìˆ˜ â–¼â–¼â–¼

// 1. ë¡¤ìŠ¤íƒ€ ê³„ì‚° ë° í™”ë©´ ë Œë”ë§
function calculateAndShowRoleStars() {
    let allPlayers = [];
    
    // ëª¨ë“  íŒ€ì˜ ì„ ìˆ˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘
    Object.keys(TEAM_DB).forEach(tName => {
        TEAM_DB[tName].forEach(p => {
            // ì„ ì • ê¸°ì¤€ ì ìˆ˜: (ìŠ¤íƒ¯ ì´í•©) + (POTM íšŸìˆ˜ * 60) + (ì•½ê°„ì˜ ëœë¤ì„±)
            // POTM ê°€ì¤‘ì¹˜ë¥¼ ë†’ì—¬ì„œ í™œì•½í•œ ì„ ìˆ˜ê°€ ë½‘íˆë„ë¡ ìœ ë„
            let statsSum = p.a + p.s + p.m + p.t;
            let score = statsSum + (p.potm * 60) + (Math.random() * 5); 
            allPlayers.push({ ...p, team: tName, score: score });
        });
    });

    // ì—­í• êµ°ë³„ ì •ë ¬ (ì ìˆ˜ ë†’ì€ ìˆœ)
    let tanks = allPlayers.filter(p => p.r === 'TANK').sort((a,b) => b.score - a.score);
    let dps = allPlayers.filter(p => p.r === 'DPS').sort((a,b) => b.score - a.score);
    let sups = allPlayers.filter(p => p.r === 'SUP').sort((a,b) => b.score - a.score);

    // ì„ ì •: íƒ±1, ë”œ2, í2
    let winners = [
        tanks[0],
        dps[0], dps[1],
        sups[0], sups[1]
    ];

    // í™”ë©´ ê·¸ë¦¬ê¸°
    const container = document.getElementById('rolestar-container');
    container.innerHTML = "";

    winners.forEach(p => {
        // í•´ë‹¹ ì„ ìˆ˜ì—ê²Œ ë¡¤ìŠ¤íƒ€ ëˆ„ì  ê¸°ë¡ ì¶”ê°€ (ë‚˜ì¤‘ì„ ìœ„í•´)
        // ì‹¤ì œ ì›ë³¸ ê°ì²´ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
        let originalP = TEAM_DB[p.team].find(x => x.n === p.n);
        if(originalP) {
            if(!originalP.roleStars) originalP.roleStars = 0;
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€: ì‹œì¦Œë‹¹ í•œ ë²ˆë§Œ ì¹´ìš´íŠ¸ë˜ë„ë¡ í”Œë˜ê·¸ í™•ì¸ í•„ìš”í•˜ì§€ë§Œ, 
            // ì—¬ê¸°ì„  UI ë Œë”ë§ ì‹œì ì´ë¯€ë¡œ ë‹¨ìˆœ í‘œì‹œë§Œ í•˜ê³ , ì‹¤ì œ ì¹´ìš´íŠ¸ëŠ” finishRoleStarì—ì„œ ì²˜ë¦¬ ê¶Œì¥.
            // ì¼ë‹¨ ì—¬ê¸°ì„  ë³´ì—¬ì£¼ê¸°ìš© ë°ì´í„°ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        }

        let roleColor = p.r === 'TANK' ? '#3498db' : (p.r === 'DPS' ? '#e74c3c' : '#2ecc71');
        
        let html = `
            <div class="rs-card" style="border-top: 4px solid ${roleColor};">
                <div class="rs-role" style="color:${roleColor}; border:1px solid ${roleColor};">${p.r}</div>
                <div class="rs-name">${p.n}</div>
                <div class="rs-team">${p.team}</div>
                <div class="rs-score">POTM: ${p.potm}íšŒ</div>
            </div>
        `;
        container.innerHTML += html;
    });
}

// 2. ë¡¤ìŠ¤íƒ€ í™•ì¸ í›„ í¬ìŠ¤íŠ¸ ì‹œì¦Œìœ¼ë¡œ ì´ë™
// â–¼â–¼â–¼ [ìˆ˜ì •ëœ] ë¡¤ìŠ¤íƒ€ ì¢…ë£Œ ë° ê¸°ë¡ ì €ì¥ í•¨ìˆ˜ â–¼â–¼â–¼
function finishRoleStar() {
    // í™”ë©´ì— í‘œì‹œëœ ë¡¤ìŠ¤íƒ€ ì¹´ë“œë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ ê¸°ë¡ ì €ì¥
    // (calculateAndShowRoleStars í•¨ìˆ˜ì—ì„œ ì´ë¯¸ ìŠ¹ìë¥¼ ë½‘ì•˜ì§€ë§Œ, ë°ì´í„° ì €ì¥ì€ ì—¬ê¸°ì„œ í™•ì •)
    
    // 6ë‹¨ê³„ì—ì„œ ë§Œë“  calculateAndShowRoleStars í•¨ìˆ˜ ì•ˆì— ìˆëŠ” `winners` ë³€ìˆ˜ëŠ” ì§€ì—­ë³€ìˆ˜ë¼ ì ‘ê·¼ ë¶ˆê°€.
    // ë”°ë¼ì„œ UIì— ë Œë”ë§ëœ ì´ë¦„ì„ ê¸ì–´ì˜¤ê±°ë‚˜, ë¡œì§ì„ ë‹¤ì‹œ ëŒë ¤ì•¼ í•¨.
    // ê°„ë‹¨í•˜ê²Œ "ë¡¤ìŠ¤íƒ€ ì„ ì • ë¡œì§"ì„ ë‹¤ì‹œ ëŒë ¤ì„œ(ê²°ê³¼ëŠ” ê°™ìŒ) ì €ì¥í•©ë‹ˆë‹¤.
    
    let allPlayers = [];
    Object.keys(TEAM_DB).forEach(tName => {
        TEAM_DB[tName].forEach(p => {
            let statsSum = p.a + p.s + p.m + p.t;
            let score = statsSum + (p.potm * 60) + (Math.random() * 5); 
            allPlayers.push({ ...p, team: tName, score: score });
        });
    });
    let tanks = allPlayers.filter(p => p.r === 'TANK').sort((a,b) => b.score - a.score);
    let dps = allPlayers.filter(p => p.r === 'DPS').sort((a,b) => b.score - a.score);
    let sups = allPlayers.filter(p => p.r === 'SUP').sort((a,b) => b.score - a.score);
    
    let winners = [tanks[0], dps[0], dps[1], sups[0], sups[1]];

    // ìš°ë¦¬ íŒ€ ì„ ìˆ˜ê°€ ìˆë‹¤ë©´ ê¸°ë¡ì‹¤ì— ì¶”ê°€
    winners.forEach(p => {
        if (p.team === myTeam) {
            updateHistorySingle(p.n, 'ROLE_STAR');
        }
    });

    seasonState = "POST_BUFFER"; 
    updateRoundUI();
    log("=== í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì¼ì •ì— ì§„ì…í•©ë‹ˆë‹¤ ===");
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
// â–²â–²â–² [6ë‹¨ê³„] ë â–²â–²â–²

// â–¼â–¼â–¼ [7,8ë‹¨ê³„] ê¸°ë¡ì‹¤ í‘œì‹œ ë¡œì§ â–¼â–¼â–¼
function toggleRecords() {
    toggleModal('records-modal');
    const tbody = document.getElementById('records-body');
    tbody.innerHTML = "";
    
    const myRoster = TEAM_DB[myTeam];
    
    if (!myRoster || myRoster.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6'>ë¡œìŠ¤í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</td></tr>";
        return;
    }

    // í˜„ì¬ ë¡œìŠ¤í„°ì— ìˆëŠ” ì„ ìˆ˜ë“¤ì˜ ëˆ„ì  ê¸°ë¡ë§Œ ê°€ì ¸ì˜´
    myRoster.forEach(p => {
        let h = PLAYER_HISTORY[p.n]; 
        
        // ê¸°ë¡ì´ ì•„ì˜ˆ ì—†ìœ¼ë©´(ì‹ ì…) 0ìœ¼ë¡œ í‘œì‹œ
        if (!h) h = { k:0, d:0, a:0, potm:0, roleStar:0, sets:0 };
        
        // í‰ê·  KDA ê³„ì‚°
        let avgK = h.sets > 0 ? (h.k / h.sets).toFixed(1) : "0.0";
        let avgD = h.sets > 0 ? (h.d / h.sets).toFixed(1) : "0.0";
        let avgA = h.sets > 0 ? (h.a / h.sets).toFixed(1) : "0.0";
        
        let roleColor = p.r === 'TANK' ? '#3498db' : (p.r === 'DPS' ? '#e74c3c' : '#2ecc71');
        
        tbody.innerHTML += `
            <tr style="border-bottom:1px solid #333; height:40px;">
                <td><span style="color:${roleColor}; font-weight:bold; border:1px solid ${roleColor}; padding:2px 6px; border-radius:4px; font-size:0.8em;">${p.r}</span></td>
                <td style="font-weight:bold; color:white;">${p.n}</td>
                <td style="color:#aaa;">${h.sets} set</td>
                <td>${h.k} / ${h.d} / ${h.a} <span style="font-size:0.8em; color:#777;">(${avgK}/${avgD}/${avgA})</span></td>
                <td style="color:var(--gold); font-weight:bold;">${h.potm}</td>
                <td style="color:var(--accent); font-weight:bold;">${h.roleStar}</td>
            </tr>
        `;
    });
}
// â–²â–²â–² ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

</script>
</body>
</html>
